[
    {
        "id": "6f07332b8253050a",
        "type": "tab",
        "label": "OLD / DEV REFERENCE",
        "disabled": false,
        "info": ""
    },
    {
        "id": "0661e4588e011b72",
        "type": "tab",
        "label": "[Rev0] Game Logic Flows",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f74b301e4f22310f",
        "type": "tab",
        "label": "[Rev0] Game Data Access Flows",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8b4b6895c0ec29ec",
        "type": "tab",
        "label": "Storage Management",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f3ec5d556e86f8d0",
        "type": "tab",
        "label": "Field Config",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c46bd56bf00dd36c",
        "type": "tab",
        "label": "Hit Injects For Testing",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5b48d63e525889af",
        "type": "tab",
        "label": "BallFlow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e1a756fd8363adc2",
        "type": "tab",
        "label": "LaserFlow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c4f77bdc618b8d18",
        "type": "tab",
        "label": "TreeFlow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "66af4b80919b8266",
        "type": "tab",
        "label": "Remaining Common Flow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "221fa9b81205c952",
        "type": "tab",
        "label": "GC Active Dashboard",
        "disabled": false,
        "info": ""
    },
    {
        "id": "78c5e866df5030a1",
        "type": "tab",
        "label": "GC Burn Logic",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c76bd87c4cae8120",
        "type": "tab",
        "label": "GC Game Init",
        "disabled": false,
        "info": ""
    },
    {
        "id": "06961c6f5e4566a1",
        "type": "group",
        "z": "221fa9b81205c952",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "8dd58815c2e5e6ed",
            "59f5d060d5848730",
            "db6a188325dcd4b5",
            "7008fa5d0a1f6f49",
            "46a56e643dbadfdf",
            "b887e05d8e16f98a",
            "6d8ab4a0bf2c6144",
            "7f5a474942e946d6",
            "c8663193fd1a2a4c",
            "acc02b92d4d8c13e",
            "ab6b0ced1764bbe7",
            "3b62b6b510d4e006",
            "a1d67bd37d35d4c9",
            "42af8511d5eb7b89",
            "d92cebfab339228d",
            "7b3cf80c2f7933f5",
            "783c1457c57e2fdd",
            "490f0337c9b5fdde",
            "ee09a1869c62b35f",
            "4a0f846d052b27a1",
            "eda2c692de480fc2",
            "a7a659cc6f58af7b",
            "2d8175ca745dc0c0",
            "0cb81d115358288e",
            "8d5a8c631a18adf2",
            "76325cc73d807aff",
            "5cd390e68340fd0d",
            "33375f464a25e378",
            "b4f6bbea7b9c1425",
            "dd3ee7af1c1be3f9",
            "a31a48fc659094dc",
            "69c13b1cb1ef9106",
            "da33cf2e422fe969",
            "977940dbb24cd0d3",
            "5d504534615be681",
            "7faa48872118547a",
            "25b25582dbcb2144",
            "84c72e5e7a50791b",
            "c37b3d3b6e56e19a",
            "2481a3e18ec02d52"
        ],
        "x": 54,
        "y": 1079
    },
    {
        "id": "876d6d7684ab551a",
        "type": "group",
        "z": "221fa9b81205c952",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "cefe09f15191636e",
            "ab0b09557b760e39",
            "df4499ebe0ea3b90",
            "15de13e19c130f74",
            "4b3225e374299121",
            "238491dc517ad107",
            "c208d636c0f91949",
            "5f1b71b4e2a46e94",
            "1371a06f222f852d",
            "f029d33d5a01430b",
            "7e5bdfbfdb4b0b19",
            "087ea15ff4df1c45",
            "128c7226f7be2da9",
            "312e300ef0c3ebfc",
            "232f875101b89298",
            "846b71a8845b48e3",
            "947d970c36309582",
            "5884816cd47f36fa",
            "e3e43826d5609708",
            "59745bda3e910197",
            "b505ddef8a8d5b22",
            "d026e7298107e8b5",
            "9827bb283a8e319e",
            "8c5e3572a53fc2f1",
            "04c4f4f285f0deb1",
            "0151b281f9b86223",
            "986017af6fcb9593",
            "2fe33fb8bb9a740c"
        ],
        "x": 1314,
        "y": 1139
    },
    {
        "id": "b761ec70a9ef3fae",
        "type": "group",
        "z": "221fa9b81205c952",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "02094e58d214ca4e",
            "f37a6402dfd150e0",
            "4a8a1a766a1837c0",
            "a5d13575b4066615",
            "b529cac067f45af4",
            "51b576984a477740",
            "c693bf2be0bdd6c9",
            "5d6f905de272b1d2",
            "8cbd51125ac85550",
            "50359eeb29b81631",
            "0dc41cb011328b65",
            "6e9b0e81c64578d1",
            "24e10dd69d611c1f",
            "109255f8ae4b157b",
            "b4e29f7a97232bf2",
            "911609ae63506f9d",
            "5007fdcc502bf71f",
            "7f65a1150aef277e",
            "b17cbc13baf34fa7",
            "883967a94c384489",
            "7187b273e7394c3f",
            "a8cf64b853f83977",
            "6be1279db19ab616",
            "657f37cb57ddaa95",
            "d11da172d0a3d14e",
            "1d23ea346df62408",
            "561c69906925c60c",
            "045e41f36b73f834",
            "55a5760f1ef81c07",
            "9a61ec5826546fce",
            "6d8eea74bd881d3e",
            "b87bb6e70f564e51"
        ],
        "x": 114,
        "y": 319
    },
    {
        "id": "46ce7ea15148c3c0",
        "type": "group",
        "z": "221fa9b81205c952",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "3c2b5bf33ff7f378",
            "564b2cdfbde31e81",
            "5fd586e91231d64b",
            "0835dea3b60c02ec",
            "027676a7f94dcb56",
            "cb7e719f404147e7",
            "0fe794e7a88f6314"
        ],
        "x": 54,
        "y": 39
    },
    {
        "id": "b2b1f1ca3c2a378c",
        "type": "group",
        "z": "78c5e866df5030a1",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "1041872ebca1978e",
            "f59037c96c368ebf",
            "9cca8f992b8c7647",
            "26f2407faa608dc1",
            "8f95daa740229529",
            "9cd82c4daa29d5ad",
            "28f23bc48aaf3faa",
            "e973f31882c4c9cf",
            "648381244912ad1f",
            "42dc7006a64f8054",
            "1c7894266bb4be36"
        ],
        "x": 74,
        "y": 39
    },
    {
        "id": "c5248dc36aacb922",
        "type": "group",
        "z": "78c5e866df5030a1",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "d21ffff25b233c0c",
            "66fe54ab87d11648",
            "38031cb4243cb25c",
            "35f9efa88ad160c8",
            "c5cdba8f93e28d47",
            "5b258f7caa4a95d4",
            "90ab0fecc32bcde5",
            "bfe8431d74b3bed6",
            "b52a86402946ae8d",
            "0174ebdf7245c867",
            "c905e5ec9fe3a717",
            "188e7a8937b3eeec",
            "7622988f3e676eef",
            "5f1a0c0f330d9d19",
            "af0cc8f3c2088bbc",
            "afe0ce27b8dd56da",
            "fa0c4978405d7038",
            "6d6d9e4073bfca2a",
            "0ff4b05a25dbcb05",
            "b86fcf4650bb15c0",
            "58597e887a5478f5",
            "f7ad0a1277125d73",
            "c0b679d5263dc4cd",
            "7804a412d60bf28e",
            "986d2e280e45de7f",
            "ffa6f64c863dd6d7",
            "d5ecf80c25bd29b1",
            "c7250da4e3efc921",
            "301cc370fc617f4c",
            "5462a2bd26666b2f",
            "3e6e15e5c63e1d6a",
            "8fbd2ca3f542523c",
            "ff1ba8e7aa6880f7",
            "b249b8f1b98174a4",
            "9c36b025ce60755e",
            "3ac3e5e6d417580e",
            "d22a44513afbaff1",
            "b4c6561b559a3ff5"
        ],
        "x": 74,
        "y": 379
    },
    {
        "id": "418e8e7e5f859cb1",
        "type": "group",
        "z": "78c5e866df5030a1",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "c8924c7acd40cb1f",
            "03fe7cfb0cca4dd1",
            "f7954fdaf37f1d6b",
            "74784ec507860137",
            "d0a5e8de374a7a44",
            "9694f7729d4a4b39",
            "4c03455adb33b337",
            "d6ddc265e0e6f590",
            "69cd02e02585755b"
        ],
        "x": 1734,
        "y": 439
    },
    {
        "id": "4bbf2c1d342827b1",
        "type": "group",
        "z": "c76bd87c4cae8120",
        "name": "",
        "style": {
            "stroke": "#3a3a3a",
            "fill": "#1e1e1e",
            "fill-opacity": "0",
            "label": true,
            "color": "#cccccc"
        },
        "nodes": [
            "0992c684f2271f0e",
            "d36ef2fad2d08d5f",
            "2c3b21cccf6adf7b",
            "1a20725593d7b89e",
            "a5335a1083d1d5ce",
            "0129b9e5b3b7cd23",
            "a9f9404dbd9276a0",
            "50d2b3036d95d6fb",
            "d44de76c8506206b",
            "0554919775c9921e",
            "525f1f19c2aa78a9",
            "9e523391779ae934",
            "98b12c1e303486f3"
        ],
        "x": 54,
        "y": 79
    },
    {
        "id": "0832a839154f65ab",
        "type": "group",
        "z": "c76bd87c4cae8120",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "8a7388f51ce071e6",
            "88c80410ac1ebd2a",
            "9e4c8b2d59a8c9c5",
            "8fe9fb732a74354d",
            "b055361f8ee3d7c0",
            "cacf2baa95692221",
            "b8b568cbf8dd8f15",
            "7208fa7e7114434b",
            "34de1618774ad1f8",
            "493311208733ae0d",
            "512ef011616a4b81",
            "370c0cbf29d05ab1"
        ],
        "x": 54,
        "y": 419
    },
    {
        "id": "59950207257cb065",
        "type": "group",
        "z": "6f07332b8253050a",
        "name": "",
        "style": {
            "stroke": "#3a3a3a",
            "fill": "#1e1e1e",
            "fill-opacity": "0",
            "label": true,
            "color": "#cccccc"
        },
        "nodes": [
            "bcef7098b2bcab87",
            "4eb277af36ef1fe2",
            "c2285509eb863856",
            "e7fdc24bcd360c08",
            "372c7a6bec7d1005",
            "58e0133d504974b2",
            "5eef5dc3824c88f6",
            "63b6bb6097222b63",
            "c30231dee65db09d",
            "1f2c1fa133c6065f",
            "baf9c9e56c55af9c",
            "803409c672685edb",
            "02b8a461b8de262a",
            "4d99b7cae64f909e",
            "37b9350256bf1cc0",
            "a079891af81acf69",
            "c854b1ceacdd7cbd",
            "3f886858a14bf1f8",
            "eb9f4d74e26f9854",
            "95d8b751de777e8d",
            "a2c40ebd42a054a9",
            "8430477f261fe058",
            "cfa55283398d5d96",
            "6c96858cd3695db2",
            "711e25dc20dbd9af",
            "6b33a4946c072763",
            "779d72582a45aa82",
            "7684f0009e5ef352"
        ],
        "x": 34,
        "y": 39,
        "w": 1042,
        "h": 862
    },
    {
        "id": "229d7911730c710f",
        "type": "group",
        "z": "6f07332b8253050a",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "b199686f052fe77f",
            "f1896d48a659a2cb",
            "c870ec8282153101",
            "a29505e70d7b9ece",
            "70c33d06c1d6b167",
            "28eb2bc55dcddb70",
            "277d12403d6f9f63",
            "8c392ecc9a35c3eb",
            "a9c50f46b67e9896",
            "628745f67dade8c1",
            "a17a899f16b9d084",
            "d12eb5d4f1efff54",
            "75c5f224f591b111",
            "04f926d3d2ee0cd5",
            "ec3ec501f79d3d62",
            "11e4b52900aedf18",
            "37c9658f21fde304",
            "e2b1eeb7b8ba3724",
            "445fcf6390a71317",
            "2cf306418f5ec1a7",
            "6243bfa8703f32ca",
            "8f1d410dda1e4f81",
            "84a25c5ebff798fb",
            "71a84d7f0e04039b",
            "1fba5de08a2e1d6f",
            "28b06e0ed349f7f2",
            "cc9c7da6d3ec6e77",
            "9225979b748b64fa",
            "7bfb5dc8f61f8b2e",
            "3f61a9a29423178a",
            "7777761941ca1618",
            "280f249d698f4e0c",
            "12d960ab4b6ae7fc",
            "b988ed62abb07361",
            "35c2141922736ecd",
            "a0893a9b1c6e7557",
            "43f3e3127047706d",
            "cf29e65e98345a3c",
            "c52350773fd926d5",
            "f10fa9da70498f8c",
            "f964e3d3a6ee8191",
            "e0440fb8e9a44898",
            "4d6ebb703ebf233d",
            "396bd91435c9a4fe"
        ],
        "x": 1134,
        "y": 39,
        "w": 1572,
        "h": 922
    },
    {
        "id": "44c6bd61d9aa5d1d",
        "type": "group",
        "z": "6f07332b8253050a",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "cc0e458f8d09ebf0",
            "de154b3cccf614e0"
        ],
        "x": 48,
        "y": 1013,
        "w": 1514,
        "h": 1334
    },
    {
        "id": "208849015b030c99",
        "type": "group",
        "z": "0661e4588e011b72",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "5329a59e7e76c7c0",
            "ddad0b88779e31bf",
            "3bf9e0f865abb5b8",
            "ed62e9e4477e7eed",
            "e84e140d4b501f18",
            "530bf25ea8a65ce6",
            "cc89dbf72d1f6006"
        ],
        "x": 74,
        "y": 19
    },
    {
        "id": "31e8c747379a1719",
        "type": "group",
        "z": "0661e4588e011b72",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "165f13f0f929f16e",
            "456155bf98b91e2c",
            "dd55547c4747b6b1",
            "e65f24f080169b20",
            "754ef2450038c273",
            "a67d3036cd8b2a23",
            "821e9e89a9ce075d",
            "3719854fdfed232d"
        ],
        "x": 74,
        "y": 199
    },
    {
        "id": "82485a2c45a42ec4",
        "type": "group",
        "z": "0661e4588e011b72",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "58637d97cec1ab0f",
            "17bbf4fea9206322",
            "079efb4aca734ee4",
            "ffb549e9c8fb8991",
            "54f48d7af3ce8a94",
            "42e79718ce6113ea",
            "d87a3df5ff53208e",
            "4ed8add72706ca62",
            "9aabfa9c28103459",
            "16c9d84b48e02137",
            "a26c69d85115ea29",
            "5690d1607d8fc9da"
        ],
        "x": 74,
        "y": 479
    },
    {
        "id": "dec7910ea27af2d0",
        "type": "group",
        "z": "0661e4588e011b72",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "e8fcbe1eaf3b0d0b",
            "2c6de25e908b1996",
            "36cc246e4c6ddac8",
            "0143496e1011b5b9",
            "84a54223a84f044a",
            "23720f7562bead06",
            "a90ba086792e3e58",
            "a4f26d2999f4172e",
            "a758f9ceac41ea87",
            "4d4ec8f260d5ebe5",
            "520da49c1ff95703",
            "720d501722eb94f6",
            "5dc6bd11da1ac853",
            "09b68daef587970a"
        ],
        "x": 74,
        "y": 779
    },
    {
        "id": "152a8cb72061205a",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "3a4b12e5b9609b0d",
            "07b0e9426f57711a",
            "a4fbec13a30337cd",
            "b49a77ff09745d6d",
            "9a98401250929d20",
            "7046ccf0cab73df5",
            "c5098de218c47d8f",
            "d88db86de710b8e9"
        ],
        "x": 34,
        "y": 59,
        "w": 942,
        "h": 162
    },
    {
        "id": "2008d605d368ad7e",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "ee723854cfa1c6f1",
            "ad8d8a3973c7761a",
            "473384a40d04fd99",
            "af55cd6eb001ec61",
            "d527904ed8723b40",
            "594538fb122fa8a1",
            "2e8cd63f45daf40d",
            "221e289248744137"
        ],
        "x": 34,
        "y": 239,
        "w": 942,
        "h": 162
    },
    {
        "id": "37232e2e92b5faa6",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "2ce44170d41d852c",
            "9e904570325a5f04",
            "0cb41cd8c25bd380",
            "63f807f3f36abd11",
            "91eeec4cfa6d85ca",
            "4d52cd46f08add7f",
            "1fe8b5ccb6bce22f",
            "2f1658364fc5719b"
        ],
        "x": 34,
        "y": 419,
        "w": 942,
        "h": 162
    },
    {
        "id": "d9c57fb2a381a320",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "b91304bb2e2395c8",
            "a37728c272928fcb",
            "23c2335c118ef4be",
            "0d084e688f622348",
            "4244695d7f15d3fd"
        ],
        "x": 34,
        "y": 599,
        "w": 932,
        "h": 142
    },
    {
        "id": "738e4f614ef8a7a5",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "be446f7474a7a970",
            "a5a1bd31c468f86b",
            "2a673ebfd70ddc64",
            "7d1c946cf1d71468",
            "2df386bd76ec52e3",
            "72bcba239803d115"
        ],
        "x": 34,
        "y": 779,
        "w": 972,
        "h": 142
    },
    {
        "id": "e56885edbfad9853",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "540954cda7540f43",
            "27094e97daa3234a",
            "786da311f9d1e2af",
            "a4cca78582b0aa97",
            "48af91ab4809047a",
            "553a13c0223b7873",
            "50a7d4620d30956a"
        ],
        "x": 34,
        "y": 939,
        "w": 1052,
        "h": 142
    },
    {
        "id": "c4beeef48c6dcf84",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "4c16c39c21c351b0",
            "fc55610d6c9105b3",
            "12b7849527a8f3d3",
            "cd1bf88c1e97229e",
            "e1a5ecaa10ad1d0c",
            "e354ec1a31284c79",
            "c1f1b1372fb990e6",
            "5aaea6a334032def",
            "0aa61745968b6ee5",
            "6b1897b0ddc816e3",
            "806da0dcb41029ca",
            "77a83cc806cc1911",
            "31fbf44c69967dc6",
            "9d5a3a60e2f7a702",
            "3906a1f3b5aae88b",
            "886f1bf59dfd0f7e",
            "2e54183334f1fc80",
            "6cf089b32235b868",
            "57063f0af227550c",
            "39e74dd8054364ef",
            "fa744c0499161826",
            "5e3bed73fbede711",
            "0692d55544c5bd31"
        ],
        "x": 1304,
        "y": 39,
        "w": 1792,
        "h": 562
    },
    {
        "id": "650381ccef7c28a3",
        "type": "group",
        "z": "f74b301e4f22310f",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "4bfad19cc46d0966",
            "5954b430a79f7b3e",
            "397f10dd3ab3a997",
            "18a554bcaa2360e7",
            "761720674f178020",
            "fa60c2b1c4bd6432",
            "18fb71a97e22a4a8",
            "dd2bda159bd6865c",
            "8d86d9b8f1326f1b",
            "9ba69fd69ae011c7",
            "ca18ad730b62784e",
            "ad3020e3fc7099e8",
            "abf14147cd05c8bd"
        ],
        "x": 34,
        "y": 1139,
        "w": 972,
        "h": 542
    },
    {
        "id": "c9a02ca8caf3cfb8",
        "type": "group",
        "z": "c46bd56bf00dd36c",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "3657f15f91c08259",
            "58f91e5a06b49681",
            "d95bc0be08b649e4",
            "a39cc0a1489b6dd0",
            "cc88980df5b50e81",
            "98c60bf4f503a36e",
            "870e04fa144c4f6c",
            "5598e9bedb216108",
            "ca207569b8ffecb7"
        ],
        "x": 54,
        "y": 39,
        "w": 592,
        "h": 229.5
    },
    {
        "id": "fd36eb12b8432134",
        "type": "group",
        "z": "c46bd56bf00dd36c",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "d83a5043f1f82c75",
            "56b66c00e99f38c3",
            "54d5da1e44335e4d",
            "3d58044e6edc0422",
            "0e64c0905e30abf0",
            "5d2ad7baf266e2f2"
        ],
        "x": 54,
        "y": 279,
        "w": 912,
        "h": 202
    },
    {
        "id": "8e3af1c96b869979",
        "type": "group",
        "z": "c46bd56bf00dd36c",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "e5e15c6fe3666794",
            "f8ebb08cbac54939",
            "c7839544c6f7c108",
            "a4ee5ad8874c8a5c"
        ],
        "x": 54,
        "y": 499,
        "w": 712,
        "h": 122
    },
    {
        "id": "1bd0079dd85b8647",
        "type": "group",
        "z": "c46bd56bf00dd36c",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "2253e94c12db5bea",
            "34ef0188a339e4b1",
            "928b2b1d022b2425",
            "310a66838602d619",
            "4ead786be8e28f0e"
        ],
        "x": 54,
        "y": 799,
        "w": 772,
        "h": 182
    },
    {
        "id": "aa1431e66ec37b16",
        "type": "group",
        "z": "8b4b6895c0ec29ec",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "323e92765149313d",
            "deb6a8cb5bd78b0e",
            "f17cfb3701f218bb",
            "d8a5d35c8d38a3d3",
            "c940c00eb130609a",
            "bb20e976f6f77ed1"
        ],
        "x": 34,
        "y": 839,
        "w": 1172,
        "h": 162
    },
    {
        "id": "f630143dd6413aac",
        "type": "group",
        "z": "8b4b6895c0ec29ec",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "d7e91528f5c8f1d6",
            "f406a76e56b92d05",
            "43ddc5a441c4fd3f",
            "92a4b7e1ddc01aaf",
            "cbc94139020ca0b7",
            "27c12a21983f359e",
            "f6566f17a1e9b78e"
        ],
        "x": 34,
        "y": 479,
        "w": 912,
        "h": 242
    },
    {
        "id": "f69756401f15d7b4",
        "type": "group",
        "z": "8b4b6895c0ec29ec",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "890050b7a3592bf1",
            "6b73945a30a3b156",
            "205cfd1b6882a75f",
            "3472ec7018175754",
            "544ae34808a17523",
            "d68e0db08f5b39fe",
            "1c0c1219794c876a",
            "82f12a1e14f33b59",
            "9ab5c8b230048e8b",
            "85525cb2f906b575"
        ],
        "x": 34,
        "y": 39,
        "w": 1472,
        "h": 262
    },
    {
        "id": "a83bb00d46efe804",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "5bdc6b89364fd15a",
            "9bca7655eb1d89cf",
            "c7fe99b0e0506601",
            "8c0e6a2a0a04fcd7",
            "340a8ade18808c45",
            "cf58eb77138066b2",
            "9dd0a2d0ffb6a743",
            "4215a3196c228639",
            "c58252a4cb097661",
            "579c8c19ccab0937",
            "a74d42b7ae961652",
            "6f32fc52a4d53df8",
            "3dd25f169354ef22",
            "ad34ea44766153db"
        ],
        "x": 134,
        "y": 659,
        "w": 1272,
        "h": 402
    },
    {
        "id": "e63633ec18181ba7",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "f4b7c4c243db620d",
            "837b88b53ec5549a",
            "ac6ab4bb77d73dc4",
            "0faf666bf00276e9",
            "2bcc56e6d241c3d9",
            "feddd1768611c551",
            "b111193564f5a7a0",
            "161f3cee4bd60724",
            "b1e8ab6feba986c9",
            "4b72a159e1e82517",
            "c79cb601a8c0ab17"
        ],
        "x": 134,
        "y": 1099,
        "w": 952,
        "h": 342
    },
    {
        "id": "bc92f0b2168e67b1",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "9f34def0af02efeb",
            "80e1d2d095f19693",
            "ac5d35d999fc40b9",
            "cd811a5da6dea1c9"
        ],
        "x": 1174,
        "y": 1079,
        "w": 512,
        "h": 122
    },
    {
        "id": "2024311963b7a70e",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "97e2f252303bfcf3",
            "a1e6f1282aa6e63a",
            "b70ae83c222fa7da"
        ],
        "x": 1174,
        "y": 1299,
        "w": 532,
        "h": 122
    },
    {
        "id": "7ceda8dc6f5a8d60",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "f86871afbc03993e",
            "91b03956f65107e7",
            "7a6d7007d9d5ec67",
            "ccf03d13258bb4e3"
        ],
        "x": 134,
        "y": 1499,
        "w": 792,
        "h": 142
    },
    {
        "id": "96cafb8e88dad064",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "e2b27e9faf37bd1e",
            "6331f7057ebfd37c",
            "bc8a6edecc1a9a5c",
            "c74fb766b19e2bf1"
        ],
        "x": 134,
        "y": 1679,
        "w": 832,
        "h": 142
    },
    {
        "id": "96faa29525ade8f0",
        "type": "group",
        "z": "f3ec5d556e86f8d0",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "f8aa15da571b3aae",
            "dfeaa41a75adbf51",
            "f4c6348e4bde4c20",
            "5870cb8ac8846724",
            "4369b98b6d58fe86",
            "99f3e6c97f2c0d2b",
            "02673478ac90323a",
            "1dfa349788a1a948",
            "9e93acca6dde891c",
            "a11c3ee5796d07f2",
            "f03d05829f9254f9",
            "a3534a12592a4f1e",
            "c1f7e764f490f914",
            "4bdef8d87b5da823",
            "b15078312d3e61f5",
            "da8da29f2b800fa5"
        ],
        "x": 134,
        "y": 59,
        "w": 672,
        "h": 542
    },
    {
        "id": "cc0e458f8d09ebf0",
        "type": "group",
        "z": "6f07332b8253050a",
        "g": "44c6bd61d9aa5d1d",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "675e506f8cc3e3c6",
            "c11317ac5ddaf481",
            "4f1f03d9ace5b214",
            "6a3261bd5d1634ff",
            "7956c7f15c937519",
            "2e5f3a887f317523",
            "a983e99d613458db",
            "1d8b42fd0952e51b",
            "2c24dc53b6049b78",
            "3a4f65d2f43899bf",
            "1e0fd409ba1a6b71",
            "31536652b0e65c1c",
            "3327ecc679f21bed",
            "2309213c36dd8fd8",
            "a58539412bbfe6b2"
        ],
        "x": 74,
        "y": 1039,
        "w": 1462,
        "h": 662
    },
    {
        "id": "de154b3cccf614e0",
        "type": "group",
        "z": "6f07332b8253050a",
        "g": "44c6bd61d9aa5d1d",
        "style": {
            "stroke": "#3a3a3a",
            "stroke-opacity": "1",
            "fill": "#1e1e1e",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "6cddfd33ec05b6b7",
            "515a805e2750f3bd",
            "372b9594ce982517",
            "bfe3c6c9b8f1ea94",
            "dc294b3548567c18",
            "17d454ff68066317",
            "c371b220cd83bc24",
            "f1340eb46d54b7e1",
            "a24bdb4ce4be3d99",
            "87e764dac83fb351",
            "67088a3f2dedd67b",
            "b057c4c81f9a5137"
        ],
        "x": 74,
        "y": 1739,
        "w": 1012,
        "h": 582
    },
    {
        "id": "5999f1d09afe1039",
        "type": "mqtt-broker",
        "name": "mqtt-node-main",
        "broker": "127.0.0.1",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "6f6f2d0bf9d4b5e3",
        "type": "sqlitedb",
        "db": "/home/pi/sqlite-storage/sqlite",
        "mode": "RWC"
    },
    {
        "id": "24769b923875c2f1",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ffee29fff6f243e7",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "true",
            "allowTempTheme": "none",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "df6f4c796677e729",
        "type": "ui_group",
        "name": "Manual Game Controls",
        "tab": "24769b923875c2f1",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "efa02099cf2bc4a1",
        "type": "ui_group",
        "name": "Debug Screen",
        "tab": "24769b923875c2f1",
        "order": 2,
        "disp": false,
        "width": "17",
        "collapse": false
    },
    {
        "id": "8cc3fd17a6d665c5",
        "type": "ui_tab",
        "name": "Field Config",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a5991f3b10b51e7c",
        "type": "ui_group",
        "name": "Default",
        "tab": "8cc3fd17a6d665c5",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "f74888d7aab3b07a",
        "type": "ui_group",
        "name": "Match Info",
        "tab": "eb575f243f1f5772",
        "order": 1,
        "disp": true,
        "width": "5",
        "collapse": false
    },
    {
        "id": "039ab4d581c7b5da",
        "type": "ui_group",
        "name": "Building Window Statuses",
        "tab": "eb575f243f1f5772",
        "order": 2,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "5ff2841845e80e0c",
        "type": "ui_group",
        "name": "Manual Overrides",
        "tab": "eb575f243f1f5772",
        "order": 3,
        "disp": true,
        "width": "4",
        "collapse": false
    },
    {
        "id": "eb575f243f1f5772",
        "type": "ui_tab",
        "name": "Field Display",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "5d736b3773c1b6c1",
        "type": "ui_group",
        "name": "Scoring",
        "tab": "eb575f243f1f5772",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "bcef7098b2bcab87",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "New Match",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 200,
        "wires": [
            [
                "4eb277af36ef1fe2"
            ]
        ]
    },
    {
        "id": "4eb277af36ef1fe2",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 7",
        "links": [
            "a5a1bd31c468f86b",
            "d36ef2fad2d08d5f"
        ],
        "x": 335,
        "y": 200,
        "wires": []
    },
    {
        "id": "c2285509eb863856",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Current Global.Matchnum",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "matchnum",
        "payloadType": "global",
        "x": 240,
        "y": 760,
        "wires": [
            [
                "e7fdc24bcd360c08"
            ]
        ]
    },
    {
        "id": "e7fdc24bcd360c08",
        "type": "debug",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Debug Manual Game Flows",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 760,
        "wires": []
    },
    {
        "id": "372c7a6bec7d1005",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "=== Original Manual Game Control Flows ",
        "info": "",
        "x": 220,
        "y": 80,
        "wires": []
    },
    {
        "id": "58e0133d504974b2",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Start a new match ",
        "info": "Creates a new match in the Game table\nSets the global matchnum for all flows to use",
        "x": 200,
        "y": 160,
        "wires": []
    },
    {
        "id": "5eef5dc3824c88f6",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Dump to Debug the Current match num",
        "info": "",
        "x": 260,
        "y": 720,
        "wires": []
    },
    {
        "id": "63b6bb6097222b63",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Dump to Debug Latest Match",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 860,
        "wires": [
            [
                "c30231dee65db09d"
            ]
        ]
    },
    {
        "id": "c30231dee65db09d",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 9",
        "links": [
            "18a554bcaa2360e7",
            "ca18ad730b62784e"
        ],
        "x": 475,
        "y": 860,
        "wires": []
    },
    {
        "id": "1f2c1fa133c6065f",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Dump to Debug the Current match num",
        "info": "",
        "x": 260,
        "y": 820,
        "wires": []
    },
    {
        "id": "baf9c9e56c55af9c",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Increment Hit (RBO, Side 1)",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 280,
        "wires": [
            [
                "803409c672685edb"
            ]
        ]
    },
    {
        "id": "803409c672685edb",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Values ",
        "func": "var o = {};\n\no.num_hits = 1;\no.BUILDING_NAME = 'RTO';\no.side_id = 1;\n\nmsg.payload = o;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 280,
        "wires": [
            [
                "02b8a461b8de262a"
            ]
        ]
    },
    {
        "id": "02b8a461b8de262a",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 48",
        "links": [
            "af55cd6eb001ec61"
        ],
        "x": 665,
        "y": 280,
        "wires": []
    },
    {
        "id": "4d99b7cae64f909e",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Increment Hit (Building RBO, Side 1)",
        "info": "Creates a new match in the Game table\nSets the global matchnum for all flows to use",
        "x": 250,
        "y": 240,
        "wires": []
    },
    {
        "id": "37b9350256bf1cc0",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Drop Ball (Building RBO)",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 360,
        "wires": [
            [
                "a079891af81acf69",
                "779d72582a45aa82"
            ]
        ]
    },
    {
        "id": "a079891af81acf69",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Values ",
        "func": "var o ={};\n\no.num_drops = 1;\no.num_hits = 1;\no.BUILDING_NAME = 'RBO';\n\nmsg.payload = o;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 360,
        "wires": [
            [
                "c854b1ceacdd7cbd"
            ]
        ]
    },
    {
        "id": "c854b1ceacdd7cbd",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 49",
        "links": [
            "63f807f3f36abd11"
        ],
        "x": 665,
        "y": 360,
        "wires": []
    },
    {
        "id": "3f886858a14bf1f8",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Drop Ball (Building RBO)",
        "info": "",
        "x": 220,
        "y": 320,
        "wires": []
    },
    {
        "id": "eb9f4d74e26f9854",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Trench Bags",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 460,
        "wires": [
            [
                "95d8b751de777e8d"
            ]
        ]
    },
    {
        "id": "95d8b751de777e8d",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Values ",
        "func": "var o = {};\n\no.num_bags = 3;\no.BUILDING_NAME = 'RBO';\n\nmsg.payload = o;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 460,
        "wires": [
            [
                "a2c40ebd42a054a9"
            ]
        ]
    },
    {
        "id": "a2c40ebd42a054a9",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 50",
        "links": [
            "0d084e688f622348"
        ],
        "x": 655,
        "y": 460,
        "wires": []
    },
    {
        "id": "8430477f261fe058",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Trench Bags (RBO, bags=3)",
        "info": "",
        "x": 240,
        "y": 420,
        "wires": []
    },
    {
        "id": "cfa55283398d5d96",
        "type": "inject",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Fire Score",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 600,
        "wires": [
            [
                "6c96858cd3695db2"
            ]
        ]
    },
    {
        "id": "6c96858cd3695db2",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Values ",
        "func": "var o = {};\n\no.FCS = 3;\no.BUILDING_NAME = 'RBO';\n\nmsg.payload = o;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 600,
        "wires": [
            [
                "711e25dc20dbd9af"
            ]
        ]
    },
    {
        "id": "711e25dc20dbd9af",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 51",
        "links": [
            "c5098de218c47d8f"
        ],
        "x": 655,
        "y": 600,
        "wires": []
    },
    {
        "id": "6b33a4946c072763",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "Set Fire Score (RBO, FCS=3)",
        "info": "",
        "x": 230,
        "y": 560,
        "wires": []
    },
    {
        "id": "779d72582a45aa82",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "(p)Set Values ",
        "func": "var o = {};\n\no.num_hits = 3;\no.BUILDING_NAME = 'RBI';\no.side_id = 1;\n\nmsg.payload = o;\nmsg.test = o.BUILDING_NAME;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 400,
        "wires": [
            [
                "7684f0009e5ef352"
            ]
        ]
    },
    {
        "id": "7684f0009e5ef352",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "59950207257cb065",
        "name": "link out 48",
        "links": [
            "af55cd6eb001ec61"
        ],
        "x": 665,
        "y": 400,
        "wires": []
    },
    {
        "id": "b199686f052fe77f",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Publish Firescore To Specific Node -- this is on the Dashboard ",
        "info": "",
        "x": 1420,
        "y": 460,
        "wires": []
    },
    {
        "id": "f1896d48a659a2cb",
        "type": "ui_form",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "UpdateFireScore",
        "label": "Update Firescore to Node (Node ID = RBO, LBO, etc)",
        "group": "df6f4c796677e729",
        "order": 3,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Building Name",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Fire Score",
                "value": "FCS",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": "",
            "FCS": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1290,
        "y": 580,
        "wires": [
            [
                "a29505e70d7b9ece",
                "84a25c5ebff798fb",
                "cc9c7da6d3ec6e77"
            ]
        ]
    },
    {
        "id": "c870ec8282153101",
        "type": "ui_text",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "group": "efa02099cf2bc4a1",
        "order": 1,
        "width": "6",
        "height": "5",
        "name": "FullRecordGame",
        "label": "Debug ",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 2110,
        "y": 160,
        "wires": []
    },
    {
        "id": "a29505e70d7b9ece",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 22",
        "links": [
            "c5098de218c47d8f"
        ],
        "x": 1825,
        "y": 560,
        "wires": []
    },
    {
        "id": "70c33d06c1d6b167",
        "type": "ui_button",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "group": "df6f4c796677e729",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "View Latest Match",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1310,
        "y": 260,
        "wires": [
            [
                "277d12403d6f9f63"
            ]
        ]
    },
    {
        "id": "28eb2bc55dcddb70",
        "type": "link in",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Dashboard Full Dump",
        "links": [
            "fa60c2b1c4bd6432",
            "ad3020e3fc7099e8"
        ],
        "x": 1935,
        "y": 160,
        "wires": [
            [
                "c870ec8282153101"
            ]
        ]
    },
    {
        "id": "277d12403d6f9f63",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 23",
        "links": [
            "18a554bcaa2360e7"
        ],
        "x": 1495,
        "y": 260,
        "wires": []
    },
    {
        "id": "8c392ecc9a35c3eb",
        "type": "ui_form",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Increment Laser Hit",
        "label": "Increment Laser Hit",
        "group": "df6f4c796677e729",
        "order": 5,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Building Name",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Building Side",
                "value": "side_id",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": "",
            "side_id": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1290,
        "y": 720,
        "wires": [
            [
                "628745f67dade8c1"
            ]
        ]
    },
    {
        "id": "a9c50f46b67e9896",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 24",
        "links": [
            "af55cd6eb001ec61"
        ],
        "x": 1815,
        "y": 720,
        "wires": []
    },
    {
        "id": "628745f67dade8c1",
        "type": "json",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1490,
        "y": 720,
        "wires": [
            [
                "a17a899f16b9d084"
            ]
        ]
    },
    {
        "id": "a17a899f16b9d084",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "add numhits 1",
        "func": "var o = msg.payload;\no['num_hits'] = 1;\nmsg.payload = o;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1640,
        "y": 720,
        "wires": [
            [
                "a9c50f46b67e9896",
                "84a25c5ebff798fb",
                "280f249d698f4e0c"
            ]
        ]
    },
    {
        "id": "d12eb5d4f1efff54",
        "type": "ui_form",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Increment Ball Drop",
        "label": "Increment Ball Drop Hit",
        "group": "df6f4c796677e729",
        "order": 6,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Building Name",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1300,
        "y": 800,
        "wires": [
            [
                "04f926d3d2ee0cd5"
            ]
        ]
    },
    {
        "id": "75c5f224f591b111",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 25",
        "links": [
            "63f807f3f36abd11"
        ],
        "x": 1815,
        "y": 800,
        "wires": []
    },
    {
        "id": "04f926d3d2ee0cd5",
        "type": "json",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1490,
        "y": 800,
        "wires": [
            [
                "ec3ec501f79d3d62"
            ]
        ]
    },
    {
        "id": "ec3ec501f79d3d62",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "add drops 1",
        "func": "var o = msg.payload;\no['num_drops'] = 1;\nmsg.payload = o;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 800,
        "wires": [
            [
                "75c5f224f591b111",
                "84a25c5ebff798fb"
            ]
        ]
    },
    {
        "id": "11e4b52900aedf18",
        "type": "ui_form",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Increment Fire Score",
        "label": "Increment Fire Score",
        "group": "df6f4c796677e729",
        "order": 4,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Building Name",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1300,
        "y": 640,
        "wires": [
            [
                "e2b1eeb7b8ba3724"
            ]
        ]
    },
    {
        "id": "37c9658f21fde304",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 26",
        "links": [
            "b49a77ff09745d6d"
        ],
        "x": 1815,
        "y": 640,
        "wires": []
    },
    {
        "id": "e2b1eeb7b8ba3724",
        "type": "json",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1490,
        "y": 640,
        "wires": [
            [
                "445fcf6390a71317"
            ]
        ]
    },
    {
        "id": "445fcf6390a71317",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "add firescore 1",
        "func": "var o = msg.payload;\no['FCS'] = 1;\n//o['BUILDING_NAME'] = o['BUILDING_NAME'];\nmsg.topic = \"nodered/firescore/\" + o['BUILDING_NAME'];\nmsg.payload = o;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1640,
        "y": 640,
        "wires": [
            [
                "37c9658f21fde304",
                "84a25c5ebff798fb",
                "cc9c7da6d3ec6e77"
            ]
        ]
    },
    {
        "id": "2cf306418f5ec1a7",
        "type": "ui_button",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "StartNewMatch",
        "group": "df6f4c796677e729",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Start New Match",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1300,
        "y": 200,
        "wires": [
            [
                "f10fa9da70498f8c",
                "6243bfa8703f32ca"
            ]
        ]
    },
    {
        "id": "6243bfa8703f32ca",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 27",
        "links": [
            "a5a1bd31c468f86b",
            "d36ef2fad2d08d5f"
        ],
        "x": 1495,
        "y": 200,
        "wires": []
    },
    {
        "id": "8f1d410dda1e4f81",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 32",
        "links": [
            "18a554bcaa2360e7"
        ],
        "x": 2475,
        "y": 640,
        "wires": []
    },
    {
        "id": "84a25c5ebff798fb",
        "type": "delay",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 2340,
        "y": 640,
        "wires": [
            [
                "8f1d410dda1e4f81",
                "1fba5de08a2e1d6f"
            ]
        ]
    },
    {
        "id": "71a84d7f0e04039b",
        "type": "ui_ui_control",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "events": "change",
        "x": 2580,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "1fba5de08a2e1d6f",
        "type": "delay",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 2340,
        "y": 700,
        "wires": [
            [
                "28b06e0ed349f7f2"
            ]
        ]
    },
    {
        "id": "28b06e0ed349f7f2",
        "type": "change",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2360,
        "y": 760,
        "wires": [
            [
                "71a84d7f0e04039b"
            ]
        ]
    },
    {
        "id": "cc9c7da6d3ec6e77",
        "type": "delay",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 1940,
        "y": 600,
        "wires": [
            [
                "9225979b748b64fa"
            ]
        ]
    },
    {
        "id": "9225979b748b64fa",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 34",
        "links": [
            "5329a59e7e76c7c0"
        ],
        "x": 2085,
        "y": 600,
        "wires": []
    },
    {
        "id": "7bfb5dc8f61f8b2e",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Wait then publish to MQTT",
        "info": "",
        "x": 1990,
        "y": 560,
        "wires": []
    },
    {
        "id": "3f61a9a29423178a",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Wait then publish to Update and Refresh Game Dump",
        "info": "",
        "x": 2480,
        "y": 580,
        "wires": []
    },
    {
        "id": "7777761941ca1618",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Text Box containing full Game Details",
        "info": "",
        "x": 2050,
        "y": 120,
        "wires": []
    },
    {
        "id": "280f249d698f4e0c",
        "type": "debug",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 840,
        "wires": []
    },
    {
        "id": "12d960ab4b6ae7fc",
        "type": "ui_button",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "group": "df6f4c796677e729",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "View Latest Match Hits, Drops, etc",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1360,
        "y": 320,
        "wires": [
            [
                "b988ed62abb07361"
            ]
        ]
    },
    {
        "id": "b988ed62abb07361",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 42",
        "links": [
            "ca18ad730b62784e"
        ],
        "x": 1545,
        "y": 320,
        "wires": []
    },
    {
        "id": "35c2141922736ecd",
        "type": "ui_form",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "Set Bag Count",
        "label": "Set Bags",
        "group": "df6f4c796677e729",
        "order": 6,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Building Name",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Total Bags",
                "value": "num_bags",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": "",
            "num_bags": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1280,
        "y": 920,
        "wires": [
            [
                "43f3e3127047706d"
            ]
        ]
    },
    {
        "id": "a0893a9b1c6e7557",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 44",
        "links": [
            "0d084e688f622348"
        ],
        "x": 1815,
        "y": 920,
        "wires": []
    },
    {
        "id": "43f3e3127047706d",
        "type": "json",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1490,
        "y": 920,
        "wires": [
            [
                "cf29e65e98345a3c"
            ]
        ]
    },
    {
        "id": "cf29e65e98345a3c",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "add bags 1",
        "func": "var o = msg.payload;\nmsg.payload = o;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 920,
        "wires": [
            [
                "a0893a9b1c6e7557"
            ]
        ]
    },
    {
        "id": "c52350773fd926d5",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "link out 45",
        "links": [
            "54f48d7af3ce8a94",
            "8f95daa740229529"
        ],
        "x": 1855,
        "y": 140,
        "wires": []
    },
    {
        "id": "f10fa9da70498f8c",
        "type": "delay",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 1540,
        "y": 140,
        "wires": [
            [
                "f964e3d3a6ee8191"
            ]
        ]
    },
    {
        "id": "f964e3d3a6ee8191",
        "type": "change",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "activematch",
                "pt": "global",
                "to": "1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1720,
        "y": 140,
        "wires": [
            [
                "c52350773fd926d5"
            ]
        ]
    },
    {
        "id": "e0440fb8e9a44898",
        "type": "ui_button",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "StartNewMatch",
        "group": "df6f4c796677e729",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "End Match",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1300,
        "y": 380,
        "wires": [
            [
                "4d6ebb703ebf233d"
            ]
        ]
    },
    {
        "id": "4d6ebb703ebf233d",
        "type": "change",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "activematch",
                "pt": "global",
                "to": "0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1520,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "396bd91435c9a4fe",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "229d7911730c710f",
        "name": "==== Original \"Manual Game Details\" Dashboard",
        "info": "",
        "x": 1340,
        "y": 80,
        "wires": []
    },
    {
        "id": "675e506f8cc3e3c6",
        "type": "mqtt out",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "window-off-mqtt",
        "topic": "windowoff",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 920,
        "y": 1660,
        "wires": []
    },
    {
        "id": "c11317ac5ddaf481",
        "type": "switch",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 1640,
        "wires": [
            [
                "2e5f3a887f317523"
            ],
            [
                "675e506f8cc3e3c6"
            ]
        ]
    },
    {
        "id": "4f1f03d9ace5b214",
        "type": "mqtt out",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "window-on-mqtt",
        "topic": "windowon",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 920,
        "y": 1600,
        "wires": []
    },
    {
        "id": "6a3261bd5d1634ff",
        "type": "inject",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "cc0e458f8d09ebf0",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 240,
        "y": 1640,
        "wires": [
            [
                "7956c7f15c937519"
            ]
        ]
    },
    {
        "id": "7956c7f15c937519",
        "type": "function",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Create flip/flop",
        "func": "var count = context.get(\"counter\") || 0;\ncount = (count + 1) % 2;\ncontext.set(\"counter\", count);\nmsg.payload = count;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "if (context.get(\"counter\") === undefined) {\n    context.set(\"counter\", 0)\n}",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1640,
        "wires": [
            [
                "c11317ac5ddaf481"
            ]
        ]
    },
    {
        "id": "2e5f3a887f317523",
        "type": "change",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "ONMORETIME",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1600,
        "wires": [
            [
                "4f1f03d9ace5b214"
            ]
        ]
    },
    {
        "id": "a983e99d613458db",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Heartbeat - sending 1/0 flip flop",
        "info": "",
        "x": 300,
        "y": 1560,
        "wires": []
    },
    {
        "id": "1d8b42fd0952e51b",
        "type": "link in",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Game Reset Message - MQTT Out",
        "links": [
            "7d1c946cf1d71468",
            "0554919775c9921e"
        ],
        "x": 215,
        "y": 1340,
        "wires": [
            [
                "2c24dc53b6049b78"
            ]
        ]
    },
    {
        "id": "2c24dc53b6049b78",
        "type": "mqtt out",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "nodered/reset/match",
        "topic": "nodered/reset/match",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 950,
        "y": 1340,
        "wires": []
    },
    {
        "id": "3a4f65d2f43899bf",
        "type": "link in",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "MQTT Send Firescore to Node",
        "links": [
            "456155bf98b91e2c",
            "530bf25ea8a65ce6",
            "a4f26d2999f4172e"
        ],
        "x": 215,
        "y": 1200,
        "wires": [
            [
                "1e0fd409ba1a6b71",
                "2309213c36dd8fd8"
            ]
        ]
    },
    {
        "id": "1e0fd409ba1a6b71",
        "type": "mqtt out",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "cc0e458f8d09ebf0",
        "name": "msg.topic = \"nodered/firescore/\"+nodeid;",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1010,
        "y": 1200,
        "wires": []
    },
    {
        "id": "31536652b0e65c1c",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Publish Fire score to a Node",
        "info": "",
        "x": 310,
        "y": 1140,
        "wires": []
    },
    {
        "id": "3327ecc679f21bed",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Publish New Match to All",
        "info": "",
        "x": 300,
        "y": 1280,
        "wires": []
    },
    {
        "id": "2309213c36dd8fd8",
        "type": "debug",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "Publish MQTT firescore",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1380,
        "y": 1280,
        "wires": []
    },
    {
        "id": "a58539412bbfe6b2",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "cc0e458f8d09ebf0",
        "name": "=== Original MQTT Output References",
        "info": "",
        "x": 250,
        "y": 1080,
        "wires": []
    },
    {
        "id": "6cddfd33ec05b6b7",
        "type": "mqtt in",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "de154b3cccf614e0",
        "name": "edgenode/laserhit/#",
        "topic": "edgenode/laserhit/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 250,
        "y": 1880,
        "wires": [
            [
                "515a805e2750f3bd",
                "372b9594ce982517"
            ]
        ]
    },
    {
        "id": "515a805e2750f3bd",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "link out 12",
        "links": [
            "af55cd6eb001ec61"
        ],
        "x": 555,
        "y": 1880,
        "wires": []
    },
    {
        "id": "372b9594ce982517",
        "type": "debug",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "MQTT Input From Field Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 1960,
        "wires": []
    },
    {
        "id": "bfe3c6c9b8f1ea94",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "=== Original MQTT Input References",
        "info": "",
        "x": 240,
        "y": 1780,
        "wires": []
    },
    {
        "id": "dc294b3548567c18",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "NOTE: Config input from Field is handled in Field Config flows tab",
        "info": "",
        "x": 400,
        "y": 2280,
        "wires": []
    },
    {
        "id": "17d454ff68066317",
        "type": "comment",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "Incoming Laser Hit from Edge Node",
        "info": "",
        "x": 300,
        "y": 1840,
        "wires": []
    },
    {
        "id": "c371b220cd83bc24",
        "type": "mqtt in",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "de154b3cccf614e0",
        "name": "edgenode/balldrop/#",
        "topic": "edgenode/balldrop/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 260,
        "y": 2000,
        "wires": [
            [
                "f1340eb46d54b7e1",
                "372b9594ce982517"
            ]
        ]
    },
    {
        "id": "f1340eb46d54b7e1",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "link out 39",
        "links": [
            "63f807f3f36abd11",
            "6a99a43b23841ade",
            "b46550ea0f878eaf"
        ],
        "x": 555,
        "y": 2000,
        "wires": []
    },
    {
        "id": "a24bdb4ce4be3d99",
        "type": "mqtt in",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "de154b3cccf614e0",
        "name": "edgenode/troughbags/#",
        "topic": "edgenode/troughbags/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 270,
        "y": 2080,
        "wires": [
            [
                "372b9594ce982517",
                "87e764dac83fb351"
            ]
        ]
    },
    {
        "id": "87e764dac83fb351",
        "type": "link out",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "link out 40",
        "links": [
            "0d084e688f622348"
        ],
        "x": 555,
        "y": 2080,
        "wires": []
    },
    {
        "id": "67088a3f2dedd67b",
        "type": "mqtt in",
        "z": "6f07332b8253050a",
        "d": true,
        "g": "de154b3cccf614e0",
        "name": "edgenode/latesttare/#",
        "topic": "edgenode/latesttare/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 2180,
        "wires": [
            [
                "b057c4c81f9a5137"
            ]
        ]
    },
    {
        "id": "b057c4c81f9a5137",
        "type": "debug",
        "z": "6f07332b8253050a",
        "g": "de154b3cccf614e0",
        "name": "Dump Latest Tares From Field",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2180,
        "wires": []
    },
    {
        "id": "5329a59e7e76c7c0",
        "type": "link in",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "Publish Latest Fire Score to Node",
        "links": [
            "9225979b748b64fa",
            "6f7cb6f71184bd2b"
        ],
        "x": 125,
        "y": 120,
        "wires": [
            [
                "ed62e9e4477e7eed"
            ]
        ]
    },
    {
        "id": "ddad0b88779e31bf",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "Retrieve Latest Fire Score for NodeId",
        "func": "\nvar o = msg.payload;\nvar matchid = global.get(\"matchnum\");\nvar nodeid = o.BUILDING_NAME;\nvar newMsg = {\n    \"topic\": \"SELECT FCS FROM Buildings WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME='\" + nodeid+\"';\",\n    \"nodeid\":nodeid\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 120,
        "wires": [
            [
                "3bf9e0f865abb5b8"
            ]
        ]
    },
    {
        "id": "3bf9e0f865abb5b8",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 750,
        "y": 120,
        "wires": [
            [
                "e84e140d4b501f18"
            ]
        ]
    },
    {
        "id": "ed62e9e4477e7eed",
        "type": "json",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 230,
        "y": 120,
        "wires": [
            [
                "ddad0b88779e31bf"
            ]
        ]
    },
    {
        "id": "e84e140d4b501f18",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "Assemble message",
        "func": "var o = msg.payload\nvar firescore = o[0].FCS;\nvar nodeid = msg.nodeid;\nvar t = \"{ \\\"BUILDING_NAME\\\": \\\"\" + nodeid + \"\\\", \\\"FCS\\\": \" + firescore + \", \\\"timestamp\\\": \" + 1000 + \"}\";\nmsg.payload = t;\n//nodered/firescore/[node id]\nmsg.topic = \"nodered/firescore/\" + nodeid;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 120,
        "wires": [
            [
                "530bf25ea8a65ce6"
            ]
        ]
    },
    {
        "id": "530bf25ea8a65ce6",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "link out 35",
        "links": [
            "3a4f65d2f43899bf"
        ],
        "x": 1115,
        "y": 120,
        "wires": []
    },
    {
        "id": "cc89dbf72d1f6006",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "208849015b030c99",
        "name": "Retrieve then call to publish Latest Firescore to edge nodes",
        "info": "",
        "x": 310,
        "y": 60,
        "wires": []
    },
    {
        "id": "165f13f0f929f16e",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "link out 36",
        "links": [
            "48af91ab4809047a",
            "50d2b3036d95d6fb"
        ],
        "x": 575,
        "y": 280,
        "wires": []
    },
    {
        "id": "456155bf98b91e2c",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "link out 37",
        "links": [
            "3a4f65d2f43899bf"
        ],
        "x": 575,
        "y": 360,
        "wires": []
    },
    {
        "id": "dd55547c4747b6b1",
        "type": "link in",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "Callback Finished New Match DB",
        "links": [
            "7d1c946cf1d71468",
            "0554919775c9921e"
        ],
        "x": 125,
        "y": 280,
        "wires": [
            [
                "e65f24f080169b20"
            ]
        ]
    },
    {
        "id": "e65f24f080169b20",
        "type": "change",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "Set Debug Complete New Match",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Call Back Complete for New Match",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 280,
        "wires": [
            [
                "165f13f0f929f16e"
            ]
        ]
    },
    {
        "id": "754ef2450038c273",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "New Match Call backs to set global.matchnum and notify field",
        "info": "Creates a new match in the Game table\nSets the global matchnum for all flows to use",
        "x": 320,
        "y": 240,
        "wires": []
    },
    {
        "id": "a67d3036cd8b2a23",
        "type": "link in",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "Callback Finished Set global.matchnum",
        "links": [
            "50a7d4620d30956a",
            "525f1f19c2aa78a9"
        ],
        "x": 125,
        "y": 360,
        "wires": [
            [
                "821e9e89a9ce075d"
            ]
        ]
    },
    {
        "id": "821e9e89a9ce075d",
        "type": "change",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "Set Notify Field",
        "rules": [],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 360,
        "wires": [
            [
                "456155bf98b91e2c",
                "3719854fdfed232d"
            ]
        ]
    },
    {
        "id": "3719854fdfed232d",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "31e8c747379a1719",
        "name": "link out 38",
        "links": [
            "4c16c39c21c351b0",
            "cacf2baa95692221"
        ],
        "x": 575,
        "y": 400,
        "wires": []
    },
    {
        "id": "58637d97cec1ab0f",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Retrieve Latest Activity From Current Match",
        "func": "\nvar matchid = global.get(\"matchnum\");\nvar newMsg = {\n    \"topic\": \"SELECT B.MATCH_NUM, B.BUILDING_NAME, BWS.BUILDING_SIDE, B.NUM_BAGS, B.NUM_DROPS, BWS.NUM_HITS FROM Buildings B INNER JOIN BuildingWindowStatus BWS \"\n        + \"on B.MATCH_NUM = BWS.MATCH_NUM AND B.BUILDING_NAME=BWS.BUILDING_NAME \"\n        + \"WHERE B.MATCH_NUM = \" + matchid + \";\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 580,
        "wires": [
            [
                "17bbf4fea9206322"
            ]
        ]
    },
    {
        "id": "17bbf4fea9206322",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1210,
        "y": 580,
        "wires": [
            [
                "9aabfa9c28103459",
                "16c9d84b48e02137"
            ]
        ]
    },
    {
        "id": "079efb4aca734ee4",
        "type": "switch",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Check is Active Match",
        "property": "activematch",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 580,
        "wires": [
            [
                "58637d97cec1ab0f",
                "4ed8add72706ca62"
            ],
            [
                "d87a3df5ff53208e"
            ]
        ],
        "info": "Active match is set when the match is created and set to 1, there is a stop button to stop the active match"
    },
    {
        "id": "ffb549e9c8fb8991",
        "type": "debug",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Is Game Active",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 700,
        "wires": []
    },
    {
        "id": "54f48d7af3ce8a94",
        "type": "link in",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Start Game Timer",
        "links": [
            "c52350773fd926d5",
            "c8663193fd1a2a4c"
        ],
        "x": 125,
        "y": 580,
        "wires": [
            [
                "42e79718ce6113ea"
            ]
        ]
    },
    {
        "id": "42e79718ce6113ea",
        "type": "trigger",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Global Timer",
        "op1": "",
        "op2": "0",
        "op1type": "date",
        "op2type": "str",
        "duration": "-15",
        "extend": false,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 270,
        "y": 580,
        "wires": [
            [
                "079efb4aca734ee4"
            ]
        ]
    },
    {
        "id": "d87a3df5ff53208e",
        "type": "change",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Match is not active",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Match is not active",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 700,
        "wires": [
            [
                "ffb549e9c8fb8991"
            ]
        ]
    },
    {
        "id": "4ed8add72706ca62",
        "type": "change",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Match is active",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Match is active",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 660,
        "wires": [
            [
                "ffb549e9c8fb8991"
            ]
        ]
    },
    {
        "id": "9aabfa9c28103459",
        "type": "debug",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Game Update Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1520,
        "y": 660,
        "wires": []
    },
    {
        "id": "e8fcbe1eaf3b0d0b",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Calculate Scores",
        "func": "var o = msg.payload\n/*Results set inbound ( see what is calling this node - usuall results from a database call) \nwill be a list of buildings for the match, with the following data (all buidlings in the match with their data fields) \n\n\n[{\"MATCH_NUM\":5,\"BUILDING_NAME\":\"LTO\",\"BUILDING_SIDE\":1,\"NUM_BAGS\":0,\"NUM_DROPS\":1,\"NUM_HITS\":0},\n{\"MATCH_NUM\":5,\"BUILDING_NAME\":\"LTO\",\"BUILDING_SIDE\":2,\"NUM_BAGS\":0,\"NUM_DROPS\":1,\"NUM_HITS\":0},\n{\"MATCH_NUM\":5,\"BUILDING_NAME\":\"LTO\",\"BUILDING_SIDE\":3,\"NUM_BAGS\":0,\"NUM_DROPS\":1,\"NUM_HITS\":0},\n... \n*/\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\no.forEach((element, index, array) => {\n    debug1 = debug1 + element.BUILDING_NAME;\n    debug1 = debug1 + \" | \";\n    debug1 = debug1 + \"NUM_HITS:\" +  element.NUM_HITS;\n    debug1 = debug1 + \" | \";\n    debug1 = debug1 + \"\\r \";\n  \n});\n\n\n//just some hacky code to iterate over the results and set some data fields\nvar HitsByBuilding = new Map();\nvar debug = \"\";\no.forEach((element, index, array) => {\n    var name = element.BUILDING_NAME;\n    var side = element.BUILDING_SIDE;\n    var numhits = element.NUM_HITS;\n    if (numhits>1) {\n        debug += debug + \" | \" + name + \":\" + numhits;\n        HitsByBuilding.set(name, numhits);\n    }\n\n});\n\n//BOGUS PLACE HOLDER -- more hacky code to show what you need to set \n//to send to both a database update, and on to the arduinos via mqtt\nvar updates = new Array();\n\nif (HitsByBuilding.has(\"RBI\")) {\n    var fireScoreBuilding1 = new Map();\n    fireScoreBuilding1.set(\"BUILDING_NAME\",\"RBI\");\n    fireScoreBuilding1.set(\"FS\", HitsByBuilding.get(\"RBI\"));    \n    updates.push(fireScoreBuilding1);\n}\n \nvar fireScoreBuilding2 = new Map();\nfireScoreBuilding2.set(\"BUILDING_NAME\", \"LTO\");\nfireScoreBuilding2.set(\"FS\", 3);\nupdates.push(fireScoreBuilding2);\n\nvar fireScoreBuilding3 = new Map();\nfireScoreBuilding3.set(\"BUILDING_NAME\", \"LTI\");\nfireScoreBuilding3.set(\"FS\", 3);\nupdates.push(fireScoreBuilding3);\n\n//This is now sent on to update the DB and also then triggers a send to MQTT for the edge nodes to pick up\nmsg.payload = updates;\n//Hacky way to do some specific debugging -\nmsg.lancedebug = debug;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 960,
        "wires": [
            [
                "0143496e1011b5b9",
                "36cc246e4c6ddac8",
                "a90ba086792e3e58"
            ]
        ]
    },
    {
        "id": "2c6de25e908b1996",
        "type": "link in",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Game Update Calculations",
        "links": [
            "16c9d84b48e02137",
            "42dc7006a64f8054"
        ],
        "x": 125,
        "y": 960,
        "wires": [
            [
                "e8fcbe1eaf3b0d0b"
            ]
        ]
    },
    {
        "id": "16c9d84b48e02137",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "link out 46",
        "links": [
            "2c6de25e908b1996"
        ],
        "x": 1435,
        "y": 580,
        "wires": []
    },
    {
        "id": "36cc246e4c6ddac8",
        "type": "debug",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Game Update Calculations Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 1060,
        "wires": []
    },
    {
        "id": "0143496e1011b5b9",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "SQL - Update Fire Score ",
        "func": "var matchnum = global.get(\"matchnum\");\nvar o = msg.payload;\n\n\nvar sql = \"\";\n\no.forEach((element, index, array) => {\n    var name = element.get(\"BUILDING_NAME\");\n    var fs = element.get(\"FS\");\n    var line = \"UPDATE Buildings SET \"\n        + \"FCS = \" + fs\n        + \" WHERE MATCH_NUM=\" + matchnum + \" AND BUILDING_NAME='\" + name + \"'\"\n        + \";\";\n    sql = sql + line;\n});\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 960,
        "wires": [
            [
                "84a54223a84f044a"
            ]
        ]
    },
    {
        "id": "84a54223a84f044a",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 950,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "23720f7562bead06",
        "type": "debug",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Game Update Calculations SQL Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 1060,
        "wires": []
    },
    {
        "id": "a90ba086792e3e58",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Update Message per Building",
        "func": "\nvar o = msg.payload;\n\n\n\nvar msgs = \"\";\nvar debug = \"\" + o.length + \" |\";\nvar i = 0;\no.forEach((element, index, array) => {\n    var name = element.get(\"BUILDING_NAME\");\n    var fs = element.get(\"FS\");\n    var payload = \"{\\\"BUILDING_NAME\\\" :\\\"\" + name + \"\\\", \\\"FCS\\\" :\" + fs + \"}\";\n    var topicname = \"nodered/firescore/\" + name;\n    var newmsg = \"{\\\"payload\\\" :\" + payload + \",\\\"topic\\\" : \\\"\" + topicname + \"\\\"}\\n\";\n    msgs = msgs +  newmsg;\n    debug = debug + \"|i:\" + i +\" | \" + name + \":\" + topicname + \" : \"+ fs +\"|\";\n    newmsg.lancedebug = debug;\n\n});\nvar nmsgs = {};\nnmsgs.payload = msgs;\nreturn nmsgs;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 900,
        "wires": [
            [
                "a758f9ceac41ea87"
            ]
        ]
    },
    {
        "id": "a4f26d2999f4172e",
        "type": "link out",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "link out 47",
        "links": [
            "3a4f65d2f43899bf"
        ],
        "x": 1345,
        "y": 900,
        "wires": []
    },
    {
        "id": "a26c69d85115ea29",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "Global timer every 15 seconds, kicks of scoring updates to DB and MQTT",
        "info": "",
        "x": 360,
        "y": 520,
        "wires": []
    },
    {
        "id": "a758f9ceac41ea87",
        "type": "split",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": true,
        "addname": "",
        "x": 890,
        "y": 900,
        "wires": [
            [
                "520da49c1ff95703"
            ]
        ]
    },
    {
        "id": "4d4ec8f260d5ebe5",
        "type": "function",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Update Message per",
        "func": "\nvar o = msg.payload;\nvar newmsg = {};\nnewmsg.topic = o[\"topic\"];\nnewmsg.payload = o[\"payload\"];\nnewmsg.lancedebug = msg.payload;\nreturn newmsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 900,
        "wires": [
            [
                "a4f26d2999f4172e"
            ]
        ]
    },
    {
        "id": "520da49c1ff95703",
        "type": "json",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1030,
        "y": 900,
        "wires": [
            [
                "4d4ec8f260d5ebe5"
            ]
        ]
    },
    {
        "id": "720d501722eb94f6",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Preps to send one FCS update per node",
        "info": "",
        "x": 760,
        "y": 860,
        "wires": []
    },
    {
        "id": "5dc6bd11da1ac853",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "Calculates Scores  and updated DB and sends to Nodes -- kicked off by the global timer",
        "info": "",
        "x": 400,
        "y": 820,
        "wires": []
    },
    {
        "id": "58040edb208146fe",
        "type": "link in",
        "z": "0661e4588e011b72",
        "name": "Test Game Update - Multiple DB Calls",
        "links": [],
        "x": 35,
        "y": 1260,
        "wires": [
            [
                "d510a7e9d5995265"
            ]
        ]
    },
    {
        "id": "d510a7e9d5995265",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Get Sensor Type",
        "func": "var o = msg.payload;\nvar matchnum = global.get(\"matchnum\");\n\nlet building_name = o.BUILDING_NAME;\n\nlet sqlsensor = \"SELECT Buildings.SENSOR_TYPE FROM Buildings WHERE ((Buildings.BUILDING_NAME=\\\"\" + building_name + \"\\\") AND  MATCH_NUM=\" + matchnum + \")\";\n\nmsg.topic = sqlsensor;\nmsg.BUILDING_NAME = building_name;\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1260,
        "wires": [
            [
                "dd9895acbdbc4504",
                "c2adec50e107a03e"
            ]
        ]
    },
    {
        "id": "bf05d0d8b14ea7f2",
        "type": "inject",
        "z": "0661e4588e011b72",
        "name": "Game Score Example",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 1320,
        "wires": [
            [
                "c09cabbfdec37b4d"
            ]
        ]
    },
    {
        "id": "c09cabbfdec37b4d",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Inject BUILDING_NAME='RBO'",
        "func": "var o = {};\no.BUILDING_NAME=\"RBO\";\nmsg.payload = o;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1320,
        "wires": [
            [
                "d510a7e9d5995265"
            ]
        ]
    },
    {
        "id": "dd9895acbdbc4504",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 12",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 1320,
        "wires": []
    },
    {
        "id": "afa42bbfacb3d333",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 13",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 1240,
        "wires": []
    },
    {
        "id": "c2adec50e107a03e",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 830,
        "y": 1260,
        "wires": [
            [
                "65527e82cde1cc35",
                "afa42bbfacb3d333"
            ]
        ]
    },
    {
        "id": "65527e82cde1cc35",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "On Sensor Type",
        "func": "var o = msg.payload\nvar matchnum = global.get(\"matchnum\");\n\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\nvar building_type = \"none\";\no.forEach((element, index, array) => {\n    building_type = element.SENSOR_TYPE;\n});\n\nmsg.building_type = building_type;\nreturn msg;\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1680,
        "wires": [
            [
                "b998609c45c1c264",
                "80c91c52e1b02553"
            ]
        ]
    },
    {
        "id": "b998609c45c1c264",
        "type": "switch",
        "z": "0661e4588e011b72",
        "name": "",
        "property": "building_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Ball",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Laser",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 1680,
        "wires": [
            [
                "f247b7ce4323955f"
            ],
            [
                "6339be531e52eb53"
            ]
        ]
    },
    {
        "id": "f247b7ce4323955f",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Ball Type Logic - SQL SumOfWindowsActive",
        "func": "var o = msg.payload;\nvar matchnum = global.get(\"matchnum\");\n\nlet building_name = msg.BUILDING_NAME;\n\nvar totalActiveWindows = 0;\n\nlet sqltypeball = \"SELECT Sum(BuildingWindowStatus.WINDOWS_ACTIVE) AS SumOfWindowsActive FROM BuildingWindowStatus WHERE(((BuildingWindowStatus.BUILDING_NAME) =\\\"\" + building_name + \"\\\") AND MATCH_NUM=\" + matchnum + \") GROUP BY BuildingWindowStatus.BUILDING_NAME;\";\nmsg.topic = sqltypeball; \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 1640,
        "wires": [
            [
                "7b77eb317fb4a183",
                "80c91c52e1b02553"
            ]
        ]
    },
    {
        "id": "6339be531e52eb53",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Laser Type Logic",
        "func": "//Place holder for now\n\nvar o = msg.payload;\nvar matchnum = global.get(\"matchnum\");\n\nlet building_name = o.BUILDING_NAME;\n\nvar totalActiveWindows = 0;\n\nlet sqltypeball = \"SELECT Sum(BuildingWindowStatus.WINDOWS_ACTIVE) AS SumOfWindowsActive FROM BuildingWindowStatus WHERE(((BuildingWindowStatus.BUILDING_NAME) =\\\"\" + building_name + \"\\\") AND MATCH_NUM=\" + matchnum + \") GROUP BY BuildingWindowStatus.BUILDING_NAME;\";\nmsg.topic = sqltypeball; \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "7b77eb317fb4a183",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1070,
        "y": 1640,
        "wires": [
            [
                "e0bb725878bb46a2"
            ]
        ]
    },
    {
        "id": "8fbcd0d6393e6bbd",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "Based on sensor type",
        "info": "",
        "x": 280,
        "y": 1620,
        "wires": []
    },
    {
        "id": "e0bb725878bb46a2",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Get SumOfWindowsActive",
        "func": "var o = msg.payload\nvar matchnum = global.get(\"matchnum\");\n\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\nvar SumOfWindowsActive = 0;\no.forEach((element, index, array) => {\n    SumOfWindowsActive = element.SumOfWindowsActive;\n});\n\nmsg.SumOfWindowsActive = SumOfWindowsActive;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 2020,
        "wires": [
            [
                "3136d9675cee3488"
            ]
        ]
    },
    {
        "id": "3136d9675cee3488",
        "type": "switch",
        "z": "0661e4588e011b72",
        "name": "if SumOfWindowsActive > 0",
        "property": "SumOfWindowsActive",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gte",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 2020,
        "wires": [
            [
                "d9675f3673d9fc3e"
            ],
            [
                "1910aa9db215bd80"
            ]
        ]
    },
    {
        "id": "d9675f3673d9fc3e",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "0 Windows Active  - Set Numhits =0",
        "func": "var matchnum = global.get(\"matchnum\");\nvar o = msg.payload;\nvar building_name = msg.BUILDING_NAME;\n\nlet sqlnumhitsupdate = \"UPDATE BuildingWindowStatus SET NUM_HITS = 0 WHERE BUILDING_NAME = \\\"\" + building_name + \"\\\" AND BUILDING_SIDE = 1 AND  MATCH_NUM=\" + matchnum;\nmsg.topic = sqlnumhitsupdate;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 1960,
        "wires": [
            [
                "6e9d47557350e0fc",
                "072ee9243b49f717"
            ]
        ]
    },
    {
        "id": "6e9d47557350e0fc",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1210,
        "y": 1960,
        "wires": [
            []
        ]
    },
    {
        "id": "1910aa9db215bd80",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": " Windows Active  >= 1",
        "func": "var matchnum = global.get(\"matchnum\");\nvar o = msg.payload;\nvar building_name = msg.BUILDING_NAME;\n\nlet sqlnumhits = \"SELECT Sum(BuildingWindowStatus.NUM_HITS) AS SumOfNUM_HITS FROM BuildingWindowStatus GROUP BY BuildingWindowStatus.BUILDING_NAME HAVING(((BuildingWindowStatus.BUILDING_NAME) = \\\"\" + building_name + \"\\\")) AND  MATCH_NUM=\" + matchnum;\n\nmsg.topic = sqlnumhits;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2080,
        "wires": [
            [
                "54dea4faa1a16ec6"
            ]
        ]
    },
    {
        "id": "54dea4faa1a16ec6",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1110,
        "y": 2080,
        "wires": [
            [
                "3c3945db08bf0daf",
                "9526f2bbc15c0586"
            ]
        ]
    },
    {
        "id": "6632c8bca51718e3",
        "type": "switch",
        "z": "0661e4588e011b72",
        "name": "If Hits Div 4",
        "property": "hitsdiv4",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 750,
        "y": 2320,
        "wires": [
            [
                "b229b0ef8d890dbc"
            ],
            [
                "6b1dc76758e0fe17"
            ]
        ]
    },
    {
        "id": "3c3945db08bf0daf",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Retrieve SumOfNUM_HITS and mod 4",
        "func": "var o = msg.payload\nvar matchnum = global.get(\"matchnum\");\n\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\nvar SumOfNUM_HITS = 0;\no.forEach((element, index, array) => {\n    SumOfNUM_HITS = element.row.SumOfNUM_HITS;\n});\n\nmsg.SumOfNUM_HITS = SumOfNUM_HITS;\nif (SumOfNUM_HITS % 4 == 0) {\n    msg.hitsdiv4 = 1;\n} else\n    msg.hitsdiv4 = 0;\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 2320,
        "wires": [
            [
                "6632c8bca51718e3"
            ]
        ]
    },
    {
        "id": "b229b0ef8d890dbc",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "On Mod 4 Num Hits - sql MaxOfSideSequence",
        "func": "var matchnum = global.get(\"matchnum\");\nvar o = msg.payload;\nvar building_name = msg.BUILDING_NAME;\nlet sqlmaxofsideseq = \"SELECT Max(BuildingWindowStatus.WINDOW_SEQUENCE) AS MaxOfSideSequence FROM BuildingWindowStatus WHERE(((BuildingWindowStatus.BUILDING_NAME) = \\\"\" + building_name + \"\\\") AND((BuildingWindowStatus.WINDOWS_ACTIVE) > 0)) AND MATCH_NUM=\" + matchnum ;\nmsg.topic = sqlmaxofsideseq;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 2280,
        "wires": [
            [
                "e878374a4de9bc51"
            ]
        ]
    },
    {
        "id": "e878374a4de9bc51",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1170,
        "y": 2320,
        "wires": [
            [
                "ea0e0c8b5ecfba73"
            ]
        ]
    },
    {
        "id": "6b1dc76758e0fe17",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 14",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 2340,
        "wires": []
    },
    {
        "id": "ea0e0c8b5ecfba73",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Get MaxOfSideSequence - SQL Building Side and Name",
        "func": "var o = msg.payload\nvar matchnum = global.get(\"matchnum\");\nvar building_name = msg.BUILDING_NAME;\n\n\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\nvar MaxOfSideSequence = 0;\no.forEach((element, index, array) => {\n    MaxOfSideSequence = element.row.MaxOfSideSequence;\n});\n\nmsg.MaxOfSideSequence = MaxOfSideSequence;\n\nvar sqlNameAndSide = \"SELECT BuildingWindowStatus.BUILDING_NAME, BuildingWindowStatus.BUILDING_SIDE FROM BuildingWindowStatus WHERE(((BuildingWindowStatus.BUILDING_NAME) = \\\"\"  +building_name + \"\\\") AND((BuildingWindowStatus.WINDOW_SEQUENCE) = \" + MaxOfSideSequence + \"))\";\nmsg.topic = sqlNameAndSide;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2420,
        "wires": [
            [
                "69f5981daf5427f6"
            ]
        ]
    },
    {
        "id": "69f5981daf5427f6",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 1010,
        "y": 2420,
        "wires": [
            [
                "e95b9ac0106a15af"
            ]
        ]
    },
    {
        "id": "e95b9ac0106a15af",
        "type": "function",
        "z": "0661e4588e011b72",
        "name": "Reduce Windows Active",
        "func": "var o = msg.payload\nvar matchnum = global.get(\"matchnum\");\n\n\n//shows how you can iterate and access the data that is sent in\nvar debug1 = \"\";\nvar building_name = \"\";\nvar building_side = 0;\no.forEach((element, index, array) => {\n    building_name = element.row.BuildingWindowStatus.BUILDING_NAME;\n    building_side = element.row.BuildingWindowStatus.BUILDING_SIDE;\n});\n\nvar sqludateactive = \"UPDATE BuildingWindowStatus SET BuildingWindowStatus.WINDOWS_ACTIVE = 1 WHERE(((BuildingWindowStatus.BUILDING_NAME) = \\\"\" + building_name + \"\\\") AND((BuildingWindowStatus.BUILDING_SIDE) = \" + building_side + \")) AND MATCH_NUM=\" + matchnum;\n\nmsg.topic = sqludateactive;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 2500,
        "wires": [
            [
                "d140de1bce07b674"
            ]
        ]
    },
    {
        "id": "d140de1bce07b674",
        "type": "sqlite",
        "z": "0661e4588e011b72",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 870,
        "y": 2500,
        "wires": [
            []
        ]
    },
    {
        "id": "80c91c52e1b02553",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 1560,
        "wires": []
    },
    {
        "id": "072ee9243b49f717",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 2020,
        "wires": []
    },
    {
        "id": "9526f2bbc15c0586",
        "type": "debug",
        "z": "0661e4588e011b72",
        "name": "debug 17",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 2060,
        "wires": []
    },
    {
        "id": "457aa09d3654575d",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "Get SumOfWindowsActive",
        "info": "",
        "x": 430,
        "y": 1980,
        "wires": []
    },
    {
        "id": "f444b4901d9df4f4",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "SumOfNumHits Logic",
        "info": "",
        "x": 420,
        "y": 2260,
        "wires": []
    },
    {
        "id": "846972f25d2812f0",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "Ball Sensor Logic",
        "info": "",
        "x": 300,
        "y": 1920,
        "wires": []
    },
    {
        "id": "7767c67d6fb6833f",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "Laser Sensor Logic",
        "info": "",
        "x": 290,
        "y": 2620,
        "wires": []
    },
    {
        "id": "3933515f9be6b47a",
        "type": "comment",
        "z": "0661e4588e011b72",
        "name": "Example Below of Accessing Data, making decisions,  switching flows, and writing data",
        "info": "",
        "x": 300,
        "y": 1200,
        "wires": []
    },
    {
        "id": "09b68daef587970a",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "dec7910ea27af2d0",
        "name": "<=== might be obsolete?  CHECK",
        "info": "",
        "x": 1750,
        "y": 960,
        "wires": []
    },
    {
        "id": "5690d1607d8fc9da",
        "type": "comment",
        "z": "0661e4588e011b72",
        "g": "82485a2c45a42ec4",
        "name": "<=== might be obsolete?  (other than debug purposes)",
        "info": "",
        "x": 1800,
        "y": 580,
        "wires": []
    },
    {
        "id": "3a4b12e5b9609b0d",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "link out 5",
        "links": [
            "43ddc5a441c4fd3f"
        ],
        "x": 935,
        "y": 140,
        "wires": []
    },
    {
        "id": "07b0e9426f57711a",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "Increment/Set Fire Score for latest match",
        "info": "",
        "x": 220,
        "y": 100,
        "wires": []
    },
    {
        "id": "a4fbec13a30337cd",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 140,
        "wires": [
            [
                "d88db86de710b8e9"
            ]
        ]
    },
    {
        "id": "b49a77ff09745d6d",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "Increment Firescore",
        "links": [
            "5eca71e17e525b35",
            "6c398839cd14285d",
            "37c9658f21fde304"
        ],
        "x": 225,
        "y": 140,
        "wires": [
            [
                "a4fbec13a30337cd"
            ]
        ]
    },
    {
        "id": "be446f7474a7a970",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "name": "SQL - New Match",
        "func": "\nvar timestamp = msg.payload;\n//Choose a random side to start match -\n\nvar matchnum = global.get(\"matchnum\");\n\n\n//Choose a random side\nvar active = \"LEFT\";\n;\nif (Math.floor(Math.random() * 2)==0) {\n    active = \"RIGHT\"\n}\nglobal.set(\"startside\", active);\n\nvar newMsg = {\n    \"topic\": \"INSERT INTO MATCH_STATE (TIMEOFMATCH, ACTIVE_COMMUNITY) VALUES (  \"+ timestamp + \", '\" + active + \"');\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 880,
        "wires": [
            [
                "54b2cad8c9c66ea5",
                "2df386bd76ec52e3"
            ]
        ]
    },
    {
        "id": "54b2cad8c9c66ea5",
        "type": "debug",
        "z": "f74b301e4f22310f",
        "name": "Game Storage Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 360,
        "wires": []
    },
    {
        "id": "a5a1bd31c468f86b",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "name": "New Match Creation",
        "links": [
            "4eb277af36ef1fe2",
            "6243bfa8703f32ca",
            "7f5a474942e946d6"
        ],
        "x": 205,
        "y": 880,
        "wires": [
            [
                "72bcba239803d115"
            ]
        ]
    },
    {
        "id": "2a673ebfd70ddc64",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "name": "Create a new empty match (set global.matchnum to new matchnum)",
        "info": "",
        "x": 300,
        "y": 820,
        "wires": []
    },
    {
        "id": "540954cda7540f43",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "Select All Game Table",
        "func": "var newMsg = {\n    \"topic\": \"select * from MATCH_STATE ORDER BY TIMEOFMATCH DESC;\"\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1040,
        "wires": [
            [
                "27094e97daa3234a"
            ]
        ]
    },
    {
        "id": "27094e97daa3234a",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 550,
        "y": 1040,
        "wires": [
            [
                "786da311f9d1e2af"
            ]
        ]
    },
    {
        "id": "786da311f9d1e2af",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "Result match_num",
        "func": "var matchid = msg.payload[0].MATCH_NUM;\nmsg.payload = matchid;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1040,
        "wires": [
            [
                "a4cca78582b0aa97"
            ]
        ]
    },
    {
        "id": "a4cca78582b0aa97",
        "type": "change",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "set global",
        "rules": [
            {
                "t": "set",
                "p": "matchnum",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 1040,
        "wires": [
            [
                "50a7d4620d30956a"
            ]
        ]
    },
    {
        "id": "48af91ab4809047a",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "Set Latest Matchnum to Global",
        "links": [
            "e68d02821b10c9fd",
            "165f13f0f929f16e"
        ],
        "x": 125,
        "y": 1040,
        "wires": [
            [
                "540954cda7540f43"
            ]
        ]
    },
    {
        "id": "553a13c0223b7873",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "Sets Global.matchnum to latest match in DB",
        "info": "",
        "x": 230,
        "y": 980,
        "wires": []
    },
    {
        "id": "4bfad19cc46d0966",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Latest Match Table Dump",
        "func": "\n\nvar matchid = global.get(\"matchnum\");\nvar newMsg = {\n    \"topic\": \"SELECT * FROM Buildings B INNER JOIN BuildingWindowStatus BWS \" \n        + \"on B.MATCH_NUM = BWS.MATCH_NUM AND B.BUILDING_NAME=BWS.BUILDING_NAME \"\n         +  \"WHERE B.MATCH_NUM = \" + matchid + \";\" \n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1240,
        "wires": [
            [
                "397f10dd3ab3a997",
                "18fb71a97e22a4a8"
            ]
        ]
    },
    {
        "id": "5954b430a79f7b3e",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Result Dump",
        "func": "//CREATE TABLE GAMETEST(MATCH_NUM INTEGER PRIMARY KEY AUTOINCREMENT, BUILDING_ID VARCHAR(32), FIRE_SCORE INT NOT NULL, NUM_TREES INT NOT NULL, TIMEOFMATCH INT NOT NULL);  \n\n\n//var str = \"match: \" + msg.payload[0].MATCH_NUM + \" trees:\" + msg.payload[0].NUM_TREES + \" FIRE:\" + msg.payload[0].FIRE_SCORE + \" LASER HITS:\" + msg.payload[0].NUM_HITS;\n//msg.payload = str;\nlet newrow = []\nlet title = [\"MATCH_NUM\",\"NODE_ID\",\t\"SIDE_ID\",\"FIRE_SCORE\",\"NUM_TREES\",\"NUM_HITS\",\"NUM_DROPS\",\"NUM_BAGS\",\"TIMEOFMATCH\"]\ntitle.push()\nfor (var i=0;i<msg.payload.length;i++) {\n    var row = msg.payload[i];\n    if ( \n        row.NUM_HITS != 0 ||\n        row.NUM_DROPS != 0 || \n        row.NUM_BAGS != 0) {\n        newrow.push(row);\n        } \n}\nmsg.payload = newrow;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1240,
        "wires": [
            [
                "fa60c2b1c4bd6432",
                "18fb71a97e22a4a8"
            ]
        ]
    },
    {
        "id": "397f10dd3ab3a997",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 590,
        "y": 1240,
        "wires": [
            [
                "5954b430a79f7b3e",
                "18fb71a97e22a4a8"
            ]
        ]
    },
    {
        "id": "953a1664303952cf",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "name": "Data Access Flows for the Game Storage",
        "info": "Flows that access the DB and upddate and or read various game states\nThese can be accessed via Manual Game Flows and/or nodered flows which are triggered via mqtt",
        "x": 200,
        "y": 40,
        "wires": []
    },
    {
        "id": "18a554bcaa2360e7",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Dump to Debug Latest Match",
        "links": [
            "c30231dee65db09d",
            "d9bb129180d8b9cf",
            "277d12403d6f9f63",
            "8f1d410dda1e4f81"
        ],
        "x": 125,
        "y": 1240,
        "wires": [
            [
                "4bfad19cc46d0966"
            ]
        ]
    },
    {
        "id": "761720674f178020",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Dump to Debug the latest match data",
        "info": "",
        "x": 210,
        "y": 1180,
        "wires": []
    },
    {
        "id": "ee723854cfa1c6f1",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "SQL - Update Laser Hit (ADD)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar hits = o.num_hits;\nvar nodeid = o.BUILDING_NAME;\nvar sideid = o.side_id;\n\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET NUM_HITS = NUM_HITS + \" \n    + hits + \" WHERE MATCH_NUM = \" \n    + matchid + \" AND BUILDING_NAME='\" + nodeid \n        + \"' AND BUILDING_SIDE=\" + sideid \n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 320,
        "wires": [
            [
                "d527904ed8723b40",
                "54b2cad8c9c66ea5"
            ]
        ]
    },
    {
        "id": "ad8d8a3973c7761a",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "Increment/Set Laser Hit for latest match",
        "info": "",
        "x": 210,
        "y": 280,
        "wires": []
    },
    {
        "id": "473384a40d04fd99",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 320,
        "wires": [
            [
                "ee723854cfa1c6f1"
            ]
        ]
    },
    {
        "id": "af55cd6eb001ec61",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "Increment Laser Hit",
        "links": [
            "515a805e2750f3bd",
            "5eca71e17e525b35",
            "64800c16d9ae1ca4",
            "dd142b5915f31846",
            "a9c50f46b67e9896",
            "02b8a461b8de262a",
            "7684f0009e5ef352",
            "1030fd2ad1224f40",
            "a3d3789242cf5cfe"
        ],
        "x": 225,
        "y": 320,
        "wires": [
            [
                "473384a40d04fd99"
            ]
        ]
    },
    {
        "id": "d527904ed8723b40",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "link out 10",
        "links": [
            "f6566f17a1e9b78e"
        ],
        "x": 935,
        "y": 320,
        "wires": []
    },
    {
        "id": "7d1c946cf1d71468",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "name": "New Match DB Entry Complete",
        "links": [
            "1d8b42fd0952e51b",
            "dd55547c4747b6b1"
        ],
        "x": 965,
        "y": 880,
        "wires": []
    },
    {
        "id": "50a7d4620d30956a",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "e56885edbfad9853",
        "name": "New Match DB Entry Complete",
        "links": [
            "a67d3036cd8b2a23"
        ],
        "x": 1045,
        "y": 1040,
        "wires": []
    },
    {
        "id": "594538fb122fa8a1",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "SQL - Update Laser Hit (SET)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar hits = o.num_hits;\nvar nodeid = o.BUILDING_NAME;\nvar sideid = o.side_id;\n\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET NUM_HITS = \" + hits \n    + \" WHERE MATCH_NUM = \" + matchid \n    + \" AND BUILDING_NAME='\" + nodeid \n    + \"' AND BUILDING_SIDE=\" + sideid + \";\"\n}\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 360,
        "wires": [
            [
                "d527904ed8723b40",
                "54b2cad8c9c66ea5"
            ]
        ]
    },
    {
        "id": "2e8cd63f45daf40d",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "Set Laser Hit",
        "links": [],
        "x": 225,
        "y": 360,
        "wires": [
            [
                "221e289248744137"
            ]
        ]
    },
    {
        "id": "221e289248744137",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "2008d605d368ad7e",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 360,
        "wires": [
            [
                "594538fb122fa8a1"
            ]
        ]
    },
    {
        "id": "9a98401250929d20",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "SQL - Update Fire Score (SET)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar fs = o['FCS'];\nvar nodeid = o['BUILDING_NAME'];\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FCS = \" + fs + \" WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME='\" + nodeid + \"';\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 180,
        "wires": [
            [
                "3a4b12e5b9609b0d",
                "54b2cad8c9c66ea5"
            ]
        ]
    },
    {
        "id": "7046ccf0cab73df5",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 180,
        "wires": [
            [
                "9a98401250929d20"
            ]
        ]
    },
    {
        "id": "c5098de218c47d8f",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "Set Firescore",
        "links": [
            "a2bcb79fedaca272",
            "a29505e70d7b9ece",
            "711e25dc20dbd9af"
        ],
        "x": 225,
        "y": 180,
        "wires": [
            [
                "7046ccf0cab73df5"
            ]
        ]
    },
    {
        "id": "fa60c2b1c4bd6432",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "link out 15",
        "links": [
            "c5b51aa2f4863b48",
            "28eb2bc55dcddb70"
        ],
        "x": 965,
        "y": 1240,
        "wires": []
    },
    {
        "id": "2df386bd76ec52e3",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Match Create",
        "x": 760,
        "y": 880,
        "wires": [
            [
                "7d1c946cf1d71468"
            ]
        ]
    },
    {
        "id": "4c16c39c21c351b0",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Create Empty Game Records",
        "links": [
            "3719854fdfed232d"
        ],
        "x": 1395,
        "y": 140,
        "wires": [
            [
                "fc55610d6c9105b3",
                "fa744c0499161826"
            ]
        ]
    },
    {
        "id": "fc55610d6c9105b3",
        "type": "function",
        "z": "f74b301e4f22310f",
        "d": true,
        "g": "c4beeef48c6dcf84",
        "name": "SQL - Initialize Match - TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft);\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight);\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n};\n\nconst BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n};\n\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" \n      + leftNodeName + \"','\" \n      + COMMUNITYLEFT + \"','\" \n      + BuildingSizeForLeftMap[leftNodeName] \n      + \"','\" + BuildingSensorsForLeftMap[leftNodeName] \n      + \"',1,0, 0,0, 0, 0, 0, 0,\" \n      + timestamp + \");\\n \";\n  sql = sql + line;\n  \n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\"\n      + rightNodeName + \"','\"\n      + COMMUNITYRIGHT + \"','\"\n      + BuildingSizeForRightMap[rightNodeName]\n      + \"','\" + BuildingSensorsForRightMap[rightNodeName]\n      + \"',1,0, 0,0,0, 0,0,0,\"\n      + timestamp + \"); \\n\";\n    sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 140,
        "wires": [
            [
                "12b7849527a8f3d3",
                "cd1bf88c1e97229e"
            ]
        ]
    },
    {
        "id": "12b7849527a8f3d3",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildings For Match",
        "x": 1970,
        "y": 140,
        "wires": [
            [
                "5aaea6a334032def"
            ]
        ]
    },
    {
        "id": "2ce44170d41d852c",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "SQL - Update Ball Drop (ADD)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar num_drops = o.num_drops;\nvar nodeid = o.BUILDING_NAME;\n\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET NUM_DROPS = NUM_DROPS + \"\n        + num_drops + \" WHERE MATCH_NUM = \"\n        + matchid + \" AND BUILDING_NAME='\" + nodeid + \"'\" \n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 500,
        "wires": [
            [
                "91eeec4cfa6d85ca"
            ]
        ]
    },
    {
        "id": "9e904570325a5f04",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "Increment/Set Ball Drop for latest match",
        "info": "",
        "x": 210,
        "y": 460,
        "wires": []
    },
    {
        "id": "0cb41cd8c25bd380",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 500,
        "wires": [
            [
                "2ce44170d41d852c"
            ]
        ]
    },
    {
        "id": "63f807f3f36abd11",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "Increment Ball Drop",
        "links": [
            "75c5f224f591b111",
            "f1340eb46d54b7e1",
            "c854b1ceacdd7cbd",
            "502f096a67482bb5",
            "38e34dadb04371c8"
        ],
        "x": 225,
        "y": 500,
        "wires": [
            [
                "0cb41cd8c25bd380"
            ]
        ]
    },
    {
        "id": "91eeec4cfa6d85ca",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "link out 20",
        "links": [
            "43ddc5a441c4fd3f"
        ],
        "x": 935,
        "y": 500,
        "wires": []
    },
    {
        "id": "4d52cd46f08add7f",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "SQL - Update Ball Drop (SET)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar num_drops = o.num_drops;\nvar nodeid = o.BUILDING_NAME;\nvar sideid = 0;\nvar newMsg = {\n    \"topic\": \"UPDATE Building SET NUM_DROPS = \" + num_drops + \" WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME='\" + nodeid + \"' ;\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 540,
        "wires": [
            [
                "91eeec4cfa6d85ca"
            ]
        ]
    },
    {
        "id": "1fe8b5ccb6bce22f",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "Set Ball Drop Count",
        "links": [],
        "x": 225,
        "y": 540,
        "wires": [
            [
                "2f1658364fc5719b"
            ]
        ]
    },
    {
        "id": "2f1658364fc5719b",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "37232e2e92b5faa6",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 440,
        "y": 540,
        "wires": [
            [
                "4d52cd46f08add7f"
            ]
        ]
    },
    {
        "id": "72bcba239803d115",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "738e4f614ef8a7a5",
        "name": "Add Match Start",
        "func": "var d = new Date();\nvar time1 = d.getTime();\nmsg.payload = time1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 880,
        "wires": [
            [
                "be446f7474a7a970"
            ]
        ]
    },
    {
        "id": "b91304bb2e2395c8",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "d9c57fb2a381a320",
        "name": "Set Num Bags in trough for latest match",
        "info": "",
        "x": 210,
        "y": 640,
        "wires": []
    },
    {
        "id": "a37728c272928fcb",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "d9c57fb2a381a320",
        "name": "link out 41",
        "links": [
            "43ddc5a441c4fd3f"
        ],
        "x": 925,
        "y": 680,
        "wires": []
    },
    {
        "id": "23c2335c118ef4be",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "d9c57fb2a381a320",
        "name": "SQL - Update Trough Bags (SET)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar num_bags = o.num_bags;\nvar nodeid = o.BUILDING_NAME;\nvar sideid = 0;\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET NUM_BAGS = \" + num_bags + \" WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME='\" + nodeid + \"' ;\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 700,
        "wires": [
            [
                "a37728c272928fcb"
            ]
        ]
    },
    {
        "id": "0d084e688f622348",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "d9c57fb2a381a320",
        "name": "Set Bag Count",
        "links": [
            "87e764dac83fb351",
            "a0893a9b1c6e7557",
            "a2c40ebd42a054a9"
        ],
        "x": 215,
        "y": 700,
        "wires": [
            [
                "4244695d7f15d3fd"
            ]
        ]
    },
    {
        "id": "4244695d7f15d3fd",
        "type": "json",
        "z": "f74b301e4f22310f",
        "g": "d9c57fb2a381a320",
        "name": "Parse Incoming",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 430,
        "y": 700,
        "wires": [
            [
                "23c2335c118ef4be"
            ]
        ]
    },
    {
        "id": "cd1bf88c1e97229e",
        "type": "debug",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Current Game Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2570,
        "y": 120,
        "wires": []
    },
    {
        "id": "e1a5ecaa10ad1d0c",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "=== DOM Initialize to Game State",
        "info": "",
        "x": 1460,
        "y": 80,
        "wires": []
    },
    {
        "id": "e354ec1a31284c79",
        "type": "function",
        "z": "f74b301e4f22310f",
        "d": true,
        "g": "c4beeef48c6dcf84",
        "name": "SQL -  - Initialize Match - TABLE BuildingWindowStatus",
        "func": "  \nvar d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nconst NodesForLeft = ['LTO', 'LTM', 'LTI', 'LBO', 'LBM', 'LBI'];\nconst NodesForRight = ['RTO', 'RTM', 'RTI', 'RBO', 'RBM', 'RBI'];\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst numSides = 4;\n\nvar burningNode1 = global.get(\"burning1\");\nvar burningNode2 = global.get(\"burning2\");\n\n\n\n/*\nCREATE TABLE BuildingWindowStatus(\n  MATCH_NUM INT NOT NULL,\n  BUILDING_NAME VARCHAR[32],\n  COMMUNITY INT NOT NULL,\n  BUILDING_SIDE INT NOT NULL,\n  WINDOWS_ACTIVE INT,\n  NUM_HITS INT NOT NULL,\n  TIMEOFMATCH INT NOT NULL,\n  PRIMARY KEY(MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" + \n      \"VALUES(\" + matchnum + \", '\" + leftNodeName + \"','\" + COMMUNITYLEFT +\"', \"+i+\", 0, 2, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\nvar treeleft = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" +\n  \"VALUES(\" + matchnum + \", 'LTREES','\" + COMMUNITYLEFT + \"', 0, 0, 2, 0, \" + timestamp + \"); \";\nsql = sql + line;\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" + rightNodeName + \"','\" + COMMUNITYRIGHT + \"', \" + i + \", 0, 2, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\nvar treeright = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" +\n  \"VALUES(\" + matchnum + \", 'RTREES','\" + COMMUNITYRIGHT + \"', 0, 0, 2, 0, \" + timestamp + \"); \";\nsql = sql + treeright;\n\nmsg.topic = sql; \nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 340,
        "wires": [
            [
                "c1f1b1372fb990e6",
                "cd1bf88c1e97229e"
            ]
        ]
    },
    {
        "id": "c1f1b1372fb990e6",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildingsWindows For Match",
        "x": 2080,
        "y": 340,
        "wires": [
            [
                "6b1897b0ddc816e3"
            ]
        ]
    },
    {
        "id": "5aaea6a334032def",
        "type": "function",
        "z": "f74b301e4f22310f",
        "d": true,
        "g": "c4beeef48c6dcf84",
        "name": "SQL - Calculate and UPDATE TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft);\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight);\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n};\n\nvar BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n};\n\nconst BuildingBlockedForLeftMap = {\n  'LTO': 0,\n  'LTM': 0,\n  'LTI': 0,\n  'LBO': 0,\n  'LBM': 0,\n  'LBI': 0,\n};\n\nconst BuildingBlockedForRightMap = {\n  'RTO': 0,\n  'RTM': 0,\n  'RTI': 0,\n  'RBO': 0,\n  'RBM': 0,\n  'RBI': 0,\n};\n\nvar strdebug = \"\";\n//Start picking random things\n//First set all buildings to not burning\nvar BurningBuildings = {};\nfor (const node of AllNodes) {\n  BurningBuildings[node] = 0;\n}\n\n//set a tall building burning, set sensor type\nvar tallSensor = \"\";\nvar tallBuildingBurning = Math.floor(Math.random() * 2);\nvar shortBuildingBurning = Math.floor(Math.random() * 2);\nif (startside=='LEFT') {\n  BurningBuildings[TallBuildingsLeft[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsLeft[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsLeft[tallBuildingBurning]);\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForLeftMap[TallBuildingsLeft[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn\n  for (const node of ShortBuildingsLeft) {\n    strdebug += i + \":\" + BuildingSensorsForLeftMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForLeftMap[node] == tallSensor) {\n      continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      strdebug += \" -- \" + i;\n\n      BurningBuildings[ShortBuildingsLeft[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsLeft[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n} else {\n  BurningBuildings[TallBuildingsRight[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsRight[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsRight[tallBuildingBurning]);\n\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForRightMap[TallBuildingsRight[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn. -- this takes a scal\n  // shortBuildingBurning is the one out of the right sensored shorts\n  for (const node of ShortBuildingsRight) {\n    strdebug += i + \":\" + BuildingSensorsForRightMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForRightMap[node] == tallSensor) {\n     continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      \n      BurningBuildings[ShortBuildingsRight[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsRight[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n}\n\n//Of the 4 that are left -- choose a random node\nvar lastOneHotspot = Math.floor(Math.random() * 4);\nvar lastOneHospotName = NonBurningNodes[lastOneHotspot];\n//Start picking random things\n//First set all buildings to not burning\nvar Hotspots =  new Map();\nfor (const node of AllNodes) {\n  Hotspots[node] = 0;\n}\nHotspots[lastOneHospotName] = 1;\n\n// Of the 2 that are burning -- \n\n//first setr all to 0\nvar FCS = new Map();\nfor (const node of AllNodes) {\n  FCS[node] = 0;\n}\n\nvar DPS = new Map();\nfor (const node of AllNodes) {\n  DPS[node] = 0;\n}\n\nvar Burn = new Map();\nfor (const node of AllNodes) {\n  Burn[node] = 0;\n}\n\n//Set Burning node values\nfor (const node of BurningNodes) {\n    DPS[node] = 4;\n    FCS[node] = 4;\n    Burn[node] = 1;\n}\n\n//Set these for the Initialize Match - TABLE BuildingWindowStatus to pick the sequence windows\nvar it = BurningNodes.values();\nglobal.set(\"burning1\",it.next().value);\nglobal.set(\"burning2\", it.next().value);\nglobal.set(\"lancedebug\", strdebug);\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\n\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"UPDATE Buildings SET\" \n      + \" COMMUNITY = '\" + COMMUNITYLEFT + \"'\"     \n      + \", BUILDING_SIZE = '\" + BuildingSizeForLeftMap[leftNodeName] + \"'\"     \n      + \", SENSOR_TYPE = '\" + BuildingSensorsForLeftMap[leftNodeName] + \"'\"     \n      + \", FIRE_ELIGIBLE = 1\"   \n      + \", HOTSPOT = \" + Hotspots[leftNodeName] \n      + \", BURNING_STATUS = \" + Burn[leftNodeName]  \n      + \", BLOCKED = \" + BuildingBlockedForLeftMap[leftNodeName] \n      + \", FCS = \" + FCS[leftNodeName]\n      + \", DPS = \" + DPS[leftNodeName]\n      + \", NUM_BAGS = 0\"   \n      + \", NUM_DROPS = 0 \"   \n      + \", TIMEOFMATCH = \" + timestamp  \n      +\" WHERE BUILDING_NAME='\"+ leftNodeName +\"' AND MATCH_NUM=\" +matchnum\n      +\";\\n\";\n  sql = sql + line;\n  \n}\n\n//initialize \nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n  var line = \"UPDATE Buildings SET\"\n    + \" COMMUNITY = '\" + COMMUNITYRIGHT + \"'\"\n    + \", BUILDING_SIZE = '\" + BuildingSizeForRightMap[rightNodeName] + \"'\"\n    + \", SENSOR_TYPE = '\" + BuildingSensorsForRightMap[rightNodeName] + \"'\"\n    + \", FIRE_ELIGIBLE = 1\" \n    + \", HOTSPOT = \" + Hotspots[rightNodeName]\n    + \", BURNING_STATUS = \" + Burn[rightNodeName]  \n    + \", BLOCKED = \" + BuildingBlockedForRightMap[rightNodeName]\n    + \", FCS = \" + FCS[rightNodeName]\n    + \", DPS = \" + DPS[rightNodeName]\n    + \", NUM_BAGS = 0\"\n    + \", NUM_DROPS = 0 \"\n    + \", TIMEOFMATCH = \" + timestamp\n    + \" WHERE BUILDING_NAME='\" + rightNodeName + \"' AND MATCH_NUM=\" + matchnum\n    + \";\\n\";\n  sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 240,
        "wires": [
            [
                "0aa61745968b6ee5",
                "cd1bf88c1e97229e"
            ]
        ]
    },
    {
        "id": "9bd9bd9e2fa74b8a",
        "type": "function",
        "z": "f74b301e4f22310f",
        "name": "ORIGINAL SQL - Initialize Match - TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft);\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight);\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n};\n\nconst BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n};\n\nconst BuildingBlockedForLeftMap = {\n  'LTO': 0,\n  'LTM': 0,\n  'LTI': 0,\n  'LBO': 0,\n  'LBM': 0,\n  'LBI': 0,\n};\n\nconst BuildingBlockedForRightMap = {\n  'RTO': 0,\n  'RTM': 0,\n  'RTI': 0,\n  'RBO': 0,\n  'RBM': 0,\n  'RBI': 0,\n};\n\n\n//Start picking random things\n//First set all buildings to not burning\nvar BurningBuildings = {};\nfor (const node of AllNodes) {\n  BurningBuildings[node] = 0;\n}\n\n//set a tall building burning, set sensor type\nvar tallSensor = \"\";\nvar tallBuildingBurning = Math.floor(Math.random() * 2);\nvar shortBuildingBurning = Math.floor(Math.random() * 2);\nif (startside=='LEFT') {\n  BurningBuildings[TallBuildingsLeft[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsLeft[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsLeft[tallBuildingBurning]);\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForLeftMap[TallBuildingsLeft[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn\n  for (const node of ShortBuildingsLeft) {\n    if (BuildingSensorsForLeftMap[node] != tallSensor) {\n      i++;\n    }\n    if ((i - 1) == shortBuildingBurning) {\n      BurningBuildings[ShortBuildingsLeft[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsLeft[node]);\n      BurningNodes.add(node);\n\n    }\n  }\n} else {\n  BurningBuildings[TallBuildingsRight[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsRight[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsRight[tallBuildingBurning]);\n\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForRightMap[TallBuildingsRight[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn\n  for (const node of ShortBuildingsRight) {\n    if (BuildingSensorsForRightMap[node] != tallSensor) {\n      i++;\n    }\n    if ((i - 1) == shortBuildingBurning) {\n      BurningBuildings[ShortBuildingsRight[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsRight[node]);\n      BurningNodes.add(node);\n    }\n  }\n}\n\n//Of the 4 that are left -- choose a random node\nvar lastOneHotspot = Math.floor(Math.random() * 4);\nvar lastOneHospotName = NonBurningNodes[lastOneHotspot];\n//Start picking random things\n//First set all buildings to not burning\nvar Hotspots =  new Map();\nfor (const node of AllNodes) {\n  Hotspots[node] = 0;\n}\nHotspots[lastOneHospotName] = 1;\n\n// Of the 2 that are burning -- \n\nvar FCS = new Map();\nfor (const node of AllNodes) {\n  FCS[node] = 0;\n}\n\nvar DPS = new Map();\nfor (const node of AllNodes) {\n  DPS[node] = 0;\n}\n\nvar i = 0;\nfor (const node of BurningNodes) {\n    DPS[node] = 1;\n    FCS[node] = 1;\n}\n\n//Set these for the Initialize Match - TABLE BuildingWindowStatus to pick the sequence windows\nglobal.set(\"burning1\",BurningNodes[0]);\nglobal.set(\"burning2\", BurningNodes[1]);\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" \n      + leftNodeName + \"','\" \n      + COMMUNITYLEFT + \"','\" \n      + BuildingSizeForLeftMap[leftNodeName] \n      + \"','\" + BuildingSensorsForLeftMap[leftNodeName] \n      + \"',1,\" +\n      Hotspots[leftNodeName] +\n      \", 0,\" \n      + BuildingBlockedForLeftMap[leftNodeName]\n      + \", \" + FCS[leftNodeName] \n      + \", \" + DPS[leftNodeName] \n      +\", 0, 0,\" \n      + timestamp + \");\\n \";\n  sql = sql + line;\n  \n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\"\n      + rightNodeName + \"','\"\n      + COMMUNITYRIGHT + \"','\"\n      + BuildingSizeForRightMap[rightNodeName]\n      + \"','\" + BuildingSensorsForRightMap[rightNodeName]\n      + \"',1,\" \n      +Hotspots[rightNodeName] \n      +\", 0,\" \n      + BuildingBlockedForRightMap[rightNodeName]\n      + \", \" + FCS[rightNodeName] \n      + \", \" + DPS[rightNodeName] \n      + \",0, 0,\"\n      + timestamp + \"); \\n\";\n    sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "0aa61745968b6ee5",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildings For Match",
        "x": 2010,
        "y": 240,
        "wires": [
            [
                "e354ec1a31284c79",
                "0692d55544c5bd31"
            ]
        ]
    },
    {
        "id": "18fb71a97e22a4a8",
        "type": "debug",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Current Game Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 1400,
        "wires": []
    },
    {
        "id": "6b1897b0ddc816e3",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL - Calculate and Update - Initialize Match - TABLE BuildingWindowStatus",
        "func": "\nvar d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nconst NodesForLeft = ['LTO', 'LTM', 'LTI', 'LBO', 'LBM', 'LBI'];\nconst NodesForRight = ['RTO', 'RTM', 'RTI', 'RBO', 'RBM', 'RBI'];\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst numSides = 4;\n\n\n//This is how we pass in the burning buildings from the intialation of the building\nvar burningNode1 = global.get(\"burning1\");\nvar burningNode2 = global.get(\"burning2\");\n\n\nvar WindowsActive = new Map();\nvar WindowSequence = new Map();//Dom added\nvar DamagePreventionScore = new Map();//Dom added\n\nfor (const node of AllNodes) {\n  var whichSet = 10;\n  if (node == burningNode1 || node == burningNode2) {\n    whichSet=Math.floor(Math.random() * 2);\n  }\n  if (whichSet ==10) {\n    for (var i = 1; i <= 4; i++) {\n      var nodepluswin = node + i + '';\n      WindowsActive[nodepluswin] = 0;\n      WindowSequence[nodepluswin] = 0;//Dom added\n      DamagePreventionScore[nodepluswin] = 2;\n    }\n  } else if (whichSet == 0) {\n    WindowsActive[node + \"1\"] = 2;\n    WindowSequence[node + \"1\"] = 2;//Dom added\n    DamagePreventionScore[node + \"1\"] = 0;//Dom added\n    WindowsActive[node + \"2\"] = 0;\n    WindowSequence[node + \"2\"] = 3;//Dom added\n    DamagePreventionScore[node + \"2\"] = 2;//Dom added\n    WindowsActive[node + \"3\"] = 2;\n    WindowSequence[node + \"3\"] = 1;//Dom added\n    DamagePreventionScore[node + \"3\"] = 0;//Dom added\n    WindowsActive[node + \"4\"] = 0;\n    WindowSequence[node + \"4\"] = 4;//Dom added\n    DamagePreventionScore[node + \"4\"] = 2;//Dom added\n  } else if (whichSet == 1) {\n    WindowsActive[node + \"1\"] = 2;\n    WindowSequence[node + \"1\"] = 2;//Dom added\n    DamagePreventionScore[node + \"1\"] = 0;//Dom added\n    WindowsActive[node + \"2\"] = 2;\n    WindowSequence[node + \"2\"] = 1;//Dom added\n    DamagePreventionScore[node + \"2\"] = 0;//Dom added\n    WindowsActive[node + \"3\"] = 0;\n    WindowSequence[node + \"3\"] = 3;//Dom added\n    DamagePreventionScore[node + \"3\"] = 2;//Dom added\n    WindowsActive[node + \"4\"] = 0;\n    WindowSequence[node + \"4\"] = 4;//Dom added\n    DamagePreventionScore[node + \"4\"] = 2;//Dom added\n  }\n}\n\n\n\n/*\nCREATE TABLE BuildingWindowStatus(\n  MATCH_NUM INT NOT NULL,\n  BUILDING_NAME VARCHAR[32],\n  COMMUNITY INT NOT NULL,\n  BUILDING_SIDE INT NOT NULL,\n  WINDOWS_ACTIVE INT,\n  NUM_HITS INT NOT NULL,\n  TIMEOFMATCH INT NOT NULL,\n  PRIMARY KEY(MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n  for (var i = 1; i <= 4; i++) {\n    var nodepluswin = leftNodeName + i + '';\n    //Dom updated\n    var line = \"UPDATE BuildingWindowStatus SET \"\n      + \" COMMUNITY = '\" + COMMUNITYLEFT + \"'\"   \n      + \", WINDOWS_ACTIVE = \" + WindowsActive[nodepluswin]\n      + \", WINDOW_SEQUENCE = \" + WindowSequence[nodepluswin]\n      + \", DAMAGE_PREVENTION_SCORE = \" + DamagePreventionScore[nodepluswin]\n      + \", NUM_HITS = 0 \"\n      + \", TIMEOFMATCH = \" + timestamp\n      + \" WHERE MATCH_NUM=\" + matchnum + \" AND BUILDING_NAME='\" + leftNodeName + \"' AND BUILDING_SIDE=\" + i\n      +\";\";\n    sql = sql + line;\n  }\n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n  for (var i = 1; i <= 4; i++) {\n    var nodepluswin = rightNodeName + i;\n    //Dom updated\n    var line = \"UPDATE BuildingWindowStatus SET \"\n      + \" COMMUNITY = '\" + COMMUNITYRIGHT + \"'\" \n      + \", WINDOWS_ACTIVE = \" + WindowsActive[nodepluswin]\n      + \", WINDOW_SEQUENCE = \" + WindowSequence[nodepluswin]\n      + \", DAMAGE_PREVENTION_SCORE = \" + DamagePreventionScore[nodepluswin]\n      + \", NUM_HITS = 0 \"\n      + \", TIMEOFMATCH = \" + timestamp\n      + \" WHERE MATCH_NUM=\" + matchnum + \" AND BUILDING_NAME='\" + rightNodeName + \"' AND BUILDING_SIDE=\" + i\n      + \";\";\n    sql = sql + line;\n  }\n}\n\n\n\nmsg.topic = sql; \nmsg.lance = burningNode1;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 420,
        "wires": [
            [
                "806da0dcb41029ca",
                "cd1bf88c1e97229e"
            ]
        ]
    },
    {
        "id": "806da0dcb41029ca",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildingsWindows For Match",
        "x": 2260,
        "y": 420,
        "wires": [
            [
                "77a83cc806cc1911"
            ]
        ]
    },
    {
        "id": "dd2bda159bd6865c",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Latest Match Hits Table Dump",
        "func": "\n\nvar matchid = global.get(\"matchnum\");\nvar newMsg = {\n    \"topic\": \"SELECT B.MATCH_NUM, B.BUILDING_NAME, BWS.BUILDING_SIDE, B.NUM_BAGS, B.NUM_DROPS, BWS.NUM_HITS FROM Buildings B INNER JOIN BuildingWindowStatus BWS \" \n        + \"on B.MATCH_NUM = BWS.MATCH_NUM AND B.BUILDING_NAME=BWS.BUILDING_NAME \"\n         +  \"WHERE B.MATCH_NUM = \" + matchid + \";\" \n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 1480,
        "wires": [
            [
                "9ba69fd69ae011c7",
                "abf14147cd05c8bd"
            ]
        ]
    },
    {
        "id": "8d86d9b8f1326f1b",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Result Dump",
        "func": "//CREATE TABLE GAMETEST(MATCH_NUM INTEGER PRIMARY KEY AUTOINCREMENT, BUILDING_ID VARCHAR(32), FIRE_SCORE INT NOT NULL, NUM_TREES INT NOT NULL, TIMEOFMATCH INT NOT NULL);  \n\n\n//var str = \"match: \" + msg.payload[0].MATCH_NUM + \" trees:\" + msg.payload[0].NUM_TREES + \" FIRE:\" + msg.payload[0].FIRE_SCORE + \" LASER HITS:\" + msg.payload[0].NUM_HITS;\n//msg.payload = str;\nlet newrow = []\nlet title = [\"MATCH_NUM\",\"NODE_ID\",\t\"SIDE_ID\",\"FIRE_SCORE\",\"NUM_TREES\",\"NUM_HITS\",\"NUM_DROPS\",\"NUM_BAGS\",\"TIMEOFMATCH\"]\ntitle.push()\nfor (var i=0;i<msg.payload.length;i++) {\n    var row = msg.payload[i];\n    if (\n        row.NUM_HITS != 0 ||\n        row.NUM_DROPS != 0 || \n        row.NUM_BAGS != 0) {\n        newrow.push(row);\n        } \n}\nmsg.payload = newrow;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1480,
        "wires": [
            [
                "ad3020e3fc7099e8",
                "abf14147cd05c8bd"
            ]
        ]
    },
    {
        "id": "9ba69fd69ae011c7",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 610,
        "y": 1480,
        "wires": [
            [
                "8d86d9b8f1326f1b",
                "abf14147cd05c8bd"
            ]
        ]
    },
    {
        "id": "ca18ad730b62784e",
        "type": "link in",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Dump to Debug Latest Hits Match",
        "links": [
            "b988ed62abb07361",
            "c30231dee65db09d"
        ],
        "x": 125,
        "y": 1480,
        "wires": [
            [
                "dd2bda159bd6865c"
            ]
        ]
    },
    {
        "id": "ad3020e3fc7099e8",
        "type": "link out",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "link out 43",
        "links": [
            "c5b51aa2f4863b48",
            "28eb2bc55dcddb70"
        ],
        "x": 965,
        "y": 1480,
        "wires": []
    },
    {
        "id": "abf14147cd05c8bd",
        "type": "debug",
        "z": "f74b301e4f22310f",
        "g": "650381ccef7c28a3",
        "name": "Current Game Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 1640,
        "wires": []
    },
    {
        "id": "d88db86de710b8e9",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "152a8cb72061205a",
        "name": "SQL - Update FSHit (ADD)",
        "func": "var matchid = global.get(\"matchnum\");\nvar o = msg.payload;\nvar fs = o['FCS'];\nvar nodeid = o['BUILDING_NAME'];\n\n/*\no['FS'] = 1;\no['BUILDING_NAME'] = o['node_id'];\nmsg.topic = \"nodered/firescore/\" + o['node_id'];\n*/\n\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FCS = FCS + \" \n    + fs + \" WHERE MATCH_NUM = \" \n    + matchid + \" AND BUILDING_NAME='\" + nodeid +\"'\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 140,
        "wires": [
            [
                "3a4b12e5b9609b0d"
            ]
        ]
    },
    {
        "id": "77a83cc806cc1911",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL - What building is Laser?",
        "func": "//Start of match SQL to determine which active building is Laser\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT Buildings.BUILDING_NAME FROM Buildings WHERE (((Buildings.SENSOR_TYPE)='Laser') AND ((Buildings.BURNING_STATUS)=True))\";\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2580,
        "y": 480,
        "wires": [
            [
                "31fbf44c69967dc6"
            ]
        ]
    },
    {
        "id": "31fbf44c69967dc6",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 2780,
        "y": 480,
        "wires": [
            [
                "9d5a3a60e2f7a702"
            ]
        ]
    },
    {
        "id": "9d5a3a60e2f7a702",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Retreive Laser Building",
        "func": "//SQLite results; laser building\n\nvar laserbuilding = msg.payload[0].BUILDING_NAME;\nmsg.laser_building = laserbuilding\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2960,
        "y": 480,
        "wires": [
            [
                "3906a1f3b5aae88b"
            ]
        ]
    },
    {
        "id": "3906a1f3b5aae88b",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL - What building is Ball?",
        "func": "//Start of match SQL to determine which active building is Ball\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT Buildings.BUILDING_NAME FROM Buildings WHERE (((Buildings.SENSOR_TYPE)='Ball') AND ((Buildings.BURNING_STATUS)=True))\";\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2570,
        "y": 520,
        "wires": [
            [
                "886f1bf59dfd0f7e"
            ]
        ]
    },
    {
        "id": "886f1bf59dfd0f7e",
        "type": "sqlite",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 2780,
        "y": 520,
        "wires": [
            [
                "2e54183334f1fc80"
            ]
        ]
    },
    {
        "id": "2e54183334f1fc80",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Retreive Ball Building",
        "func": "//SQLite results; ball building\n\nvar ballbuilding = msg.payload[0].BUILDING_NAME;\nmsg.ball_building = ballbuilding\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2950,
        "y": 520,
        "wires": [
            [
                "6cf089b32235b868"
            ]
        ]
    },
    {
        "id": "6cf089b32235b868",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Starting Buildings",
        "func": "\nmsg.payload = \"Laser: \" + msg.laser_building + \"   Ball: \" + msg.ball_building;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2540,
        "y": 560,
        "wires": [
            [
                "57063f0af227550c"
            ]
        ]
    },
    {
        "id": "57063f0af227550c",
        "type": "debug",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Starting Buildings",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2740,
        "y": 560,
        "wires": []
    },
    {
        "id": "39e74dd8054364ef",
        "type": "comment",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "Dom added for convenience",
        "info": "Added this flow for testing convenience to provide start-of-match active building names",
        "x": 2570,
        "y": 440,
        "wires": []
    },
    {
        "id": "890050b7a3592bf1",
        "type": "inject",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "name": "Create Game Table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 200,
        "wires": [
            [
                "6b73945a30a3b156"
            ]
        ]
    },
    {
        "id": "6b73945a30a3b156",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "CREATE TABLE MATCH_STATE(\nMATCH_NUM INTEGER PRIMARY KEY AUTOINCREMENT,\nACTIVE_COMMUNITY VARCHAR(8),\nTIMEOFMATCH INT NOT NULL);  \n",
        "name": "Create Match Table",
        "x": 590,
        "y": 200,
        "wires": [
            [
                "544ae34808a17523",
                "1c0c1219794c876a",
                "9ab5c8b230048e8b"
            ]
        ]
    },
    {
        "id": "323e92765149313d",
        "type": "inject",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "name": "INSERT New Match  with Random Game Event",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 960,
        "wires": [
            [
                "deb6a8cb5bd78b0e"
            ]
        ]
    },
    {
        "id": "d7e91528f5c8f1d6",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 330,
        "y": 580,
        "wires": [
            [
                "f406a76e56b92d05"
            ]
        ]
    },
    {
        "id": "deb6a8cb5bd78b0e",
        "type": "function",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "name": "Create Sql Random Game Event",
        "func": "//CREATE TABLE GAMETEST(TIMESTAMP INT PRIMARY KEY NOT NULL, MATCH_NUM INT NOT NULL, BUILDING_ID VARCHAR(32), FIRE_SCORE INT NOT NULL, NUM_TREES INT NOT NULL);  )\n\nvar fireScore = Math.round(Math.random() * 10);\nvar numTrees = Math.round(Math.random() * 10);\nvar numHits = Math.round(Math.random() * 10);\n\nvar buildingId = \"LM1\";\n//could read last match num and send to this? or enter\nvar timestamp = msg.payload;\nvar newMsg = {\n    \"topic\": \"INSERT INTO GAMETEST (FIRE_SCORE,NUM_TREES, NUM_HITS, TIMEOFMATCH) VALUES ( \" + fireScore + \", \" + numTrees + \", \" + numHits + \", \"+ timestamp + \")\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 960,
        "wires": [
            [
                "f17cfb3701f218bb"
            ]
        ]
    },
    {
        "id": "f406a76e56b92d05",
        "type": "debug",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "name": "SQL Write Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 580,
        "wires": []
    },
    {
        "id": "43ddc5a441c4fd3f",
        "type": "link in",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "name": "genericSql",
        "links": [
            "cdb9035ee521bb85",
            "3e88982af6e3f40a",
            "b495418c6c4b995b",
            "3a4b12e5b9609b0d",
            "36875745f8a09dcd",
            "91eeec4cfa6d85ca",
            "a37728c272928fcb"
        ],
        "x": 175,
        "y": 580,
        "wires": [
            [
                "d7e91528f5c8f1d6"
            ]
        ]
    },
    {
        "id": "205cfd1b6882a75f",
        "type": "inject",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "name": "Drop Game Table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "3472ec7018175754",
                "82f12a1e14f33b59",
                "85525cb2f906b575"
            ]
        ]
    },
    {
        "id": "3472ec7018175754",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "DROP TABLE IF EXISTS MATCH_STATE;",
        "name": "Drop MATCH table",
        "x": 590,
        "y": 120,
        "wires": [
            [
                "82f12a1e14f33b59"
            ]
        ]
    },
    {
        "id": "544ae34808a17523",
        "type": "debug",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1400,
        "y": 100,
        "wires": []
    },
    {
        "id": "d68e0db08f5b39fe",
        "type": "comment",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "name": "SQL-Lite Management and installation notes",
        "info": "We could distribute an image with the sqlite node alreaduy installed -- but this is the instructions to install it:\n\nTo install:\n cd ~/.node-red/\n npm i --unsafe-perm node-red-node-sqlite\n\nCreate this directory (to store the database):\nmkdir /home/pi/sqlite-storage\n\nThe database is configured in node red with the file:\n/home/pi/sqlite-storage/sqlite\n\nNote that the first time you create a table, it will automatically create the file in the directory and start writing to it.\n\n Then just run the following injections to create the table:\n \"Create Game Table\"\n\n if you want to drop the table and start over:\n \"Drop Game Table\"\n\n There are several other injections that allow to test everything out.\n",
        "x": 230,
        "y": 80,
        "wires": []
    },
    {
        "id": "f17cfb3701f218bb",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 890,
        "y": 960,
        "wires": [
            [
                "d8a5d35c8d38a3d3",
                "bb20e976f6f77ed1"
            ]
        ]
    },
    {
        "id": "d8a5d35c8d38a3d3",
        "type": "debug",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 960,
        "wires": []
    },
    {
        "id": "bb20e976f6f77ed1",
        "type": "link out",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "name": "link out 3",
        "links": [
            "6864183a6d7d2b25"
        ],
        "x": 1095,
        "y": 880,
        "wires": []
    },
    {
        "id": "c940c00eb130609a",
        "type": "comment",
        "z": "8b4b6895c0ec29ec",
        "g": "aa1431e66ec37b16",
        "name": "BROKEN Insert New Match - TEST MATCH (For Testing only)",
        "info": "",
        "x": 280,
        "y": 900,
        "wires": []
    },
    {
        "id": "92a4b7e1ddc01aaf",
        "type": "comment",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "name": "Generic SQL Access for Writes",
        "info": "",
        "x": 190,
        "y": 520,
        "wires": []
    },
    {
        "id": "1c0c1219794c876a",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "CREATE TABLE BuildingWindowStatus (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nCOMMUNITY VARCHAR[12] NOT NULL,\nBUILDING_SIDE INT NOT NULL,\nWINDOW_SEQUENCE INT,\nWINDOWS_ACTIVE INT,\nDAMAGE_PREVENTION_SCORE INT,\nNUM_HITS INT NOT NULL,\nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));",
        "name": "Create BuildingWindowStatus",
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "544ae34808a17523"
            ]
        ]
    },
    {
        "id": "82f12a1e14f33b59",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "DROP TABLE IF EXISTS Buildings;\n",
        "name": "Drop BuildingsTable",
        "x": 820,
        "y": 100,
        "wires": [
            [
                "544ae34808a17523"
            ]
        ]
    },
    {
        "id": "cbc94139020ca0b7",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 450,
        "y": 680,
        "wires": [
            [
                "27c12a21983f359e"
            ]
        ]
    },
    {
        "id": "27c12a21983f359e",
        "type": "debug",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "name": "SQL Write Debug - Special",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 640,
        "wires": []
    },
    {
        "id": "f6566f17a1e9b78e",
        "type": "link in",
        "z": "8b4b6895c0ec29ec",
        "g": "f630143dd6413aac",
        "name": "genericSql-special",
        "links": [
            "d527904ed8723b40",
            "a87aaf575c427de3"
        ],
        "x": 175,
        "y": 660,
        "wires": [
            [
                "cbc94139020ca0b7",
                "27c12a21983f359e"
            ]
        ]
    },
    {
        "id": "9ab5c8b230048e8b",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "CREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY VARCHAR[12] NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));",
        "name": "Create Buildings table",
        "x": 980,
        "y": 260,
        "wires": [
            [
                "544ae34808a17523"
            ]
        ]
    },
    {
        "id": "85525cb2f906b575",
        "type": "sqlite",
        "z": "8b4b6895c0ec29ec",
        "g": "f69756401f15d7b4",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "DROP TABLE IF EXISTS BuildingWindowStatus ;",
        "name": "Drop BuildingWindowStatusTable",
        "x": 1080,
        "y": 120,
        "wires": [
            [
                "544ae34808a17523"
            ]
        ]
    },
    {
        "id": "f4b7c4c243db620d",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Read Config Node ID",
        "x": 440,
        "y": 1400,
        "wires": [
            [
                "2bcc56e6d241c3d9"
            ]
        ]
    },
    {
        "id": "837b88b53ec5549a",
        "type": "mqtt in",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "edgenode/initialization",
        "topic": "edgenode/initialization",
        "qos": "2",
        "datatype": "utf8",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 1320,
        "wires": [
            [
                "0faf666bf00276e9"
            ]
        ]
    },
    {
        "id": "5bdc6b89364fd15a",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Config Setup Instructions",
        "info": "Config for the field contains the mapping of UUID (as written to each arduino board) and the node id as defined in the field diagram (containing LBO, RBO, etc)\n\n1. Write a text file in the following format:\nEDGE_UUID,EDGE_NODE_ID\n7452C441,LBO\n7452C442,LBM\n...\n\n2. Place on the raspberry pi in this location:\n/home/pi/field-config.csv\n    2.a -- emergency option, you can force a config down in the \"Write config to file\"  flow below -- see instructions there\n\n3. Create and/or drop then create the \"Create Config Table\"\n4. Run \"Load Config File into Config Table\"\n\n",
        "x": 270,
        "y": 700,
        "wires": []
    },
    {
        "id": "9bca7655eb1d89cf",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "CREATE TABLE FIELD_CONFIG (\n  EDGE_UUID TEXT PRIMARY KEY,\n  EDGE_NODE_ID TEXT\n)",
        "name": "Create Config Table",
        "x": 690,
        "y": 800,
        "wires": [
            [
                "cf58eb77138066b2"
            ]
        ]
    },
    {
        "id": "c7fe99b0e0506601",
        "type": "inject",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Load Config File into Config Table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 880,
        "wires": [
            [
                "8c0e6a2a0a04fcd7"
            ]
        ],
        "info": "See instructions on top -- but file is:\n/home/pi/field-config.csv"
    },
    {
        "id": "8c0e6a2a0a04fcd7",
        "type": "file in",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Read Field Config",
        "filename": "/home/pi/field-config.csv",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 470,
        "y": 920,
        "wires": [
            [
                "340a8ade18808c45"
            ]
        ]
    },
    {
        "id": "340a8ade18808c45",
        "type": "csv",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "CSV Parse Field Config",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "one",
        "ret": "\\n",
        "temp": "",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 690,
        "y": 920,
        "wires": [
            [
                "c58252a4cb097661"
            ]
        ]
    },
    {
        "id": "cf58eb77138066b2",
        "type": "debug",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 820,
        "wires": []
    },
    {
        "id": "9dd0a2d0ffb6a743",
        "type": "inject",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Create Config Table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 800,
        "wires": [
            [
                "9bca7655eb1d89cf"
            ]
        ]
    },
    {
        "id": "4215a3196c228639",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SqlLite Commands",
        "x": 1090,
        "y": 920,
        "wires": [
            [
                "cf58eb77138066b2"
            ]
        ]
    },
    {
        "id": "c58252a4cb097661",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Construct SQL",
        "func": "var o = msg.payload;\nvar sql = \"INSERT INTO \\\"FIELD_CONFIG\\\"(EDGE_UUID, EDGE_NODE_ID) VALUES(\\\"\"+o.EDGE_UUID+\"\\\", \\\"\"+o.EDGE_NODE_ID+\"\\\") ON CONFLICT(EDGE_UUID) DO UPDATE SET EDGE_NODE_ID = excluded.EDGE_NODE_ID;\";\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 920,
        "wires": [
            [
                "4215a3196c228639"
            ]
        ]
    },
    {
        "id": "579c8c19ccab0937",
        "type": "inject",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Drop Config Table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 760,
        "wires": [
            [
                "a74d42b7ae961652"
            ]
        ]
    },
    {
        "id": "a74d42b7ae961652",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "DROP TABLE IF EXISTS FIELD_CONFIG;",
        "name": "Drop Field Config Table",
        "x": 710,
        "y": 760,
        "wires": [
            [
                "cf58eb77138066b2"
            ]
        ]
    },
    {
        "id": "ac6ab4bb77d73dc4",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Construct SQL",
        "func": "var o = msg.payload;\nvar sql = \"SELECT EDGE_NODE_ID, EDGE_UUID FROM FIELD_CONFIG WHERE EDGE_UUID='\" + o.uuid+ \"'\" ;\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 1320,
        "wires": [
            [
                "f4b7c4c243db620d"
            ]
        ]
    },
    {
        "id": "0faf666bf00276e9",
        "type": "json",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 470,
        "y": 1320,
        "wires": [
            [
                "ac6ab4bb77d73dc4"
            ]
        ]
    },
    {
        "id": "2bcc56e6d241c3d9",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "extract nodeid",
        "func": "\nvar nodeid = msg.payload[0].EDGE_NODE_ID;\nvar nodeuuid = msg.payload[0].EDGE_UUID;\nmsg.payload = nodeid;\nmsg.topic = \"nodered/initialization/\" + nodeuuid;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 1400,
        "wires": [
            [
                "feddd1768611c551",
                "e1a86479aff7db29"
            ]
        ]
    },
    {
        "id": "feddd1768611c551",
        "type": "mqtt out",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Publish Node ID to edge Node",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 930,
        "y": 1400,
        "wires": []
    },
    {
        "id": "b111193564f5a7a0",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Initialize Edge Nodes ",
        "info": "Edge nodes report in when they come online with a UUID\nUUID is accessed from the DB, and returned as a Node ID (as defined by our field layout/diagram)\n\nSee Load Config File into Config Table flow for how to edit this\n\nEach Arduino needs a unique id written into eeprom using -> https://github.com/lanceriedel/burn-uuid-eeprom\n",
        "x": 280,
        "y": 1260,
        "wires": []
    },
    {
        "id": "97e2f252303bfcf3",
        "type": "inject",
        "z": "f3ec5d556e86f8d0",
        "g": "2024311963b7a70e",
        "name": "Write config to file",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[69,68,71,69,95,85,85,73,68,44,69,68,71,69,95,78,79,68,69,95,73,68,10,55,52,53,50,67,52,52,49,44,76,66,79,10,55,52,53,50,67,52,52,50,44,76,66,77,10,55,66,68,56,51,65,49,51,44,82,66,77,10,55,48,57,67,68,66,70,70,44,82,66,79]",
        "payloadType": "bin",
        "x": 1310,
        "y": 1380,
        "wires": [
            [
                "a1e6f1282aa6e63a"
            ]
        ],
        "info": "If you can't access the raspberry pi file system -- you can put the config here and force write it\nBUT -- you have to send as binary so that it retains the newlines\n\nFor example:\nEDGE_UUID,EDGE_NODE_ID\n7452C441,LBO\n7452C442,LBM\n7BD83A13,RBM\n709CDBFF,RBO\n\n\nBe sure to hit the elipses ...  so that you can see what you are typing.  \nAlso note that it will change to binary as soon as you send -- but it will work fine"
    },
    {
        "id": "a1e6f1282aa6e63a",
        "type": "file",
        "z": "f3ec5d556e86f8d0",
        "g": "2024311963b7a70e",
        "name": "",
        "filename": "/home/pi/field-config.csv",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1570,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "b70ae83c222fa7da",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "2024311963b7a70e",
        "name": "Emergency Use! Write config -  (you need to load it after)",
        "info": "If you can't access the raspberry pi file system -- you can put the config here and force write it\nBUT -- you have to send as binary so that it retains the newlines\nFor example:\nEDGE_UUID,EDGE_NODE_ID\n7452C441,LBO\n7452C442,LBM\n7BD83A13,RBM\n709CDBFF,RBO\n\n\n\n\nBe sure to hit the elipses ...  so that you can see what you are typing.  \nAlso note that it will change to binary as soon as you send -- but it will work fine",
        "x": 1400,
        "y": 1340,
        "wires": []
    },
    {
        "id": "3dd25f169354ef22",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "fixed",
        "sql": "Select * from FIELD_CONFIG;",
        "name": "Read Config",
        "x": 450,
        "y": 1020,
        "wires": [
            [
                "ad34ea44766153db"
            ]
        ]
    },
    {
        "id": "6f32fc52a4d53df8",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "Read Config",
        "links": [
            "5870cb8ac8846724",
            "f03d05829f9254f9"
        ],
        "x": 285,
        "y": 1020,
        "wires": [
            [
                "3dd25f169354ef22"
            ]
        ]
    },
    {
        "id": "ad34ea44766153db",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "a83bb00d46efe804",
        "name": "link out 29",
        "links": [
            "4369b98b6d58fe86"
        ],
        "x": 615,
        "y": 1020,
        "wires": []
    },
    {
        "id": "161f3cee4bd60724",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Insert UUI Entry",
        "links": [
            "99f3e6c97f2c0d2b"
        ],
        "x": 175,
        "y": 1180,
        "wires": [
            [
                "b1e8ab6feba986c9"
            ]
        ]
    },
    {
        "id": "b1e8ab6feba986c9",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Construct SQL",
        "func": "var o = msg.payload;\nvar sql = \"INSERT INTO \\\"FIELD_CONFIG\\\"(EDGE_UUID, EDGE_NODE_ID) VALUES(\\\"\"+o.EDGE_UUID+\"\\\", \\\"\"+o.EDGE_NODE_ID+\"\\\") ON CONFLICT(EDGE_UUID) DO UPDATE SET EDGE_NODE_ID = excluded.EDGE_NODE_ID;\";\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1180,
        "wires": [
            [
                "4b72a159e1e82517"
            ]
        ]
    },
    {
        "id": "4b72a159e1e82517",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SqlLite Commands",
        "x": 510,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "c79cb601a8c0ab17",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "e63633ec18181ba7",
        "name": "Add Single Edge Node",
        "info": "Update single node entry",
        "x": 260,
        "y": 1140,
        "wires": []
    },
    {
        "id": "9f34def0af02efeb",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "bc92f0b2168e67b1",
        "name": "Construct SQL",
        "func": "var o = msg.payload;\nvar sql = \"DELETE FROM \\\"FIELD_CONFIG\\\" WHERE EDGE_UUID=\\\"\"+o.EDGE_UUID+\"\\\";\";\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 1160,
        "wires": [
            [
                "80e1d2d095f19693"
            ]
        ]
    },
    {
        "id": "80e1d2d095f19693",
        "type": "sqlite",
        "z": "f3ec5d556e86f8d0",
        "g": "bc92f0b2168e67b1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SqlLite Commands",
        "x": 1570,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "ac5d35d999fc40b9",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "bc92f0b2168e67b1",
        "name": "Remove Single Edge Node",
        "info": "Update single node entry",
        "x": 1310,
        "y": 1120,
        "wires": []
    },
    {
        "id": "cd811a5da6dea1c9",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "bc92f0b2168e67b1",
        "name": "Delete UUI Entry",
        "links": [
            "9e93acca6dde891c"
        ],
        "x": 1215,
        "y": 1160,
        "wires": [
            [
                "9f34def0af02efeb"
            ]
        ]
    },
    {
        "id": "f86871afbc03993e",
        "type": "mqtt out",
        "z": "f3ec5d556e86f8d0",
        "g": "7ceda8dc6f5a8d60",
        "name": "Broadcast Laser Diff",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 800,
        "y": 1600,
        "wires": []
    },
    {
        "id": "91b03956f65107e7",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "7ceda8dc6f5a8d60",
        "name": "assemble mqtt message",
        "func": "var o = msg.payload;\n\nvar t = \"{ \\\"DETECTOR_DIFF\\\": \\\"\" + o.diff + \"\\\"}\";\nmsg.payload = t;\n//nodered/firescore/[node id]\nmsg.topic = \"nodered/laserdiff\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1600,
        "wires": [
            [
                "f86871afbc03993e"
            ]
        ]
    },
    {
        "id": "7a6d7007d9d5ec67",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "7ceda8dc6f5a8d60",
        "name": "Broadcast Laser Diff Change",
        "links": [
            "c1f7e764f490f914"
        ],
        "x": 225,
        "y": 1600,
        "wires": [
            [
                "91b03956f65107e7"
            ]
        ]
    },
    {
        "id": "ccf03d13258bb4e3",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "7ceda8dc6f5a8d60",
        "name": "Broadcast Laser Diff Change",
        "info": "",
        "x": 280,
        "y": 1540,
        "wires": []
    },
    {
        "id": "e2b27e9faf37bd1e",
        "type": "mqtt out",
        "z": "f3ec5d556e86f8d0",
        "g": "96cafb8e88dad064",
        "name": "Broadcast Query Latest Tare",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 820,
        "y": 1780,
        "wires": []
    },
    {
        "id": "6331f7057ebfd37c",
        "type": "function",
        "z": "f3ec5d556e86f8d0",
        "g": "96cafb8e88dad064",
        "name": "assemble mqtt message",
        "func": "var o = msg.payload;\n\nvar t = \"{ }\";\nmsg.payload = t;\n//nodered/firescore/[node id]\nmsg.topic = \"nodered/weighttare\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1780,
        "wires": [
            [
                "e2b27e9faf37bd1e"
            ]
        ]
    },
    {
        "id": "bc8a6edecc1a9a5c",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "96cafb8e88dad064",
        "name": "Broadcast TareQuery",
        "links": [
            "c1f7e764f490f914",
            "4bdef8d87b5da823"
        ],
        "x": 225,
        "y": 1780,
        "wires": [
            [
                "6331f7057ebfd37c"
            ]
        ]
    },
    {
        "id": "c74fb766b19e2bf1",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "96cafb8e88dad064",
        "name": "Broadcast Query for Weight Tare",
        "info": "Reported back through a separate message\nedgenode/latesttare/",
        "x": 290,
        "y": 1720,
        "wires": []
    },
    {
        "id": "e1a86479aff7db29",
        "type": "debug",
        "z": "f3ec5d556e86f8d0",
        "name": "Node id to fields MQTT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 820,
        "wires": []
    },
    {
        "id": "f8aa15da571b3aae",
        "type": "ui_text",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "group": "a5991f3b10b51e7c",
        "order": 3,
        "width": "6",
        "height": "4",
        "name": "Loaded Values",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 700,
        "y": 220,
        "wires": []
    },
    {
        "id": "dfeaa41a75adbf51",
        "type": "ui_button",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "Submit",
        "group": "a5991f3b10b51e7c",
        "order": 4,
        "width": "0",
        "height": "0",
        "passthru": false,
        "label": "Current Config Dump",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 280,
        "y": 220,
        "wires": [
            [
                "5870cb8ac8846724",
                "a11c3ee5796d07f2"
            ]
        ]
    },
    {
        "id": "f4c6348e4bde4c20",
        "type": "ui_form",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "",
        "label": "Add UUID Mapping",
        "group": "a5991f3b10b51e7c",
        "order": 1,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Arduino UUID",
                "value": "EDGE_UUID",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Node ID",
                "value": "EDGE_NODE_ID",
                "type": "text",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "EDGE_UUID": "",
            "EDGE_NODE_ID": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "x": 310,
        "y": 320,
        "wires": [
            [
                "99f3e6c97f2c0d2b",
                "a11c3ee5796d07f2"
            ]
        ]
    },
    {
        "id": "5870cb8ac8846724",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 28",
        "links": [
            "6f32fc52a4d53df8"
        ],
        "x": 425,
        "y": 220,
        "wires": []
    },
    {
        "id": "4369b98b6d58fe86",
        "type": "link in",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "Config Display",
        "links": [
            "ad34ea44766153db"
        ],
        "x": 555,
        "y": 220,
        "wires": [
            [
                "f8aa15da571b3aae"
            ]
        ]
    },
    {
        "id": "99f3e6c97f2c0d2b",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 30",
        "links": [
            "161f3cee4bd60724"
        ],
        "x": 505,
        "y": 320,
        "wires": []
    },
    {
        "id": "02673478ac90323a",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "Dump Current Config",
        "info": "",
        "x": 320,
        "y": 160,
        "wires": []
    },
    {
        "id": "1dfa349788a1a948",
        "type": "ui_form",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "",
        "label": "Remove UUID Mapping",
        "group": "a5991f3b10b51e7c",
        "order": 2,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Arduino UUID",
                "value": "EDGE_UUID",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "EDGE_UUID": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "x": 330,
        "y": 400,
        "wires": [
            [
                "9e93acca6dde891c",
                "a11c3ee5796d07f2"
            ]
        ]
    },
    {
        "id": "9e93acca6dde891c",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 31",
        "links": [
            "cd811a5da6dea1c9"
        ],
        "x": 535,
        "y": 400,
        "wires": []
    },
    {
        "id": "a11c3ee5796d07f2",
        "type": "delay",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 600,
        "y": 280,
        "wires": [
            [
                "f03d05829f9254f9"
            ]
        ]
    },
    {
        "id": "f03d05829f9254f9",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 33",
        "links": [
            "6f32fc52a4d53df8"
        ],
        "x": 755,
        "y": 280,
        "wires": []
    },
    {
        "id": "a3534a12592a4f1e",
        "type": "ui_form",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "Set Laser Detector Diff",
        "label": "Set Laser Detector Differential (default 500)",
        "group": "a5991f3b10b51e7c",
        "order": 5,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Diff",
                "value": "diff",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "diff": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "x": 320,
        "y": 500,
        "wires": [
            [
                "c1f7e764f490f914"
            ]
        ]
    },
    {
        "id": "c1f7e764f490f914",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 52",
        "links": [
            "7a6d7007d9d5ec67",
            "bc8a6edecc1a9a5c"
        ],
        "x": 545,
        "y": 500,
        "wires": []
    },
    {
        "id": "4bdef8d87b5da823",
        "type": "link out",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "link out 53",
        "links": [
            "bc8a6edecc1a9a5c"
        ],
        "x": 595,
        "y": 560,
        "wires": []
    },
    {
        "id": "b15078312d3e61f5",
        "type": "ui_button",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "Query Latest Tare Value from all Field",
        "group": "a5991f3b10b51e7c",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Query Field For Latest Tares",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 560,
        "wires": [
            [
                "4bdef8d87b5da823"
            ]
        ]
    },
    {
        "id": "da8da29f2b800fa5",
        "type": "comment",
        "z": "f3ec5d556e86f8d0",
        "g": "96faa29525ade8f0",
        "name": "=== Field Config Dashboard Items",
        "info": "",
        "x": 300,
        "y": 100,
        "wires": []
    },
    {
        "id": "3657f15f91c08259",
        "type": "comment",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Inject for testing - pick a building in \"Set Values\" (more notes in this comment)",
        "info": "//All incoming MQTTs should have these three data\n\nbuilding_name\n//the building name, nodeid, or whatever we are calling it\n\nside_id\n//the side of the hit.\n//MQTT wise, for Ball the message should push as 1 by default. For Laser the message should push the specific value\n\ninc_hits\n//total sum of batched hits (ball or laser)",
        "x": 350,
        "y": 80,
        "wires": []
    },
    {
        "id": "58f91e5a06b49681",
        "type": "inject",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Hit Inject",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "d95bc0be08b649e4"
            ]
        ]
    },
    {
        "id": "d95bc0be08b649e4",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Set Values (edit to test)",
        "func": "//edit this as needed for testing\n//All incoming MQTTs should follow this format\n\nmsg.building_name = 'RBI';\nmsg.side_id = 1;// MQTT wise, for Ball this will be received as 1 by default. For Laser this will received as a specific value\nmsg.inc_hits = 4;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 120,
        "wires": [
            [
                "55d8f8946d586a92"
            ]
        ]
    },
    {
        "id": "a39cc0a1489b6dd0",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "SQL - Building Sensor Type",
        "func": "//SQL to select building sensor type (ball or laser)\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT BUILDINGS.SENSOR_TYPE FROM BUILDINGS WHERE ((BUILDINGS.BUILDING_NAME)='\" + nodeid + \"') AND ((Buildings.MATCH_NUM)=\" + matchid + \")\";\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 160,
        "wires": [
            [
                "cc88980df5b50e81"
            ]
        ]
    },
    {
        "id": "cc88980df5b50e81",
        "type": "sqlite",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 450,
        "y": 160,
        "wires": [
            [
                "98c60bf4f503a36e"
            ]
        ]
    },
    {
        "id": "98c60bf4f503a36e",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Retreive Sensor Type",
        "func": "//SQLite results; building sensor type\n\nvar sensortype = msg.payload[0].SENSOR_TYPE; //this is the data needed via the SQL\nmsg.sensor_type = sensortype\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 200,
        "wires": [
            [
                "870e04fa144c4f6c"
            ]
        ]
    },
    {
        "id": "870e04fa144c4f6c",
        "type": "switch",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Sensor Type",
        "property": "sensor_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Laser",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Ball",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Switch",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 450,
        "y": 220,
        "wires": [
            [
                "5598e9bedb216108"
            ],
            [
                "ca207569b8ffecb7"
            ],
            []
        ]
    },
    {
        "id": "5598e9bedb216108",
        "type": "link out",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Lazer Flow Out",
        "links": [
            "ba76e8252f59be76"
        ],
        "x": 595,
        "y": 180,
        "wires": []
    },
    {
        "id": "ca207569b8ffecb7",
        "type": "link out",
        "z": "c46bd56bf00dd36c",
        "g": "c9a02ca8caf3cfb8",
        "name": "Ball Flow Out",
        "links": [
            "01954de24ad5a0da"
        ],
        "x": 595,
        "y": 220,
        "wires": []
    },
    {
        "id": "d83a5043f1f82c75",
        "type": "inject",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "name": "Increase Windows",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 230,
        "y": 360,
        "wires": [
            [
                "56b66c00e99f38c3"
            ]
        ]
    },
    {
        "id": "56b66c00e99f38c3",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "name": "Increase ActiveWindows (edit me)",
        "func": "//edit this as needed for testing\n\nvar matchid = 1\nvar nodeid = \"RBI\"\nvar sideid = 1\nvar ActiveWindowsThisSide = 2\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + ActiveWindowsThisSide + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)= '\" + nodeid + \"') AND ((BUILDING_SIDE)=\" + sideid + \"))\";\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 360,
        "wires": [
            [
                "54d5da1e44335e4d",
                "5d2ad7baf266e2f2"
            ]
        ]
    },
    {
        "id": "54d5da1e44335e4d",
        "type": "sqlite",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 690,
        "y": 360,
        "wires": [
            [
                "0e64c0905e30abf0"
            ]
        ]
    },
    {
        "id": "3d58044e6edc0422",
        "type": "comment",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "name": "Active Window Increase for testing",
        "info": "",
        "x": 220,
        "y": 320,
        "wires": []
    },
    {
        "id": "f8ebb08cbac54939",
        "type": "inject",
        "z": "c46bd56bf00dd36c",
        "g": "8e3af1c96b869979",
        "name": "Building Blocked",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 220,
        "y": 580,
        "wires": [
            [
                "c7839544c6f7c108"
            ]
        ]
    },
    {
        "id": "c7839544c6f7c108",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "8e3af1c96b869979",
        "name": "Set Building to Blocked (edit me)",
        "func": "//edit this as needed for testing\n\nvar matchid = 1\nvar nodeid = \"RBI\"\n\nmsg.topic = \"UPDATE Buildings SET BLOCKED = True WHERE (((Buildings.MATCH_NUM)=\" + matchid + \") AND ((Buildings.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 580,
        "wires": [
            [
                "a4ee5ad8874c8a5c"
            ]
        ]
    },
    {
        "id": "a4ee5ad8874c8a5c",
        "type": "sqlite",
        "z": "c46bd56bf00dd36c",
        "g": "8e3af1c96b869979",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 690,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "e5e15c6fe3666794",
        "type": "comment",
        "z": "c46bd56bf00dd36c",
        "g": "8e3af1c96b869979",
        "name": "Active building BLOCKED for testing",
        "info": "",
        "x": 220,
        "y": 540,
        "wires": []
    },
    {
        "id": "5d2ad7baf266e2f2",
        "type": "debug",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "name": "debug 26",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 440,
        "wires": []
    },
    {
        "id": "0e64c0905e30abf0",
        "type": "debug",
        "z": "c46bd56bf00dd36c",
        "g": "fd36eb12b8432134",
        "name": "debug 27",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 400,
        "wires": []
    },
    {
        "id": "2253e94c12db5bea",
        "type": "mqtt in",
        "z": "c46bd56bf00dd36c",
        "g": "1bd0079dd85b8647",
        "name": "",
        "topic": "edgenode/balldrop/RBI",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "5999f1d09afe1039",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 220,
        "y": 900,
        "wires": [
            [
                "34ef0188a339e4b1"
            ]
        ]
    },
    {
        "id": "4ead786be8e28f0e",
        "type": "comment",
        "z": "c46bd56bf00dd36c",
        "g": "1bd0079dd85b8647",
        "name": "Ball input MQTT TESTING",
        "info": "",
        "x": 190,
        "y": 840,
        "wires": []
    },
    {
        "id": "34ef0188a339e4b1",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "g": "1bd0079dd85b8647",
        "name": "Convert to BallFlow formats",
        "func": "//--- Set up basic variables\nvar input = msg.payload;\nvar theNode = input[\"node_id\"];\nvar numDrops = input[\"num_drops\"];\n\n//--- Convert input to output\nmsg.building_name = theNode;\nmsg.side_id = 1;// MQTT wise, for Ball this will be received as 1 by default\nmsg.inc_hits = numDrops;\n\n//--- Fin\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 900,
        "wires": [
            [
                "928b2b1d022b2425",
                "310a66838602d619"
            ]
        ]
    },
    {
        "id": "928b2b1d022b2425",
        "type": "link out",
        "z": "c46bd56bf00dd36c",
        "g": "1bd0079dd85b8647",
        "name": "Ball Flow Out",
        "links": [
            "01954de24ad5a0da"
        ],
        "x": 705,
        "y": 900,
        "wires": []
    },
    {
        "id": "310a66838602d619",
        "type": "debug",
        "z": "c46bd56bf00dd36c",
        "g": "1bd0079dd85b8647",
        "name": "debug 28",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 940,
        "wires": []
    },
    {
        "id": "ea7d0061413f925f",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - Active Windows Total",
        "func": "//Building is of type Ball\n//SQL statement to determine number of currently active windows\n//in this building\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT Sum(BuildingWindowStatus.WINDOWS_ACTIVE) AS SumOfWindowsActive FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 80,
        "wires": [
            [
                "a4553dd306cedcd0",
                "3a84fbfb28f88958"
            ]
        ]
    },
    {
        "id": "a4553dd306cedcd0",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 250,
        "y": 120,
        "wires": [
            [
                "18d0398ffa53edda"
            ]
        ]
    },
    {
        "id": "18d0398ffa53edda",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "Ball - Retrieve Active Windows Total",
        "func": "//SQLite results; number of active windows in this building\n\nvar totalActiveWindows = msg.payload[0].SumOfWindowsActive;\n\nmsg.payload = totalActiveWindows\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 160,
        "wires": [
            [
                "44a0094fdc96d8c2"
            ]
        ]
    },
    {
        "id": "44a0094fdc96d8c2",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Active Windows",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 280,
        "y": 200,
        "wires": [
            [
                "e485da60de8ffdd0"
            ],
            [
                "dbd3c6e1c947ba36"
            ]
        ]
    },
    {
        "id": "e485da60de8ffdd0",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - activeWindows = 0",
        "func": "//Number of active windows was already zero. Thus, for completeness,\n//we updated the number of hits to zero.\n//Since this is a ball building, we use side 1 as the default for hits\n//SQL statement to do the above\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET NUM_HITS = 0 WHERE (((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=1) AND ((MATCH_NUM)=\" + matchid + \"))\";\nmsg.debug = \"No active windows this building\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 200,
        "wires": [
            [
                "5907f4cea55aae19",
                "e7ff83dbb5786658"
            ]
        ]
    },
    {
        "id": "5907f4cea55aae19",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 710,
        "y": 200,
        "wires": [
            [
                "35d3b0609f3c1c10"
            ]
        ]
    },
    {
        "id": "dbd3c6e1c947ba36",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - activeWindows > 0",
        "func": "//building has at least one active window.\n//Time to keep track of the hits\n//This SQL will retrieve the current number of hits from the database\n//This value will be used with the additional incoming hit value\n//to determine a totaly number of hits for later evaluation\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nmsg.activewindows = msg.payload\n\nmsg.topic = \"SELECT Sum(BuildingWindowStatus.NUM_HITS) AS SumOfNUM_HITS FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 240,
        "wires": [
            [
                "1f8bdb18d82341c7"
            ]
        ]
    },
    {
        "id": "1f8bdb18d82341c7",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 710,
        "y": 240,
        "wires": [
            [
                "9fef1bf51bd82d93"
            ]
        ]
    },
    {
        "id": "9fef1bf51bd82d93",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "Ball - Retrieve updatedActiveWindows",
        "func": "//Ball code\n//SQLite results; We now have the current number of hits from the database\n//We take that value and add the additional incoming hits\n//This new total of hits is now used to determine how many windows\n//can be deactivated.\n//Since this is a Ball building, then four (4) hits will deactivate one\n//window. Any leftover hits will be stored back into the database\n//for later use if needed\n\nvar building_name = msg.building_name;\nvar SumOfWindowsActive = msg.activewindows; //from database. Current active windows this building\nvar carryover_hits = msg.payload[0].SumOfNUM_HITS; //from database. Hits that were extra beyond four\nvar inc_hits = msg.inc_hits; //from mqtt. Hit total that just came in\n\n\nvar SumTheTwo = carryover_hits + inc_hits; // incoming hits added to carryover hits\nvar DivideByFour = SumTheTwo/4; // window require four balls to register\nvar WindowsToExtinguish = Math.floor(DivideByFour) // rounding down to nearest whole integer. this is the window total to extinguish\nvar ActiveWindowsNow = SumOfWindowsActive - WindowsToExtinguish // subtract the windows to extinguish from the current active window count\nif (ActiveWindowsNow <= 0) {\n    ActiveWindowsNow = 0;\n}\n\nvar MultByFour = WindowsToExtinguish * 4 // totaling the sum of whole \"every four\" hits\nvar UpdCarryoverHits = SumTheTwo - MultByFour // this is carryover to be saved in database\n\nmsg.debug = \"BALL PreviousActiveWindows:\" + SumOfWindowsActive + \"  WindowsActiveNow:\" + ActiveWindowsNow + \" with leftover hits:\" + UpdCarryoverHits;\nmsg.active_windows_now = ActiveWindowsNow;\nmsg.updated_num_hits = UpdCarryoverHits;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 280,
        "wires": [
            [
                "2e2ff89264a068bf",
                "fa4c981d240556ce"
            ]
        ]
    },
    {
        "id": "2e2ff89264a068bf",
        "type": "debug",
        "z": "5b48d63e525889af",
        "name": "msg.debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 280,
        "wires": []
    },
    {
        "id": "362cdf8487a4ec20",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "ActiveWindowsNow",
        "property": "active_windows_now",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "8",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "7",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "6",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 530,
        "y": 640,
        "wires": [
            [
                "9507789b22d5f388"
            ],
            [
                "786b14782f58c90a"
            ],
            [
                "786b14782f58c90a"
            ],
            [
                "9af18f782d123d35"
            ],
            [
                "9af18f782d123d35"
            ],
            [
                "aa1720d10ff6a6ff"
            ],
            [
                "aa1720d10ff6a6ff"
            ],
            [
                "f5d0aa28e6f0422e"
            ],
            [
                "f5d0aa28e6f0422e"
            ]
        ]
    },
    {
        "id": "786b14782f58c90a",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - update side 4",
        "func": "// update side 4\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar UpdatedActiveWindows = msg.active_windows_now\nvar ActiveWindowsThisSide = UpdatedActiveWindows - 6\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + ActiveWindowsThisSide + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=4))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 600,
        "wires": [
            [
                "96915771e6e35ba5",
                "28fa28d003db402b"
            ]
        ]
    },
    {
        "id": "96915771e6e35ba5",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1030,
        "y": 580,
        "wires": [
            [
                "9507789b22d5f388"
            ]
        ]
    },
    {
        "id": "d659c7c1a1ee4638",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1170,
        "y": 620,
        "wires": []
    },
    {
        "id": "9507789b22d5f388",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - update num hits",
        "func": "//SQL to write updated carryover hits to database\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar updnumhits = msg.updated_num_hits\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET NUM_HITS = \" + updnumhits + \" WHERE (((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=1) AND ((MATCH_NUM)=\" + matchid + \"));\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 220,
        "wires": [
            [
                "a1208ec4660409f3"
            ]
        ]
    },
    {
        "id": "a1208ec4660409f3",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 2210,
        "y": 220,
        "wires": [
            [
                "f762d2377419ea56"
            ]
        ]
    },
    {
        "id": "9af18f782d123d35",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - update sequence 3 side",
        "func": "// updated side corresponding to sequence 3\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar UpdatedActiveWindows = msg.active_windows_now\nvar ActiveWindowsThisSide = UpdatedActiveWindows - 4\nvar SeqThreeSide = msg.seqthreeside; //this is the data needed via the SQL\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + ActiveWindowsThisSide + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)= '\" + nodeid + \"') AND ((BUILDING_SIDE)=\" + SeqThreeSide + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 700,
        "wires": [
            [
                "4a532ab323f31897",
                "4cad3e5e4fd26039"
            ]
        ]
    },
    {
        "id": "e9fb10454fdcd876",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - side 4 to zero",
        "func": "// set side 4 activewindows = 0\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 0 WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=4));\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1950,
        "y": 680,
        "wires": [
            [
                "b23693337d0bf525",
                "bb65f8fab55826f6"
            ]
        ]
    },
    {
        "id": "926978629096483a",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 2290,
        "y": 720,
        "wires": []
    },
    {
        "id": "4a532ab323f31897",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1090,
        "y": 680,
        "wires": [
            [
                "e9fb10454fdcd876"
            ]
        ]
    },
    {
        "id": "b23693337d0bf525",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 2150,
        "y": 680,
        "wires": [
            [
                "9507789b22d5f388"
            ]
        ]
    },
    {
        "id": "eefd448726fdf3ee",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1230,
        "y": 720,
        "wires": []
    },
    {
        "id": "fa4c981d240556ce",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - find sequence side 3",
        "func": "var matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT BuildingWindowStatus.BUILDING_SIDE AS SeqThreeSide FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.WINDOW_SEQUENCE)=3));\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 320,
        "wires": [
            [
                "367d82828fd6ff70"
            ]
        ]
    },
    {
        "id": "367d82828fd6ff70",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 530,
        "y": 320,
        "wires": [
            [
                "5b7196606532f662"
            ]
        ]
    },
    {
        "id": "f5c4d853da6c42c4",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - find sequence side 1",
        "func": "var matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT BuildingWindowStatus.BUILDING_SIDE AS SeqOneSide FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.WINDOW_SEQUENCE)=1))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 360,
        "wires": [
            [
                "6e6a4b5ac69db804"
            ]
        ]
    },
    {
        "id": "6e6a4b5ac69db804",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 530,
        "y": 360,
        "wires": [
            [
                "feed706833b18dcb"
            ]
        ]
    },
    {
        "id": "5b7196606532f662",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "Sequence Side 3",
        "func": "msg.seqthreeside = msg.payload[0].SeqThreeSide;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 320,
        "wires": [
            [
                "f5c4d853da6c42c4"
            ]
        ]
    },
    {
        "id": "feed706833b18dcb",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "Sequence Side 1",
        "func": "msg.seqoneside = msg.payload[0].SeqOneSide;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 360,
        "wires": [
            [
                "362cdf8487a4ec20"
            ]
        ]
    },
    {
        "id": "aa1720d10ff6a6ff",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - update side 1",
        "func": "// update side 1\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar UpdatedActiveWindows = msg.active_windows_now\nvar ActiveWindowsThisSide = UpdatedActiveWindows - 2\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + ActiveWindowsThisSide + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=1));\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 780,
        "wires": [
            [
                "5e1bedb2aeceb7e9",
                "de84522b3b85352e"
            ]
        ]
    },
    {
        "id": "5e1bedb2aeceb7e9",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1010,
        "y": 780,
        "wires": [
            [
                "0f411cc6b38c0078"
            ]
        ]
    },
    {
        "id": "d0c72785beeaf77f",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1150,
        "y": 820,
        "wires": []
    },
    {
        "id": "0f411cc6b38c0078",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - sequence side 3 to zero",
        "func": "// updated side corresponding to sequence 3\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar SeqThreeSide = msg.seqthreeside; //this is the data needed via the SQL\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 0 WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)= '\" + nodeid + \"') AND ((BUILDING_SIDE)=\" + SeqThreeSide + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 780,
        "wires": [
            [
                "9f435b2414157ed3",
                "58df087ce7a70c25"
            ]
        ]
    },
    {
        "id": "9f435b2414157ed3",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1770,
        "y": 780,
        "wires": [
            [
                "e9fb10454fdcd876"
            ]
        ]
    },
    {
        "id": "aff8404fddd1fe2e",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1910,
        "y": 820,
        "wires": []
    },
    {
        "id": "f5d0aa28e6f0422e",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - update sequence 1 side",
        "func": "// updated side corresponding to sequence 2\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar UpdatedActiveWindows = msg.active_windows_now\nvar ActiveWindowsThisSide = UpdatedActiveWindows\nvar SeqOneSide = msg.seqoneside; //this is the data needed via the SQL\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + ActiveWindowsThisSide + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)= '\" + nodeid + \"') AND ((BUILDING_SIDE)=\" + SeqOneSide + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 880,
        "wires": [
            [
                "efb06d29e5adbe9f",
                "d8a1bac52593bbb4"
            ]
        ]
    },
    {
        "id": "efb06d29e5adbe9f",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1090,
        "y": 880,
        "wires": [
            [
                "db22302541b3901f"
            ]
        ]
    },
    {
        "id": "3ba3088e67cb12eb",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1230,
        "y": 920,
        "wires": []
    },
    {
        "id": "db22302541b3901f",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "SQL - Ball - side 1 to zero",
        "func": "// update side 1\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 0 WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=1));\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 880,
        "wires": [
            [
                "d506f148496ad4c0",
                "a9fbd03404b6b1ae"
            ]
        ]
    },
    {
        "id": "d506f148496ad4c0",
        "type": "sqlite",
        "z": "5b48d63e525889af",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1450,
        "y": 880,
        "wires": [
            [
                "0f411cc6b38c0078"
            ]
        ]
    },
    {
        "id": "27578e827405ddbe",
        "type": "mqtt out",
        "z": "5b48d63e525889af",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 1590,
        "y": 920,
        "wires": []
    },
    {
        "id": "e7ff83dbb5786658",
        "type": "debug",
        "z": "5b48d63e525889af",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 160,
        "wires": []
    },
    {
        "id": "01954de24ad5a0da",
        "type": "link in",
        "z": "5b48d63e525889af",
        "name": "Ball Flow In",
        "links": [
            "c3ed8bf2158185be",
            "ca207569b8ffecb7",
            "928b2b1d022b2425",
            "0151b281f9b86223"
        ],
        "x": 215,
        "y": 80,
        "wires": [
            [
                "ea7d0061413f925f",
                "fa8b01c9b08b3910"
            ]
        ]
    },
    {
        "id": "cba9608e72f13a68",
        "type": "comment",
        "z": "5b48d63e525889af",
        "name": "remaining common flow starts here",
        "info": "",
        "x": 2420,
        "y": 260,
        "wires": []
    },
    {
        "id": "f762d2377419ea56",
        "type": "link out",
        "z": "5b48d63e525889af",
        "name": "Common Flow Out",
        "links": [
            "890ab98d5562fb14"
        ],
        "x": 2295,
        "y": 220,
        "wires": []
    },
    {
        "id": "35d3b0609f3c1c10",
        "type": "link out",
        "z": "5b48d63e525889af",
        "name": "Common Flow Out",
        "links": [
            "890ab98d5562fb14"
        ],
        "x": 795,
        "y": 200,
        "wires": []
    },
    {
        "id": "3a84fbfb28f88958",
        "type": "debug",
        "z": "5b48d63e525889af",
        "name": "debug 29",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 80,
        "wires": []
    },
    {
        "id": "fa8b01c9b08b3910",
        "type": "debug",
        "z": "5b48d63e525889af",
        "name": "debug 31",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 40,
        "wires": []
    },
    {
        "id": "91f99770496518e8",
        "type": "ui_form",
        "z": "5b48d63e525889af",
        "name": "",
        "label": "Manual Send 4 Hits to Bldg",
        "group": "5ff2841845e80e0c",
        "order": 1,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "(e.g. \"LTO\")",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "795cabc05eeb25ca"
            ]
        ]
    },
    {
        "id": "795cabc05eeb25ca",
        "type": "function",
        "z": "5b48d63e525889af",
        "name": "function 1",
        "func": "var input = msg.payload;\nvar theBldg = input.BUILDING_NAME;\n\nmsg[\"building_name\"] = theBldg;\nnode.warn(theBldg);\nnode.warn(msg);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 480,
        "wires": [
            [
                "ea7d0061413f925f"
            ]
        ]
    },
    {
        "id": "4dc2ac32bf292919",
        "type": "comment",
        "z": "5b48d63e525889af",
        "name": "PAUSING HERE \\n MY FORM INPUT ISNT WORKING \\n BUT THE MANUAL INJECT STILL WORKS",
        "info": "",
        "x": 230,
        "y": 540,
        "wires": []
    },
    {
        "id": "b4883cec7d727b82",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "SQL - Laser - Active Windows Total",
        "func": "//Building is of type Laser\n//SQL statement to determine number of currently active windows\n//in this building, on this side\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar sideid = msg.side_id;\n\nmsg.topic = \"SELECT BuildingWindowStatus.WINDOWS_ACTIVE AS WindowsActiveThisSide FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.BUILDING_SIDE)=\" + sideid + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 40,
        "wires": [
            [
                "4f5b0d4b352ef051"
            ]
        ]
    },
    {
        "id": "4f5b0d4b352ef051",
        "type": "sqlite",
        "z": "e1a756fd8363adc2",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 310,
        "y": 80,
        "wires": [
            [
                "15a2c8dd212691c2"
            ]
        ]
    },
    {
        "id": "15a2c8dd212691c2",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "Laser - Retrieve Active Windows This Side",
        "func": "//SQLite results; number of active windows in this building, on this side\n\nvar totalActiveWindowsThisSide = msg.payload[0].WindowsActiveThisSide;\n\nmsg.payload = totalActiveWindowsThisSide\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 120,
        "wires": [
            [
                "9da197977bc771a0"
            ]
        ]
    },
    {
        "id": "9da197977bc771a0",
        "type": "switch",
        "z": "e1a756fd8363adc2",
        "name": "Active Windows",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 160,
        "wires": [
            [
                "b180819e3b9213c6"
            ],
            [
                "907711875876e4f6"
            ]
        ]
    },
    {
        "id": "b180819e3b9213c6",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "SQL - Laser - update hits to zero",
        "func": "//Number of active windows was already zero FOR THIS SIDE. Thus, for completeness,\n//we updated the number of hits to zero FOR THIS SIDE.\n//Since this is a laser building, we use the side that was hit as provided via MQTT\n//SQL statement to do the above\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar sideid = msg.side_id;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET NUM_HITS = 0 WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.BUILDING_SIDE)=\" + sideid + \"))\";\nmsg.debug = \"No active windows on side \" + sideid;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 160,
        "wires": [
            [
                "32c2b5c059f36a0a",
                "050fa4f644c7a9b9"
            ]
        ]
    },
    {
        "id": "32c2b5c059f36a0a",
        "type": "sqlite",
        "z": "e1a756fd8363adc2",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1350,
        "y": 160,
        "wires": [
            [
                "e78b05fbdb887da1"
            ]
        ]
    },
    {
        "id": "907711875876e4f6",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "SQL - Laser - activeWindows > 0",
        "func": "//building has at least one active window, ON THIS SIDE\n//Time to keep track of the hits\n//This SQL will retrieve the current number of carryover hits ON THIS SIDE from the database\n//This value will be used with the additional incoming hit value\n//to determine a totaly number of hits for later evaluation\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar sideid = msg.side_id;\nmsg.activewindowsthisside = msg.payload\n\nmsg.topic = \"SELECT Sum(BuildingWindowStatus.NUM_HITS) AS SumOfNUM_HITS FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.BUILDING_SIDE)=\" + sideid + \"))\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 200,
        "wires": [
            [
                "5f2509c20a465828"
            ]
        ]
    },
    {
        "id": "5f2509c20a465828",
        "type": "sqlite",
        "z": "e1a756fd8363adc2",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 790,
        "y": 200,
        "wires": [
            [
                "7ae2217a9f645817"
            ]
        ]
    },
    {
        "id": "7ae2217a9f645817",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "Laser - Retrieve updatedActiveWindows",
        "func": "//Laser code\n//SQLite results; We now have the current number of hits on this side from the database\n//We take that value and add the additional incoming hits\n//This new total of hits is now used to determine how many windows\n//can be deactivated ON THIS SIDE\n//Since this is a Laser building, then two (2) hits will deactivate one\n//window ON THIS SIDE. Any leftover hits will be stored back into the database\n//for FOR THIS SIDE for later use if needed\n\nvar building_name = msg.building_name;\nvar SumOfWindowsActive = msg.activewindowsthisside; //from database. Current active windows this building FOR THIS SIDE\nvar carryover_hits = msg.payload[0].SumOfNUM_HITS; //from database. Hits ON THIS SIDE that were extra beyond two\nvar inc_hits = msg.inc_hits; //from mqtt. Hit total that just came in FOR THIS SIDE\n\n\nvar SumTheTwo = carryover_hits + inc_hits; // incoming hits added to carryover hits\nvar DivideByTwo = SumTheTwo/2; // window require four balls to register\nvar WindowsToExtinguish = Math.floor(DivideByTwo) // rounding down to nearest whole integer. this is the window total to extinguish\nvar ActiveWindowsNow = SumOfWindowsActive - WindowsToExtinguish // subtract the windows to extinguish from the current active window count\nif (ActiveWindowsNow <= 0) {\n    ActiveWindowsNow = 0;\n}\n\nvar MultByTwo = WindowsToExtinguish * 2 // totaling the sum of whole \"every two\" hits\nvar UpdCarryoverHits = SumTheTwo - MultByTwo // this is carryover FOR THIS SIDE to be saved in database\n\nmsg.debug = \"LASER PreviousActiveWindowsTHISSIDE:\" + SumOfWindowsActive + \"  WindowsActiveNowTHISSIDE:\" + ActiveWindowsNow + \" with leftover hits this side:\" + UpdCarryoverHits;\nmsg.active_windows_now = ActiveWindowsNow;\nmsg.updated_num_hits = UpdCarryoverHits;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 240,
        "wires": [
            [
                "3186aed41caae2d3",
                "2b842ffbe6a7f57d"
            ]
        ]
    },
    {
        "id": "3186aed41caae2d3",
        "type": "debug",
        "z": "e1a756fd8363adc2",
        "name": "msg.debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 240,
        "wires": []
    },
    {
        "id": "050fa4f644c7a9b9",
        "type": "debug",
        "z": "e1a756fd8363adc2",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 120,
        "wires": []
    },
    {
        "id": "2b842ffbe6a7f57d",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "SQL - Laser - update windows this side",
        "func": "// update side 4\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar sideid = msg.side_id;\nvar activewindowsnow = msg.active_windows_now;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + activewindowsnow + \" WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=\" + sideid +\"))\";\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 340,
        "wires": [
            [
                "93ab7685c29c0ea9",
                "7d6da5e70ab066c4"
            ]
        ]
    },
    {
        "id": "93ab7685c29c0ea9",
        "type": "sqlite",
        "z": "e1a756fd8363adc2",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 670,
        "y": 340,
        "wires": [
            [
                "14467402e3f1abbc"
            ]
        ]
    },
    {
        "id": "926d37cb9295938e",
        "type": "function",
        "z": "e1a756fd8363adc2",
        "name": "SQL - Laser - update num hits",
        "func": "//SQL to write updated carryover hits to database\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar sideid = msg.side_id;\nvar updnumhits = msg.updated_num_hits\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET NUM_HITS = \" + updnumhits + \" WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"') AND ((BuildingWindowStatus.BUILDING_SIDE)=\" + sideid + \"))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 400,
        "wires": [
            [
                "11d669e5a2a8a656"
            ]
        ]
    },
    {
        "id": "11d669e5a2a8a656",
        "type": "sqlite",
        "z": "e1a756fd8363adc2",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 1310,
        "y": 400,
        "wires": [
            [
                "49340053d9bb65e1"
            ]
        ]
    },
    {
        "id": "ba76e8252f59be76",
        "type": "link in",
        "z": "e1a756fd8363adc2",
        "name": "Laser Flow In",
        "links": [
            "2f7511a670bcd2d4",
            "f9a71de89c31f5e6",
            "5598e9bedb216108"
        ],
        "x": 215,
        "y": 40,
        "wires": [
            [
                "b4883cec7d727b82"
            ]
        ]
    },
    {
        "id": "1adc4cdba4330e68",
        "type": "comment",
        "z": "e1a756fd8363adc2",
        "name": "remaining common flow starts here",
        "info": "",
        "x": 1520,
        "y": 440,
        "wires": []
    },
    {
        "id": "49340053d9bb65e1",
        "type": "link out",
        "z": "e1a756fd8363adc2",
        "name": "Common Flow Out",
        "links": [
            "890ab98d5562fb14"
        ],
        "x": 1395,
        "y": 400,
        "wires": []
    },
    {
        "id": "14467402e3f1abbc",
        "type": "switch",
        "z": "e1a756fd8363adc2",
        "name": "Active Windows",
        "property": "active_windows_now",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 820,
        "y": 340,
        "wires": [
            [
                "b180819e3b9213c6"
            ],
            [
                "926d37cb9295938e"
            ]
        ]
    },
    {
        "id": "e78b05fbdb887da1",
        "type": "link out",
        "z": "e1a756fd8363adc2",
        "name": "Common Flow Out",
        "links": [
            "890ab98d5562fb14"
        ],
        "x": 1435,
        "y": 160,
        "wires": []
    },
    {
        "id": "7323b2975a27ec40",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "SQL - Total Active Windows",
        "func": "//SQL to retreive total active windows for entire building (ball or laser)\n//Used to determine if total is zero, then make building dormant (burning status = false)\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT Sum(BuildingWindowStatus.WINDOWS_ACTIVE) AS SumOfWindowsActive FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 40,
        "wires": [
            [
                "5669cfa434e64d88"
            ]
        ]
    },
    {
        "id": "890ab98d5562fb14",
        "type": "link in",
        "z": "66af4b80919b8266",
        "name": "Common Flow In",
        "links": [
            "49340053d9bb65e1",
            "f762d2377419ea56",
            "e78b05fbdb887da1",
            "35d3b0609f3c1c10"
        ],
        "x": 165,
        "y": 40,
        "wires": [
            [
                "7323b2975a27ec40"
            ]
        ]
    },
    {
        "id": "5669cfa434e64d88",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 510,
        "y": 40,
        "wires": [
            [
                "168fb3018e5de3d0"
            ]
        ]
    },
    {
        "id": "bf4049db740a3afd",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Active Windows = 0",
        "func": "//Number of active windows was already zero.\n\n// First, for completeness,\n//we updated the number of hits to zero for side 1 (for both laser and ball. Laser already zero from Laser flow)\n//SQL statement to do the above\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE BuildingWindowStatus SET NUM_HITS = 0 WHERE (((BUILDING_NAME)='\" + nodeid + \"') AND ((BUILDING_SIDE)=1) AND ((MATCH_NUM)=\" + matchid + \"))\";\nmsg.debug = \"No active windows this building. Set hits to zero. Time to continue\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 100,
        "wires": [
            [
                "55ed0281f92ebbf9",
                "d0a445bd08bec86f"
            ]
        ]
    },
    {
        "id": "1cbe30fd3e837398",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Active Windows > 0",
        "func": "//total active windows is greater than zero for this building. Do nothing more.\n\nvar nodeid = msg.building_name;\nvar totalactivewindows = msg.total_active_windows\n\nmsg.debug = \"Building: \" + nodeid + \" still has total active windows = \" + totalactivewindows + \". Not zero. Nothing more to do.\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 160,
        "wires": [
            [
                "a27df8763ef12799"
            ]
        ]
    },
    {
        "id": "9fe1f2eb5294962a",
        "type": "switch",
        "z": "66af4b80919b8266",
        "name": "Active Windows",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 660,
        "y": 100,
        "wires": [
            [
                "bf4049db740a3afd"
            ],
            [
                "1cbe30fd3e837398"
            ]
        ]
    },
    {
        "id": "a27df8763ef12799",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 160,
        "wires": []
    },
    {
        "id": "55ed0281f92ebbf9",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 60,
        "wires": []
    },
    {
        "id": "168fb3018e5de3d0",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Retrieve Total Active Windows",
        "func": "//SQLite results; total active windows in this building\n\nvar totalActiveWindows = msg.payload[0].SumOfWindowsActive;\n\nmsg.payload = totalActiveWindows\nmsg.total_active_windows = totalActiveWindows\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 40,
        "wires": [
            [
                "9fe1f2eb5294962a"
            ]
        ]
    },
    {
        "id": "d0a445bd08bec86f",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL2",
        "x": 1030,
        "y": 100,
        "wires": [
            [
                "1369da3b1e2cb608"
            ]
        ]
    },
    {
        "id": "1369da3b1e2cb608",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Update Burning Status to False",
        "func": "//\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE Buildings SET BURNING_STATUS = False WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\"+ nodeid +\"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 200,
        "wires": [
            [
                "5fd26b066d326743"
            ]
        ]
    },
    {
        "id": "5fd26b066d326743",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL3",
        "x": 1150,
        "y": 200,
        "wires": [
            [
                "9eb919606ec5696b"
            ]
        ]
    },
    {
        "id": "9eb919606ec5696b",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Retrieved Blocked Status",
        "func": "//SQL to retrieve blocked status\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT BLOCKED FROM Buildings WHERE (((Buildings.MATCH_NUM)=\" + matchid + \") AND ((Buildings.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 260,
        "wires": [
            [
                "4ba1c7dc76d6ac42"
            ]
        ]
    },
    {
        "id": "4ba1c7dc76d6ac42",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL4",
        "x": 1150,
        "y": 260,
        "wires": [
            [
                "fc17484b596d2373"
            ]
        ]
    },
    {
        "id": "fc17484b596d2373",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Update Burning Status to False",
        "func": "//retrieved blocked status\n\nvar isblocked = msg.payload[0].BLOCKED;\nvar nodeid = msg.building_name;\n\nmsg.debug = \"Building '\" + nodeid + \"' blocked status is \" + isblocked;\nmsg.payload = isblocked\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 320,
        "wires": [
            [
                "3cc489c9d1b8ca83",
                "8fc41e58855b1918"
            ]
        ]
    },
    {
        "id": "3cc489c9d1b8ca83",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 320,
        "wires": []
    },
    {
        "id": "8fc41e58855b1918",
        "type": "switch",
        "z": "66af4b80919b8266",
        "name": "Blocked Status",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1240,
        "y": 380,
        "wires": [
            [
                "385b11ca2d3efba5"
            ],
            [
                "8d0c0060934c564e"
            ]
        ]
    },
    {
        "id": "8d0c0060934c564e",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Set Fire Elegility to False",
        "func": "//SQL to set Fire Elgibility to false\n\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"UPDATE Buildings SET FIRE_ELIGIBLE = False WHERE (((MATCH_NUM)=\" + matchid + \") AND ((BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 440,
        "wires": [
            [
                "0ed26f2f37e490dd"
            ]
        ]
    },
    {
        "id": "0ed26f2f37e490dd",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL5",
        "x": 1630,
        "y": 440,
        "wires": [
            [
                "70acde872b2f9f3c"
            ]
        ]
    },
    {
        "id": "385b11ca2d3efba5",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Fire Elegibility still TRUE",
        "func": "\n\nvar nodeid = msg.building_name;\n\nmsg.debug = \"Building '\" + nodeid + \"' blocked status = FALSE\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 360,
        "wires": [
            [
                "7d8bdda0ae8b57b8",
                "70acde872b2f9f3c"
            ]
        ]
    },
    {
        "id": "7d8bdda0ae8b57b8",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 320,
        "wires": []
    },
    {
        "id": "70acde872b2f9f3c",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Retrieved Community Status",
        "func": "//SQL to retrieve community status\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\nvar buildingfirstletter = Array.from(nodeid)[0];\nvar community = \"unknown\"\n\nif (buildingfirstletter == 'R'){\n    msg.debug = \"Community = RIGHT\"\n    community = \"RIGHT\"\n}\n\nif (buildingfirstletter == 'L'){\n    msg.debug = \"Community = LEFT\"\n    community = \"LEFT\"\n}\n\nmsg.topic = \"SELECT Sum(BuildingWindowStatus.WINDOWS_ACTIVE) AS SumOfWINDOWS_ACTIVE FROM BuildingWindowStatus WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND ((BuildingWindowStatus.Community)='\" + community + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1840,
        "y": 400,
        "wires": [
            [
                "f6f894f634253a09",
                "a3ec53662f59092f"
            ]
        ]
    },
    {
        "id": "f6f894f634253a09",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2070,
        "y": 380,
        "wires": []
    },
    {
        "id": "a3ec53662f59092f",
        "type": "sqlite",
        "z": "66af4b80919b8266",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL6",
        "x": 2050,
        "y": 420,
        "wires": [
            [
                "7b8f6b8a58ca1708"
            ]
        ]
    },
    {
        "id": "7b8f6b8a58ca1708",
        "type": "function",
        "z": "66af4b80919b8266",
        "name": "Community active windows",
        "func": "//retrieved blocked status\n\nvar activewindowsincommunity = msg.payload[0].SumOfWINDOWS_ACTIVE;\n\nmsg.debug = \"Active windows in community = \" + activewindowsincommunity + \" END PHASE\";\nmsg.payload = activewindowsincommunity;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 480,
        "wires": [
            [
                "04430db2fc24a20a"
            ]
        ]
    },
    {
        "id": "04430db2fc24a20a",
        "type": "debug",
        "z": "66af4b80919b8266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "debug",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2190,
        "y": 480,
        "wires": []
    },
    {
        "id": "8dd58815c2e5e6ed",
        "type": "countdown",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Timer",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "300",
        "resetWhileRunning": false,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": false,
        "x": 290,
        "y": 1220,
        "wires": [
            [],
            [
                "2d8175ca745dc0c0"
            ]
        ]
    },
    {
        "id": "59f5d060d5848730",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Convert (s) to (m:ss)",
        "func": "// Get seconds from payload\nvar input_secs = msg.payload;\n\n// Convert seconds to minutes and get remaining seconds\nvar minutes = Math.floor(input_secs / 60);\nvar seconds = input_secs - minutes * 60;\n\n// If secs < 10, make 2-digit string, otherwise convert to string \n// Super JS shorthand mode\nseconds = (seconds < 10) ? \"0\" + seconds : seconds.toString();\n\n// Make pretty string\nmsg.finalTime = minutes + ':' + seconds;\n\n// Fin\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1220,
        "wires": [
            [
                "db6a188325dcd4b5"
            ]
        ]
    },
    {
        "id": "db6a188325dcd4b5",
        "type": "ui_text",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "group": "f74888d7aab3b07a",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "Timer Display",
        "label": "Match Time",
        "format": "{{msg.finalTime}}",
        "layout": "col-center",
        "x": 940,
        "y": 1220,
        "wires": []
    },
    {
        "id": "7008fa5d0a1f6f49",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Build \"Match Info\" Dashboard",
        "info": "",
        "x": 200,
        "y": 1120,
        "wires": []
    },
    {
        "id": "46a56e643dbadfdf",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Timer",
        "info": "",
        "x": 170,
        "y": 1180,
        "wires": []
    },
    {
        "id": "b887e05d8e16f98a",
        "type": "ui_text",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "group": "f74888d7aab3b07a",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Match #",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 520,
        "y": 1500,
        "wires": []
    },
    {
        "id": "6d8ab4a0bf2c6144",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "StartNewMatch",
        "group": "f74888d7aab3b07a",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Start New Match",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 240,
        "y": 1420,
        "wires": [
            [
                "acc02b92d4d8c13e",
                "7f5a474942e946d6"
            ]
        ]
    },
    {
        "id": "7f5a474942e946d6",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "link out 58",
        "links": [
            "a5a1bd31c468f86b",
            "d36ef2fad2d08d5f"
        ],
        "x": 475,
        "y": 1440,
        "wires": []
    },
    {
        "id": "c8663193fd1a2a4c",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Start Global 15s Timer",
        "links": [
            "54f48d7af3ce8a94",
            "8f95daa740229529"
        ],
        "x": 915,
        "y": 1380,
        "wires": []
    },
    {
        "id": "acc02b92d4d8c13e",
        "type": "delay",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "2s Delay to prep SQL Tables",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 480,
        "y": 1400,
        "wires": [
            [
                "ab6b0ced1764bbe7"
            ]
        ]
    },
    {
        "id": "ab6b0ced1764bbe7",
        "type": "change",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Set global.activematch to 1",
        "rules": [
            {
                "t": "set",
                "p": "activematch",
                "pt": "global",
                "to": "1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 1420,
        "wires": [
            [
                "c8663193fd1a2a4c",
                "42af8511d5eb7b89",
                "ee09a1869c62b35f"
            ]
        ]
    },
    {
        "id": "3b62b6b510d4e006",
        "type": "change",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Set global.activematch to 0",
        "rules": [
            {
                "t": "set",
                "p": "activematch",
                "pt": "global",
                "to": "0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 1580,
        "wires": [
            []
        ]
    },
    {
        "id": "a1d67bd37d35d4c9",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Match Controls",
        "info": "",
        "x": 200,
        "y": 1360,
        "wires": []
    },
    {
        "id": "42af8511d5eb7b89",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Start Countdown Timer",
        "links": [
            "d92cebfab339228d"
        ],
        "x": 915,
        "y": 1420,
        "wires": []
    },
    {
        "id": "d92cebfab339228d",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Match Countdown Timer",
        "links": [
            "42af8511d5eb7b89",
            "df0c2380cde11191"
        ],
        "x": 175,
        "y": 1220,
        "wires": [
            [
                "8dd58815c2e5e6ed"
            ]
        ]
    },
    {
        "id": "7b3cf80c2f7933f5",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Global 15s Timer",
        "info": "",
        "x": 1020,
        "y": 1380,
        "wires": []
    },
    {
        "id": "783c1457c57e2fdd",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Match Countdown Timer",
        "info": "",
        "x": 1050,
        "y": 1420,
        "wires": []
    },
    {
        "id": "490f0337c9b5fdde",
        "type": "change",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Get Global Matchnum",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "matchnum",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 1500,
        "wires": [
            [
                "b887e05d8e16f98a"
            ]
        ]
    },
    {
        "id": "ee09a1869c62b35f",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Update MatchNum",
        "links": [
            "4a0f846d052b27a1"
        ],
        "x": 915,
        "y": 1460,
        "wires": []
    },
    {
        "id": "4a0f846d052b27a1",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Update MatchNum Display",
        "links": [
            "ee09a1869c62b35f"
        ],
        "x": 185,
        "y": 1500,
        "wires": [
            [
                "490f0337c9b5fdde"
            ]
        ]
    },
    {
        "id": "eda2c692de480fc2",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Match Num Display",
        "info": "",
        "x": 1030,
        "y": 1460,
        "wires": []
    },
    {
        "id": "a7a659cc6f58af7b",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "PauseMatch",
        "group": "f74888d7aab3b07a",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Pause Match",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 230,
        "y": 1580,
        "wires": [
            [
                "3b62b6b510d4e006"
            ]
        ]
    },
    {
        "id": "2d8175ca745dc0c0",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Timer (s) link",
        "links": [
            "0cb81d115358288e",
            "e6f7df6891d456f8"
        ],
        "x": 415,
        "y": 1220,
        "wires": []
    },
    {
        "id": "0cb81d115358288e",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Get Timer (s)",
        "links": [
            "2d8175ca745dc0c0"
        ],
        "x": 535,
        "y": 1220,
        "wires": [
            [
                "59f5d060d5848730"
            ]
        ]
    },
    {
        "id": "8d5a8c631a18adf2",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "== NEED SOMETHING HERE TO PAUSE TIMER ===",
        "info": "",
        "x": 840,
        "y": 1580,
        "wires": []
    },
    {
        "id": "76325cc73d807aff",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "=====",
        "info": "",
        "x": 150,
        "y": 2160,
        "wires": []
    },
    {
        "id": "5cd390e68340fd0d",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Scoring Displays",
        "info": "",
        "x": 200,
        "y": 1680,
        "wires": []
    },
    {
        "id": "33375f464a25e378",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Tie to the existing window update timing - that way any changes happen in sync",
        "info": "",
        "x": 440,
        "y": 1720,
        "wires": []
    },
    {
        "id": "b4f6bbea7b9c1425",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Updating Scores",
        "links": [
            "657f37cb57ddaa95"
        ],
        "x": 175,
        "y": 1760,
        "wires": [
            []
        ]
    },
    {
        "id": "dd3ee7af1c1be3f9",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Build SQL Statement to Get SumOf FCS",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// build SQL statement to select all scoring related values at a given moment\nvar newMsg = {\n    \"topic\": \"SELECT Sum(Buildings.FCS) AS SumOfFCS FROM Buildings WHERE MATCH_NUM=\" + matchid + \";\"\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1760,
        "wires": [
            [
                "a31a48fc659094dc"
            ]
        ]
    },
    {
        "id": "a31a48fc659094dc",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 730,
        "y": 1760,
        "wires": [
            [
                "977940dbb24cd0d3"
            ]
        ]
    },
    {
        "id": "69c13b1cb1ef9106",
        "type": "inject",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Test",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 1820,
        "wires": [
            [
                "dd3ee7af1c1be3f9"
            ]
        ]
    },
    {
        "id": "da33cf2e422fe969",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Calculate scores",
        "func": "/* Input is an array of objects representing each building's scores, e.g.:\n\n0: object\n    BUILDING_NAME: \"LBI\"\n    FS: 0\n    FCS: 8\n    DPS: 0\n1: object\n    BUILDING_NAME: \"LBM\"\n    FS: 0\n    FCS: 8\n    DPS: 0\n\n*/\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1820,
        "wires": [
            []
        ]
    },
    {
        "id": "977940dbb24cd0d3",
        "type": "debug",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "debug 24",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 1820,
        "wires": []
    },
    {
        "id": "5d504534615be681",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Build SQL Statement to Get All Scoring Values",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// build SQL statement to select all scoring related values at a given moment\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, FS, FCS, DPS FROM Buildings\" +\n        \" WHERE MATCH_NUM = \" + matchid\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "7faa48872118547a",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "THIS _WILL_ WORK - INITIALIZER FCS CODE IS WHAT IS WRONG, CHECK THAT NEXT ",
        "info": "",
        "x": 640,
        "y": 1780,
        "wires": []
    },
    {
        "id": "cefe09f15191636e",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update BuildingsWindowStatus SQL",
        "func": "var matchid = global.get(\"matchnum\");\n\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 2 WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME= 'LTO' ;\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1870,
        "y": 1260,
        "wires": [
            [
                "238491dc517ad107"
            ]
        ]
    },
    {
        "id": "ab0b09557b760e39",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Set LTO to Max FS",
        "group": "5ff2841845e80e0c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Set LTO to Max FS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1470,
        "y": 1240,
        "wires": [
            [
                "cefe09f15191636e",
                "df4499ebe0ea3b90"
            ]
        ]
    },
    {
        "id": "df4499ebe0ea3b90",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update Buildings SQL",
        "func": "var matchid = global.get(\"matchnum\");\n\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FS = 8 WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME= 'LTO' ;\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1820,
        "y": 1220,
        "wires": [
            [
                "4b3225e374299121"
            ]
        ]
    },
    {
        "id": "15de13e19c130f74",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Manual Overrides",
        "info": "",
        "x": 1430,
        "y": 1180,
        "wires": []
    },
    {
        "id": "4b3225e374299121",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "238491dc517ad107",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1260,
        "wires": [
            [
                "e3e43826d5609708"
            ]
        ]
    },
    {
        "id": "c208d636c0f91949",
        "type": "ui_form",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "",
        "label": "Set Building to Max FS",
        "group": "5ff2841845e80e0c",
        "order": 1,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "(e.g. \"LTO\")",
                "value": "BUILDING_NAME",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "BUILDING_NAME": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "x": 1480,
        "y": 1400,
        "wires": [
            [
                "5f1b71b4e2a46e94",
                "1371a06f222f852d"
            ]
        ]
    },
    {
        "id": "5f1b71b4e2a46e94",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update Buildings SQL",
        "func": "// set up basic variables\n// Example payload: pyld.BUILDING_NAME = \"LTO\" \nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar theBldg = pyld.BUILDING_NAME;\nnode.warn(pyld);\nnode.warn(theBldg);\n\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FS = 8, BURNING_STATUS = 1 WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME= '\" + theBldg + \"' ;\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1820,
        "y": 1380,
        "wires": [
            [
                "f029d33d5a01430b"
            ]
        ]
    },
    {
        "id": "1371a06f222f852d",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update BuildingsWindowStatus SQL",
        "func": "// set up basic variables\n// Example payload: pyld.BUILDING_NAME = \"LTO\" \nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar theBldg = pyld.BUILDING_NAME;\n\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 2 WHERE MATCH_NUM = \" + matchid + \" AND BUILDING_NAME= '\" + theBldg + \"' ;\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1870,
        "y": 1420,
        "wires": [
            [
                "7e5bdfbfdb4b0b19"
            ]
        ]
    },
    {
        "id": "f029d33d5a01430b",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "7e5bdfbfdb4b0b19",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1420,
        "wires": [
            [
                "59745bda3e910197"
            ]
        ]
    },
    {
        "id": "087ea15ff4df1c45",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update Buildings SQL",
        "func": "// Set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// Build SQL statement\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FS = 0, WAS_JUST_SPREAD = 0, BURNING_STATUS = 0 WHERE MATCH_NUM = \" + matchid + \";\"\n}\n\n// Fin\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1820,
        "y": 1520,
        "wires": [
            [
                "312e300ef0c3ebfc"
            ]
        ]
    },
    {
        "id": "128c7226f7be2da9",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Update BuildingsWindowStatus SQL",
        "func": "// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// --- Build SQL statement\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 0 WHERE MATCH_NUM = \" + matchid + \";\"\n}\n\n// --- Fin\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1870,
        "y": 1560,
        "wires": [
            [
                "232f875101b89298"
            ]
        ]
    },
    {
        "id": "312e300ef0c3ebfc",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "232f875101b89298",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2150,
        "y": 1560,
        "wires": [
            [
                "b505ddef8a8d5b22"
            ]
        ]
    },
    {
        "id": "846b71a8845b48e3",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Clear ALL Active Windows / FS",
        "group": "5ff2841845e80e0c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Clear ALL Win / FS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1510,
        "y": 1540,
        "wires": [
            [
                "087ea15ff4df1c45",
                "128c7226f7be2da9"
            ]
        ]
    },
    {
        "id": "947d970c36309582",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "",
        "group": "f74888d7aab3b07a",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Manual Refresh from SQL",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1490,
        "y": 1680,
        "wires": [
            [
                "5884816cd47f36fa"
            ]
        ]
    },
    {
        "id": "5884816cd47f36fa",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Refresh Building SQL",
        "links": [
            "6be1279db19ab616"
        ],
        "x": 1735,
        "y": 1680,
        "wires": []
    },
    {
        "id": "e3e43826d5609708",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Refresh Building SQL",
        "links": [
            "6be1279db19ab616"
        ],
        "x": 2275,
        "y": 1260,
        "wires": []
    },
    {
        "id": "59745bda3e910197",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Refresh Building SQL",
        "links": [
            "6be1279db19ab616"
        ],
        "x": 2275,
        "y": 1420,
        "wires": []
    },
    {
        "id": "b505ddef8a8d5b22",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Refresh Building SQL",
        "links": [
            "6be1279db19ab616"
        ],
        "x": 2275,
        "y": 1560,
        "wires": []
    },
    {
        "id": "d026e7298107e8b5",
        "type": "ui_button",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "",
        "group": "f74888d7aab3b07a",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Manual Burn Rate",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1470,
        "y": 1740,
        "wires": [
            [
                "9827bb283a8e319e",
                "8c5e3572a53fc2f1"
            ]
        ]
    },
    {
        "id": "9827bb283a8e319e",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Do the Burn Rate",
        "links": [
            "4b3144091dcaa8ef",
            "35f9efa88ad160c8"
        ],
        "x": 1655,
        "y": 1740,
        "wires": []
    },
    {
        "id": "8c5e3572a53fc2f1",
        "type": "delay",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 1750,
        "y": 1760,
        "wires": [
            [
                "04c4f4f285f0deb1"
            ]
        ]
    },
    {
        "id": "04c4f4f285f0deb1",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Refresh Building SQL",
        "links": [
            "6be1279db19ab616"
        ],
        "x": 1865,
        "y": 1760,
        "wires": []
    },
    {
        "id": "02094e58d214ca4e",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Every [however-fast-we-can-without-breaking-things], loop through all bldgs and read current window statuses from SQL",
        "info": "",
        "x": 540,
        "y": 360,
        "wires": []
    },
    {
        "id": "f37a6402dfd150e0",
        "type": "inject",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 210,
        "y": 420,
        "wires": [
            [
                "6e9b0e81c64578d1"
            ]
        ]
    },
    {
        "id": "4a8a1a766a1837c0",
        "type": "loop",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Loop Through Building Names",
        "kind": "enum",
        "count": "",
        "initial": "1",
        "step": "1",
        "condition": "",
        "conditionType": "js",
        "when": "before",
        "enumeration": "[\"LTO\",\"LTM\",\"LTI\",\"LBO\",\"LBM\",\"LBI\",\"RTO\",\"RTM\",\"RTI\",\"RBO\",\"RBM\",\"RBI\"]",
        "enumerationType": "json",
        "limit": "200",
        "loopPayload": "loop-index",
        "finalPayload": "final-orig",
        "x": 590,
        "y": 480,
        "wires": [
            [],
            [
                "a5d13575b4066615"
            ]
        ]
    },
    {
        "id": "a5d13575b4066615",
        "type": "change",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Set Payload to Loop Value",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$type(msg.loop.key) != \"undefined\" ?\tmsg.loop.key & \": \" & msg.loop.value :\tmsg.loop.value",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "BuildingName",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 560,
        "wires": [
            [
                "b529cac067f45af4",
                "1d23ea346df62408"
            ]
        ]
    },
    {
        "id": "b529cac067f45af4",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Build SQL Stmt to Get Active Windows for Bldg",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar bldg = msg.payload; //from loop\n\n// build SQL statement\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, BUILDING_SIDE, WINDOWS_ACTIVE FROM BuildingWindowStatus\" + \n        \" WHERE MATCH_NUM = \" + matchid + \n        \" AND BUILDING_NAME = \\\"\" + bldg + \"\\\"\"\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 540,
        "wires": [
            [
                "51b576984a477740"
            ]
        ]
    },
    {
        "id": "51b576984a477740",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Get SQL Results",
        "x": 1070,
        "y": 540,
        "wires": [
            [
                "5007fdcc502bf71f"
            ]
        ]
    },
    {
        "id": "c693bf2be0bdd6c9",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Convert SQL ActiveWindows to Progress Bar #'s",
        "func": "/*\n -- The payload coming in to this function is an object with the SQL\n    results of active windows for one building.  For example, at index[0]:\n     BUILDING_NAME: \"LBI\"\n     BUILDING_SIDE: 1\n     WINDOWS_ACTIVE: 2\n    \n -- So, we just need to convert those values into the appropriate table\n    row / column / progress bar %'s \n\n -- Output is JSON that contains the new table updates.  E.g.: \n    [\n        {\n            \"BuildingName\": \"LTO\",\n            \"Side1\":0,\n            \"Side2\":50,\n            \"Side3\":100,\n            \"Side4\":0,\n        }\n    ]\n*/\n\n// set up basic variablfes\nvar input = msg.payload;\nvar output = {};\nvar curBldg = input[0].BUILDING_NAME; // it will be the same for all values\n\noutput[\"BUILDING_NAME\"] = curBldg;\n\n// Loop through the object\nfor (let i in input) {\n    var sidestring = \"Side\" + (input[i][\"BUILDING_SIDE\"]);\n    output[sidestring] = 50 * input[i][\"WINDOWS_ACTIVE\"];\n}\n\n// fin\n// Use node-red-ui-table table command\nmsg.payload = {\n    command: \"updateOrAddData\",\n    arguments: [\n        [\n            output\n        ],\n        true\n    ],\n    returnPromise: true\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 680,
        "wires": [
            [
                "8cbd51125ac85550"
            ]
        ]
    },
    {
        "id": "5d6f905de272b1d2",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Send to LS Table",
        "links": [
            "5fd586e91231d64b"
        ],
        "x": 905,
        "y": 680,
        "wires": []
    },
    {
        "id": "8cbd51125ac85550",
        "type": "json",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "json/obj thing",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 750,
        "y": 680,
        "wires": [
            [
                "4a8a1a766a1837c0",
                "5d6f905de272b1d2"
            ]
        ]
    },
    {
        "id": "50359eeb29b81631",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Send to LS Table",
        "links": [
            "5fd586e91231d64b"
        ],
        "x": 415,
        "y": 460,
        "wires": []
    },
    {
        "id": "0dc41cb011328b65",
        "type": "change",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Clear table",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 480,
        "wires": [
            [
                "4a8a1a766a1837c0",
                "50359eeb29b81631"
            ]
        ]
    },
    {
        "id": "6e9b0e81c64578d1",
        "type": "switch",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "If global.activematch = 1",
        "property": "activematch",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 420,
        "wires": [
            [
                "0dc41cb011328b65",
                "657f37cb57ddaa95"
            ]
        ]
    },
    {
        "id": "24e10dd69d611c1f",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Send MQTT messages to update real bldgs (4 sides, 4 msgs)",
        "info": "",
        "x": 400,
        "y": 860,
        "wires": []
    },
    {
        "id": "109255f8ae4b157b",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Build MQTT Messages",
        "func": "/*\n -- The payload coming in to this function is an object with the SQL\n    results of active windows for one building.  For example, at index[0] (for side 1):\n     BUILDING_NAME: \"LBI\"\n     BUILDING_SIDE: 1\n     WINDOWS_ACTIVE: 2\n    \n -- Convert these into MQTT messages \n topic: \"nodered/updatewindow/[node_id]\"\n message: { \n     \"side_id\": [side_id],\n     \"activeWindows\": [num_activeWindows]\n  }\n*/\n\n// --- Set up basic variables\nvar input = msg.payload;\nvar theNode = input[0].BUILDING_NAME; \nvar output = []; //array of json strings\nvar msg0 = {};\nvar msg1 = {};\nvar msg2 = {};\nvar msg3 = {};\n\n// --- Loop through the object (each side)\nfor (let i in input) {\n    var theSide = input[i][\"BUILDING_SIDE\"];\n    var theActiveWindows = input[i][\"WINDOWS_ACTIVE\"];\n\n    // -- Build MQTT message for that side\n    output[i] = \"{ \" +\n        \"\\\"side_id\\\": \" + theSide + \", \" +\n        \"\\\"activeWindows\\\": \" + theActiveWindows +\n        \"}\";\n    \n}\n\n// --- Build output msgs\nmsg0.topic = \"nodered/updatewindow/\" + theNode;\nmsg0.payload = output[0];\nmsg1.topic = \"nodered/updatewindow/\" + theNode;\nmsg1.payload = output[1];\nmsg2.topic = \"nodered/updatewindow/\" + theNode;\nmsg2.payload = output[2];\nmsg3.topic = \"nodered/updatewindow/\" + theNode;\nmsg3.payload = output[3];\n\n// --- Fin\nreturn [msg0, msg1, msg2, msg3];",
        "outputs": 4,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 920,
        "wires": [
            [
                "b4e29f7a97232bf2"
            ],
            [
                "883967a94c384489"
            ],
            [
                "7187b273e7394c3f"
            ],
            [
                "a8cf64b853f83977"
            ]
        ]
    },
    {
        "id": "b4e29f7a97232bf2",
        "type": "mqtt out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 690,
        "y": 900,
        "wires": []
    },
    {
        "id": "911609ae63506f9d",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Update dashboard table",
        "info": "",
        "x": 280,
        "y": 640,
        "wires": []
    },
    {
        "id": "5007fdcc502bf71f",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Updated Building Window Statuses",
        "links": [
            "7f65a1150aef277e",
            "b17cbc13baf34fa7",
            "9861e3a7d85924df",
            "3c83eb799e9d7892"
        ],
        "x": 1205,
        "y": 540,
        "wires": []
    },
    {
        "id": "7f65a1150aef277e",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Get updated window statuses",
        "links": [
            "5007fdcc502bf71f",
            "d3db9f92aff0b743",
            "cd3d137ba28619f3"
        ],
        "x": 255,
        "y": 680,
        "wires": [
            [
                "c693bf2be0bdd6c9"
            ]
        ]
    },
    {
        "id": "b17cbc13baf34fa7",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Get updated window statuses",
        "links": [
            "5007fdcc502bf71f",
            "d3db9f92aff0b743",
            "cd3d137ba28619f3"
        ],
        "x": 255,
        "y": 920,
        "wires": [
            [
                "109255f8ae4b157b"
            ]
        ]
    },
    {
        "id": "883967a94c384489",
        "type": "mqtt out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 690,
        "y": 920,
        "wires": []
    },
    {
        "id": "7187b273e7394c3f",
        "type": "mqtt out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 690,
        "y": 940,
        "wires": []
    },
    {
        "id": "a8cf64b853f83977",
        "type": "mqtt out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 690,
        "y": 960,
        "wires": []
    },
    {
        "id": "6be1279db19ab616",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Update Dashboard + MQTT from SQL Table",
        "links": [
            "5884816cd47f36fa",
            "c2fd1600956d8597",
            "e3e43826d5609708",
            "59745bda3e910197",
            "b505ddef8a8d5b22",
            "b7dc6bf4c8549af4",
            "04c4f4f285f0deb1"
        ],
        "x": 165,
        "y": 480,
        "wires": [
            [
                "0dc41cb011328b65"
            ]
        ]
    },
    {
        "id": "657f37cb57ddaa95",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "(also update scores)",
        "links": [
            "b4f6bbea7b9c1425"
        ],
        "x": 575,
        "y": 420,
        "wires": []
    },
    {
        "id": "d11da172d0a3d14e",
        "type": "sqlite",
        "z": "221fa9b81205c952",
        "d": true,
        "g": "b761ec70a9ef3fae",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Get SQL Results",
        "x": 1070,
        "y": 580,
        "wires": [
            [
                "6d8eea74bd881d3e"
            ]
        ]
    },
    {
        "id": "1d23ea346df62408",
        "type": "function",
        "z": "221fa9b81205c952",
        "d": true,
        "g": "b761ec70a9ef3fae",
        "name": "Build SQL Stmt to Get Scores for Bldg",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar bldg = msg.payload; //from loop\n\n// build SQL statement\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, FS, FCS, DPS FROM Buildings\" + \n        \" WHERE MATCH_NUM = \" + matchid + \n        \" AND BUILDING_NAME = \\\"\" + bldg + \"\\\"\"\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 580,
        "wires": [
            [
                "d11da172d0a3d14e"
            ]
        ]
    },
    {
        "id": "561c69906925c60c",
        "type": "function",
        "z": "221fa9b81205c952",
        "d": true,
        "g": "b761ec70a9ef3fae",
        "name": "Convert SQLScores to Table Row",
        "func": "/*\n -- The payload coming in to this function is an object with the SQL\n    results of scores for one building.  For example, at index[0]:\n        BUILDING_NAME: \"LTM\"\n        FS: 8\n        FCS: 4\n        DPS: 4\n   \n\n -- Output is JSON that contains the new table updates.  E.g.: \n    [\n        {\n            \"BuildingName\": \"LTM\",\n            \"FS\":8,\n            \"FCS\":4,\n            \"DPS\":4,\n        }\n    ]\n*/\n\n// set up basic variablfes\nvar input = msg.payload;\nvar output = {}; //json \n\nvar curBldg = input[0].BUILDING_NAME; // it will be the same for all values\n\noutput[\"BuildingName\"] = curBldg;\n\n// Loop through the object\nfor (let i in input) {\n    var sidestring = \"Side\" + (input[i][\"BUILDING_SIDE\"]);\n    output[sidestring] = 50 * input[i][\"WINDOWS_ACTIVE\"];\n}\n\n// fin\n//node.warn(output);\n//msg.payload = [output];\n// Use node-red-ui-table table command\nmsg.payload = { \n    command:\"updateOrAddData\",\n    arguments: [\n        [\n            output\n        ],\n        true\n    ],\n    returnPromise: true\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "045e41f36b73f834",
        "type": "link in",
        "z": "221fa9b81205c952",
        "d": true,
        "g": "b761ec70a9ef3fae",
        "name": "Get updated scores",
        "links": [
            "6d8eea74bd881d3e"
        ],
        "x": 255,
        "y": 720,
        "wires": [
            [
                "561c69906925c60c"
            ]
        ]
    },
    {
        "id": "55a5760f1ef81c07",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Spent a ton of time trying to get a Join node to work, but couldn't get these two to combine.. \\n Don't want to do them separately because you don't want two separate things updating ui-table at the same time \\n Maybe Dom has some SQL magic to pull from two tables at once? ",
        "info": "",
        "x": 1020,
        "y": 740,
        "wires": []
    },
    {
        "id": "9a61ec5826546fce",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Convert all of this to the UI table command",
        "func": "/*\n -- The payload coming in to this function is an object with the SQL\n    results of active windows for one building.  For example, at index[0]:\n     BUILDING_NAME: \"LBI\"\n     BUILDING_SIDE: 1\n     WINDOWS_ACTIVE: 2\n    \n -- So, we just need to convert those values into the appropriate table\n    row / column / progress bar %'s \n\n -- Output is JSON that contains the new table updates.  E.g.: \n    [\n        {\n            \"BuildingName\": \"LTO\",\n            \"Side1\":0,\n            \"Side2\":50,\n            \"Side3\":100,\n            \"Side4\":0\n        }\n    ]\n*/\n\n// set up basic variablfes\nvar input = msg.payload;\nvar output = {}; //json \n\nvar curBldg = input[0].BUILDING_NAME; // it will be the same for all values\n\noutput[\"BuildingName\"] = curBldg;\n\n// Loop through the object\nfor (let i in input) {\n    var sidestring = \"Side\" + (input[i][\"BUILDING_SIDE\"]);\n    output[sidestring] = 50 * input[i][\"WINDOWS_ACTIVE\"];\n}\n\n// fin\nmsg.payload = output;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "6d8eea74bd881d3e",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Updated Scores",
        "links": [
            "045e41f36b73f834"
        ],
        "x": 1205,
        "y": 580,
        "wires": []
    },
    {
        "id": "3c2b5bf33ff7f378",
        "type": "ui_table",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "group": "039ab4d581c7b5da",
        "name": "Buildings",
        "order": 2,
        "width": "12",
        "height": "12",
        "columns": [
            {
                "field": "BUILDING_NAME",
                "title": "",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "Side1",
                "title": "1",
                "width": "",
                "align": "left",
                "formatter": "progress",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "Side2",
                "title": "2",
                "width": "",
                "align": "left",
                "formatter": "progress",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "Side3",
                "title": "3",
                "width": "",
                "align": "left",
                "formatter": "progress",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "Side4",
                "title": "4",
                "width": "",
                "align": "left",
                "formatter": "progress",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "FS",
                "title": "FS",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "FCS",
                "title": "FCS",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "DPS",
                "title": "DPS",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 260,
        "y": 260,
        "wires": []
    },
    {
        "id": "564b2cdfbde31e81",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "Load Field Table with initial values for Left Top Buildings",
        "info": "",
        "x": 280,
        "y": 80,
        "wires": []
    },
    {
        "id": "5fd586e91231d64b",
        "type": "link in",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "Left Side Table IN",
        "links": [
            "0835dea3b60c02ec",
            "5d6f905de272b1d2",
            "50359eeb29b81631",
            "68c40c7edd5cd6b8",
            "13ed4ededc66c04c"
        ],
        "x": 145,
        "y": 260,
        "wires": [
            [
                "3c2b5bf33ff7f378"
            ]
        ]
    },
    {
        "id": "0835dea3b60c02ec",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "link out 59",
        "links": [
            "5fd586e91231d64b"
        ],
        "x": 395,
        "y": 160,
        "wires": []
    },
    {
        "id": "027676a7f94dcb56",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "Main Table LInk Node",
        "info": "",
        "x": 180,
        "y": 220,
        "wires": []
    },
    {
        "id": "cb7e719f404147e7",
        "type": "inject",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "On Start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "[{\"BuildingName\":\"LTO\",\"Side1\":\"0\",\"Side2\":\"0\",\"Side3\":\"0\",\"Side4\":\"0\"},{\"BuildingName\":\"LTM\",\"Side1\":\"0\",\"Side2\":\"0\",\"Side3\":\"0\",\"Side4\":\"0\"},{\"BuildingName\":\"LTI\",\"Side1\":\"0\",\"Side2\":\"0\",\"Side3\":\"0\",\"Side4\":\"0\"}]",
        "payloadType": "json",
        "x": 200,
        "y": 160,
        "wires": [
            [
                "0835dea3b60c02ec"
            ]
        ]
    },
    {
        "id": "0fe794e7a88f6314",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "46ce7ea15148c3c0",
        "name": "Each \"Side\" is a progress bar, 0-100, i.e. One Active Window per 50%",
        "info": "",
        "x": 330,
        "y": 120,
        "wires": []
    },
    {
        "id": "b87bb6e70f564e51",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "b761ec70a9ef3fae",
        "name": "Long term - maybe dashboard every 3s or so, and MQTT every 250-500ms? \\n This wouldn't even be a big deal if I could get \"updateOrAddData\" working correctly on the ui-table..",
        "info": "",
        "x": 1160,
        "y": 420,
        "wires": []
    },
    {
        "id": "0151b281f9b86223",
        "type": "link out",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Goto BallFlow",
        "links": [
            "01954de24ad5a0da"
        ],
        "x": 2095,
        "y": 1860,
        "wires": []
    },
    {
        "id": "986017af6fcb9593",
        "type": "debug",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "debug 30",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1760,
        "y": 1820,
        "wires": []
    },
    {
        "id": "2fe33fb8bb9a740c",
        "type": "function",
        "z": "221fa9b81205c952",
        "g": "876d6d7684ab551a",
        "name": "Convert",
        "func": "// Convert form entry to the format that BallFlow is expecting\nvar pyld = msg.payload;\nvar theBldg = pyld.BUILDING_NAME;\n\nmsg.building_name = theBldg;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1740,
        "y": 1860,
        "wires": [
            [
                "986017af6fcb9593",
                "0151b281f9b86223"
            ]
        ]
    },
    {
        "id": "25b25582dbcb2144",
        "type": "ui_text",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "group": "5d736b3773c1b6c1",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FCS: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 430,
        "y": 2080,
        "wires": []
    },
    {
        "id": "84c72e5e7a50791b",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "Fire Clear Score Display using Dom Magic SQL ",
        "info": "",
        "x": 280,
        "y": 2020,
        "wires": []
    },
    {
        "id": "c37b3d3b6e56e19a",
        "type": "inject",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "FCS Test Inject",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "99",
        "payloadType": "num",
        "x": 220,
        "y": 2080,
        "wires": [
            [
                "25b25582dbcb2144"
            ]
        ]
    },
    {
        "id": "2481a3e18ec02d52",
        "type": "comment",
        "z": "221fa9b81205c952",
        "g": "06961c6f5e4566a1",
        "name": "\\n \\n \\n [[ THIS WHOLE SECTION WILL PROBABLY BE REPLACED BY DOM MAGIC SQL ]]\\n \\n \\n ",
        "info": "",
        "x": 860,
        "y": 1780,
        "wires": []
    },
    {
        "id": "1041872ebca1978e",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Retrieve Latest Activity From Current Match",
        "func": "\nvar matchid = global.get(\"matchnum\");\nvar newMsg = {\n    \"topic\": \"SELECT B.MATCH_NUM, B.BUILDING_NAME, BWS.BUILDING_SIDE, B.NUM_BAGS, B.NUM_DROPS, BWS.NUM_HITS FROM Buildings B INNER JOIN BuildingWindowStatus BWS \"\n        + \"on B.MATCH_NUM = BWS.MATCH_NUM AND B.BUILDING_NAME=BWS.BUILDING_NAME \"\n        + \"WHERE B.MATCH_NUM = \" + matchid + \";\"\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 140,
        "wires": [
            [
                "f59037c96c368ebf"
            ]
        ]
    },
    {
        "id": "f59037c96c368ebf",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1170,
        "y": 140,
        "wires": [
            [
                "648381244912ad1f",
                "42dc7006a64f8054"
            ]
        ]
    },
    {
        "id": "9cca8f992b8c7647",
        "type": "switch",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Check is Active Match",
        "property": "activematch",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 140,
        "wires": [
            [
                "1041872ebca1978e",
                "e973f31882c4c9cf"
            ],
            [
                "28f23bc48aaf3faa"
            ]
        ],
        "info": "Active match is set when the match is created and set to 1, there is a stop button to stop the active match"
    },
    {
        "id": "26f2407faa608dc1",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Is Game Active",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 260,
        "wires": []
    },
    {
        "id": "8f95daa740229529",
        "type": "link in",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Start Global 15s Timer",
        "links": [
            "6454213f89a9463e",
            "c52350773fd926d5",
            "c8663193fd1a2a4c"
        ],
        "x": 125,
        "y": 140,
        "wires": [
            [
                "9cd82c4daa29d5ad"
            ]
        ]
    },
    {
        "id": "9cd82c4daa29d5ad",
        "type": "trigger",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Global Timer - 15sec (CURRENTLY 5)",
        "op1": "",
        "op2": "0",
        "op1type": "date",
        "op2type": "str",
        "duration": "-5",
        "extend": false,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 350,
        "y": 140,
        "wires": [
            [
                "9cca8f992b8c7647"
            ]
        ]
    },
    {
        "id": "28f23bc48aaf3faa",
        "type": "change",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Match is not active",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Match is not active",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 260,
        "wires": [
            [
                "26f2407faa608dc1"
            ]
        ]
    },
    {
        "id": "e973f31882c4c9cf",
        "type": "change",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Match is active",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Match is active",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 220,
        "wires": [
            [
                "26f2407faa608dc1"
            ]
        ]
    },
    {
        "id": "648381244912ad1f",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Game Update Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 220,
        "wires": []
    },
    {
        "id": "42dc7006a64f8054",
        "type": "link out",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "link out 60",
        "links": [
            "2c6de25e908b1996",
            "35f9efa88ad160c8",
            "5f3bdfbbd6f3cb90"
        ],
        "x": 1345,
        "y": 140,
        "wires": []
    },
    {
        "id": "1c7894266bb4be36",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "b2b1f1ca3c2a378c",
        "name": "Global timer every 15 seconds, kicks off scoring updates to DB and MQTT",
        "info": "",
        "x": 360,
        "y": 80,
        "wires": []
    },
    {
        "id": "d21ffff25b233c0c",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 610,
        "y": 500,
        "wires": [
            [
                "38031cb4243cb25c"
            ]
        ]
    },
    {
        "id": "66fe54ab87d11648",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to get Bldgs at Max FS",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// build SQL statement to select all buildings with max FS\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME FROM Buildings\" + \n        \" WHERE MATCH_NUM = \" + matchid + \n        \" AND FS = 8\"\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 500,
        "wires": [
            [
                "d21ffff25b233c0c"
            ]
        ]
    },
    {
        "id": "38031cb4243cb25c",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Review max FS Bldgs, Build list of Possible Nexts",
        "func": "// --- Set up basic variables\nvar maxBldgs = msg.payload;\nvar output = []; //json array\n\n/* Example input: \n    maxBldgs[0].BUILDING_NAME = \"LTM\"\n    maxBldgs[1].BUILDING_NAME = \"LTI\"\n*/\n\n// Loop through bldgs, build array of new bldgs to check\n// using building naming tricks (e.g. \"if LTO, the next will be LTM\")\nif (maxBldgs.length > 0) {\n    for (var i = 0; i < maxBldgs.length; i++) {\n        var curBldg = maxBldgs[i].BUILDING_NAME;\n        var curCol = curBldg.substring(2);\n\n        if (curCol != \"I\") {\n            switch (curCol) {\n                case \"O\":\n                    var newCol = \"M\";\n                    break;\n                case \"M\":\n                    var newCol = \"I\";\n                    break;\n            }\n\n            var newBldg = curBldg.substring(0, 2) + newCol;\n            output.push({ BUILDING_NAME: newBldg });\n        }\n    }\n}\n\n// --- Fin\nmsg.payload = output;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 500,
        "wires": [
            [
                "90ab0fecc32bcde5"
            ]
        ]
    },
    {
        "id": "35f9efa88ad160c8",
        "type": "link in",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Burn Rate Calculations",
        "links": [
            "42dc7006a64f8054",
            "03cd4b02fae19f57",
            "9827bb283a8e319e"
        ],
        "x": 145,
        "y": 500,
        "wires": [
            [
                "66fe54ab87d11648"
            ]
        ]
    },
    {
        "id": "c5cdba8f93e28d47",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "15s Burn Rate Check",
        "info": "",
        "x": 200,
        "y": 420,
        "wires": []
    },
    {
        "id": "5b258f7caa4a95d4",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to Check Fire Eligibility",
        "func": "// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld.BUILDING_NAME;\n\n// --- Build SQL statement\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, FIRE_ELIGIBLE, FS FROM Buildings \" +\n    \"WHERE MATCH_NUM = \" + matchid + \" AND \" +\n    \"BUILDING_NAME = '\" + curBldg + \"';\"\n}\n\n// --- Fin\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 680,
        "wires": [
            [
                "bfe8431d74b3bed6"
            ]
        ]
    },
    {
        "id": "90ab0fecc32bcde5",
        "type": "loop",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Loop through Possible Nexts",
        "kind": "enum",
        "count": "",
        "initial": "1",
        "step": "1",
        "condition": "",
        "conditionType": "js",
        "when": "before",
        "enumeration": "payload",
        "enumerationType": "msg",
        "limit": "",
        "loopPayload": "loop-val",
        "finalPayload": "final-count",
        "x": 600,
        "y": 600,
        "wires": [
            [
                "5f1a0c0f330d9d19"
            ],
            [
                "5b258f7caa4a95d4"
            ]
        ]
    },
    {
        "id": "bfe8431d74b3bed6",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 610,
        "y": 680,
        "wires": [
            [
                "5462a2bd26666b2f"
            ]
        ]
    },
    {
        "id": "b52a86402946ae8d",
        "type": "switch",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "If Fire Eligible",
        "property": "payload[0].FIRE_ELIGIBLE",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 980,
        "y": 680,
        "wires": [
            [
                "0174ebdf7245c867",
                "90ab0fecc32bcde5",
                "ff1ba8e7aa6880f7"
            ],
            [
                "90ab0fecc32bcde5"
            ]
        ]
    },
    {
        "id": "0174ebdf7245c867",
        "type": "link out",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Start Burn",
        "links": [
            "c8924c7acd40cb1f"
        ],
        "x": 1195,
        "y": 660,
        "wires": []
    },
    {
        "id": "c905e5ec9fe3a717",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "START THE BURN",
        "info": "",
        "x": 1090,
        "y": 620,
        "wires": []
    },
    {
        "id": "188e7a8937b3eeec",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Spread Between Buildings",
        "info": "",
        "x": 230,
        "y": 460,
        "wires": []
    },
    {
        "id": "7622988f3e676eef",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Burn Within a Building",
        "info": "",
        "x": 220,
        "y": 780,
        "wires": []
    },
    {
        "id": "5f1a0c0f330d9d19",
        "type": "link out",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Done Spreading Btwn Buildings",
        "links": [
            "af0cc8f3c2088bbc"
        ],
        "x": 835,
        "y": 600,
        "wires": []
    },
    {
        "id": "af0cc8f3c2088bbc",
        "type": "link in",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Burn Within Building",
        "links": [
            "5f1a0c0f330d9d19"
        ],
        "x": 155,
        "y": 820,
        "wires": [
            [
                "58597e887a5478f5"
            ]
        ]
    },
    {
        "id": "afe0ce27b8dd56da",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 610,
        "y": 820,
        "wires": [
            [
                "fa0c4978405d7038"
            ]
        ]
    },
    {
        "id": "fa0c4978405d7038",
        "type": "loop",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Loop through Burning Bldgs",
        "kind": "enum",
        "count": "",
        "initial": "1",
        "step": "1",
        "condition": "",
        "conditionType": "js",
        "when": "before",
        "enumeration": "payload",
        "enumerationType": "msg",
        "limit": "",
        "loopPayload": "loop-val",
        "finalPayload": "final-count",
        "x": 520,
        "y": 900,
        "wires": [
            [],
            [
                "6d6d9e4073bfca2a"
            ]
        ]
    },
    {
        "id": "6d6d9e4073bfca2a",
        "type": "switch",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "If \"was just spread\", ignore the burn",
        "property": "payload.WAS_JUST_SPREAD",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 1040,
        "wires": [
            [
                "0ff4b05a25dbcb05"
            ],
            [
                "f7ad0a1277125d73",
                "c0b679d5263dc4cd"
            ]
        ]
    },
    {
        "id": "0ff4b05a25dbcb05",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to Reset \"was just spread\" Flag",
        "func": "/* Example input\n0: object\n    BUILDING_NAME: \"LBI\"\n    WAS_JUST_SPREAD: 1\n    FS: 4\n*/\n\n// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld.BUILDING_NAME;\n\n// --- Build SQL statements\nvar msg = {\n    \"topic\": \"UPDATE Buildings SET WAS_JUST_SPREAD = 0 WHERE \" + \n        \"MATCH_NUM = \" + matchid + \" AND \" +\n        \"BUILDING_NAME = '\" + curBldg + \"';\"\n}\n\n// --- Fin\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 1020,
        "wires": [
            [
                "b86fcf4650bb15c0",
                "8fbd2ca3f542523c"
            ]
        ]
    },
    {
        "id": "b86fcf4650bb15c0",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1170,
        "y": 1020,
        "wires": [
            [
                "fa0c4978405d7038"
            ]
        ]
    },
    {
        "id": "58597e887a5478f5",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to get Burning Bldgs",
        "func": "// set up basic variables\nvar matchid = global.get(\"matchnum\");\n\n// build SQL statement to select all buildings with burning status, but less than max FS\nvar newMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, WAS_JUST_SPREAD, FS FROM Buildings\" + \n        \" WHERE MATCH_NUM = \" + matchid + \n        \" AND BURNING_STATUS = 1 \" + \n        \" AND FS < 8\"\n}\n\n// fin\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 820,
        "wires": [
            [
                "afe0ce27b8dd56da"
            ]
        ]
    },
    {
        "id": "f7ad0a1277125d73",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to get MinWindowSequence",
        "func": "// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld.BUILDING_NAME;\n\n// --- Build SQL statement to get the minimum (earliest) side sequence with < 2 windows\nvar wndwMsg = {\n    \"topic\": \"SELECT BuildingWindowStatus.BUILDING_NAME, Min(BuildingWindowStatus.WINDOW_SEQUENCE) AS MinOfSideSequence FROM BuildingWindowStatus \" +\n        \"WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND \" +\n        \"((BuildingWindowStatus.BUILDING_NAME)='\" + curBldg + \"') AND \" +\n        \"((BuildingWindowStatus.WINDOWS_ACTIVE)<2));\"\n}\n\n// --- Fin\nreturn wndwMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1200,
        "wires": [
            [
                "986d2e280e45de7f",
                "b249b8f1b98174a4"
            ]
        ]
    },
    {
        "id": "c0b679d5263dc4cd",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to Increment FS",
        "func": "/* Example input\n0: object\n    BUILDING_NAME: \"LBI\"\n    WAS_JUST_SPREAD: 1\n    FS: 4\n*/\n\n\n// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld.BUILDING_NAME;\nvar curFS = pyld.FS;\nvar newFS = curFS + 1;\n\n// --- Build SQL statements\nvar msg = {\n    \"topic\": \"UPDATE Buildings SET FS = \" + newFS + \" WHERE \" + \n        \"MATCH_NUM = \" + matchid + \" AND \" +\n        \"BUILDING_NAME = '\" + curBldg + \"';\"\n}\n\n// --- Fin\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1140,
        "wires": [
            [
                "7804a412d60bf28e",
                "3e6e15e5c63e1d6a"
            ]
        ]
    },
    {
        "id": "7804a412d60bf28e",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1110,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "986d2e280e45de7f",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1110,
        "y": 1200,
        "wires": [
            [
                "d5ecf80c25bd29b1",
                "9c36b025ce60755e"
            ]
        ]
    },
    {
        "id": "ffa6f64c863dd6d7",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1110,
        "y": 1260,
        "wires": [
            [
                "c7250da4e3efc921",
                "d22a44513afbaff1"
            ]
        ]
    },
    {
        "id": "d5ecf80c25bd29b1",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Build SQL Stmt to get Active Windows",
        "func": "/* Example input\n0: object\nBUILDING_NAME: \"LTM\"\nMinOfSideSequence: 3\n*/ \n\n// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld[0].BUILDING_NAME;\nvar curSeq = pyld[0].MinOfSideSequence;\n\n// --- Build SQL statement to get the minimum (earliest) side sequence with < 2 windows\nvar wndwMsg = {\n    \"topic\": \"SELECT BUILDING_NAME, WINDOW_SEQUENCE, WINDOWS_ACTIVE FROM BuildingWindowStatus \" +\n        \"WHERE (((BuildingWindowStatus.MATCH_NUM)=\" + matchid + \") AND \" +\n        \"((BuildingWindowStatus.BUILDING_NAME)='\" + curBldg + \"') AND \" +\n        \"((BuildingWindowStatus.WINDOW_SEQUENCE) = \" + curSeq + \"));\"\n}\n\n// --- Fin\nreturn wndwMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1260,
        "wires": [
            [
                "ffa6f64c863dd6d7",
                "3ac3e5e6d417580e"
            ]
        ]
    },
    {
        "id": "c7250da4e3efc921",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "Increase those Windows",
        "func": "/* Example input\n0: object\nBUILDING_NAME: \"LTM\"\nWINDOW_SEQUENCE: 3\nWINDOWS_ACTIVE: 0\n*/ \n\n// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar curBldg = pyld[0].BUILDING_NAME;\nvar curSeq = pyld[0].WINDOW_SEQUENCE;\nvar curActive = pyld[0].WINDOWS_ACTIVE;\n\nvar newActive = curActive + 1;\n\n// --- Build SQL statement to set the new windows\nvar wndwMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = \" + newActive +\n        \" WHERE MATCH_NUM=\" + matchid + \" AND \" +\n        \"BUILDING_NAME='\" + curBldg + \"' AND \" +\n        \"WINDOW_SEQUENCE = \" + curSeq + \";\"\n}\n\n// --- Fin\nreturn wndwMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1320,
        "wires": [
            [
                "301cc370fc617f4c",
                "b4c6561b559a3ff5"
            ]
        ]
    },
    {
        "id": "301cc370fc617f4c",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 1110,
        "y": 1320,
        "wires": [
            [
                "fa0c4978405d7038"
            ]
        ]
    },
    {
        "id": "5462a2bd26666b2f",
        "type": "switch",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "If FS = 0",
        "property": "payload[0].FS",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 680,
        "wires": [
            [
                "b52a86402946ae8d"
            ],
            [
                "90ab0fecc32bcde5"
            ]
        ]
    },
    {
        "id": "3e6e15e5c63e1d6a",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db increase FS",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 1080,
        "wires": []
    },
    {
        "id": "8fbd2ca3f542523c",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db reset a spread flag",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1220,
        "y": 940,
        "wires": []
    },
    {
        "id": "ff1ba8e7aa6880f7",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "to start a burn",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 720,
        "wires": []
    },
    {
        "id": "b249b8f1b98174a4",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db asking minwindowsequence",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1240,
        "wires": []
    },
    {
        "id": "9c36b025ce60755e",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db receiving minwindowsequence",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 1280,
        "wires": []
    },
    {
        "id": "3ac3e5e6d417580e",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db asking activewindows",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 1340,
        "wires": []
    },
    {
        "id": "d22a44513afbaff1",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db receiving activewindows",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1460,
        "y": 1380,
        "wires": []
    },
    {
        "id": "b4c6561b559a3ff5",
        "type": "debug",
        "z": "78c5e866df5030a1",
        "g": "c5248dc36aacb922",
        "name": "db increase Windows",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 1400,
        "wires": []
    },
    {
        "id": "c8924c7acd40cb1f",
        "type": "link in",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "Bldg Start Burning",
        "links": [
            "0174ebdf7245c867"
        ],
        "x": 1865,
        "y": 560,
        "wires": [
            [
                "f7954fdaf37f1d6b",
                "69cd02e02585755b",
                "4c03455adb33b337"
            ]
        ]
    },
    {
        "id": "03fe7cfb0cca4dd1",
        "type": "comment",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "Building Start Burning - First update FS in Buildings, then update Window Sequence, and finally set Active Windows",
        "info": "",
        "x": 2150,
        "y": 480,
        "wires": []
    },
    {
        "id": "f7954fdaf37f1d6b",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "Update Buildings SQL",
        "func": "// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar theBldg = pyld[0].BUILDING_NAME;\n\n// --- Build SQL statement\n// Since it's just the first time, we know the FS, side, etc\nvar newMsg = {\n    \"topic\": \"UPDATE Buildings SET FS = 1, BURNING_STATUS = 1, WAS_JUST_SPREAD = 1 \" +\n    \"WHERE MATCH_NUM = \" + matchid + \" AND \" +\n    \"BUILDING_NAME= '\" + theBldg + \"';\"\n}\n\n// --- Fin\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 540,
        "wires": [
            [
                "74784ec507860137"
            ]
        ]
    },
    {
        "id": "74784ec507860137",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2390,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "d0a5e8de374a7a44",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "Update BuildingsWindowStatus SQL",
        "func": "// --- Set up basic variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar theBldg = pyld[0].BUILDING_NAME;\n\n// --- Build SQL statement\n// Since it's just the first time, we know the FS, side, etc\nvar newMsg = {\n    \"topic\": \"UPDATE BuildingWindowStatus SET WINDOWS_ACTIVE = 1 \" +\n    \"WHERE MATCH_NUM = \" + matchid + \" AND \" +\n    \"BUILDING_NAME = '\" + theBldg + \"' AND \" + \n    \"WINDOW_SEQUENCE = 1;\"\n}\n\n// --- Fin\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2230,
        "y": 620,
        "wires": [
            [
                "9694f7729d4a4b39"
            ]
        ]
    },
    {
        "id": "9694f7729d4a4b39",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Send SQL",
        "x": 2470,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "4c03455adb33b337",
        "type": "function",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "Set up Building Window Sequence SQL",
        "func": "//--- Variables\nvar matchid = global.get(\"matchnum\");\nvar pyld = msg.payload;\nvar theBldg = pyld[0].BUILDING_NAME;\nvar WindowsActive = new Map();\nvar WindowSequence = new Map();\nvar sql = \"\";\n\n//--- Set up Sequence maps\nvar whichSet = Math.floor(Math.random() * 2); //randomly choose between two sequence options\nif (whichSet == 0) {\n    WindowSequence[1] = 2;\n    WindowSequence[2] = 3;\n    WindowSequence[3] = 1;\n    WindowSequence[4] = 4;\n} else if (whichSet == 1) {\n    WindowSequence[1] = 2;\n    WindowSequence[2] = 1;\n    WindowSequence[3] = 3;\n    WindowSequence[4] = 4;\n}\n\n//--- Build multi-line SQL statement \nfor (var i = 1; i <= 4; i++) {\n    var line = \"UPDATE BuildingWindowStatus SET\" +\n        \" WINDOW_SEQUENCE = \" + WindowSequence[i] + \n        \" WHERE MATCH_NUM = \" + matchid + \n        \" AND BUILDING_NAME = '\" + theBldg + \"'\" +\n        \" AND BUILDING_SIDE = \" + i + \"; \"\n    \n    sql = sql + line;\n}\n\n//--- Fin\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2120,
        "y": 580,
        "wires": [
            [
                "d6ddc265e0e6f590"
            ]
        ]
    },
    {
        "id": "d6ddc265e0e6f590",
        "type": "sqlite",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "Send SQL (Batch)",
        "x": 2410,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "69cd02e02585755b",
        "type": "delay",
        "z": "78c5e866df5030a1",
        "g": "418e8e7e5f859cb1",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 1990,
        "y": 620,
        "wires": [
            [
                "d0a5e8de374a7a44"
            ]
        ]
    },
    {
        "id": "0992c684f2271f0e",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "SQL - New Match",
        "func": "\nvar timestamp = msg.payload;\n//Choose a random side to start match -\n\nvar matchnum = global.get(\"matchnum\");\n\n\n//Choose a random side\nvar active = \"LEFT\";\n;\nif (Math.floor(Math.random() * 2)==0) {\n    active = \"RIGHT\"\n}\nglobal.set(\"startside\", active);\n\nvar newMsg = {\n    \"topic\": \"INSERT INTO MATCH_STATE (TIMEOFMATCH, ACTIVE_COMMUNITY) VALUES (  \"+ timestamp + \", '\" + active + \"');\"\n}\n\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 180,
        "wires": [
            [
                "9e523391779ae934"
            ]
        ]
    },
    {
        "id": "d36ef2fad2d08d5f",
        "type": "link in",
        "z": "c76bd87c4cae8120",
        "d": true,
        "g": "4bbf2c1d342827b1",
        "name": "New Match Creation",
        "links": [
            "4eb277af36ef1fe2",
            "6243bfa8703f32ca",
            "7f5a474942e946d6"
        ],
        "x": 285,
        "y": 180,
        "wires": [
            [
                "98b12c1e303486f3"
            ]
        ]
    },
    {
        "id": "2c3b21cccf6adf7b",
        "type": "comment",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "Create a new empty match (set global.matchnum to new matchnum)",
        "info": "",
        "x": 320,
        "y": 120,
        "wires": []
    },
    {
        "id": "1a20725593d7b89e",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "Select All Game Table",
        "func": "var newMsg = {\n    \"topic\": \"select * from MATCH_STATE ORDER BY TIMEOFMATCH DESC;\"\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 320,
        "wires": [
            [
                "a5335a1083d1d5ce"
            ]
        ]
    },
    {
        "id": "a5335a1083d1d5ce",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLLiteGenericAccess",
        "x": 690,
        "y": 320,
        "wires": [
            [
                "0129b9e5b3b7cd23"
            ]
        ]
    },
    {
        "id": "0129b9e5b3b7cd23",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "Result match_num",
        "func": "var matchid = msg.payload[0].MATCH_NUM;\nmsg.payload = matchid;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 320,
        "wires": [
            [
                "a9f9404dbd9276a0"
            ]
        ]
    },
    {
        "id": "a9f9404dbd9276a0",
        "type": "change",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "set global",
        "rules": [
            {
                "t": "set",
                "p": "matchnum",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1080,
        "y": 320,
        "wires": [
            [
                "525f1f19c2aa78a9"
            ]
        ]
    },
    {
        "id": "50d2b3036d95d6fb",
        "type": "link in",
        "z": "c76bd87c4cae8120",
        "d": true,
        "g": "4bbf2c1d342827b1",
        "name": "Set Latest Matchnum to Global",
        "links": [
            "165f13f0f929f16e"
        ],
        "x": 265,
        "y": 320,
        "wires": [
            [
                "1a20725593d7b89e"
            ]
        ]
    },
    {
        "id": "d44de76c8506206b",
        "type": "comment",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "Sets Global.matchnum to latest match in DB",
        "info": "",
        "x": 250,
        "y": 260,
        "wires": []
    },
    {
        "id": "0554919775c9921e",
        "type": "link out",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "New Match DB Entry Complete",
        "links": [
            "1d8b42fd0952e51b",
            "dd55547c4747b6b1"
        ],
        "x": 1045,
        "y": 180,
        "wires": []
    },
    {
        "id": "525f1f19c2aa78a9",
        "type": "link out",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "New Match DB Entry Complete",
        "links": [
            "a67d3036cd8b2a23"
        ],
        "x": 1185,
        "y": 320,
        "wires": []
    },
    {
        "id": "9e523391779ae934",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "Match Create",
        "x": 840,
        "y": 180,
        "wires": [
            [
                "0554919775c9921e"
            ]
        ]
    },
    {
        "id": "98b12c1e303486f3",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "4bbf2c1d342827b1",
        "name": "Add Match Start",
        "func": "var d = new Date();\nvar time1 = d.getTime();\nmsg.payload = time1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 180,
        "wires": [
            [
                "0992c684f2271f0e"
            ]
        ]
    },
    {
        "id": "8a7388f51ce071e6",
        "type": "debug",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "Current Game Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 500,
        "wires": []
    },
    {
        "id": "88c80410ac1ebd2a",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "SQL - Initialize Match - TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft);\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight);\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n};\n\nconst BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n};\n\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, WAS_JUST_SPREAD, FCS, FS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" \n      + leftNodeName + \"','\" \n      + COMMUNITYLEFT + \"','\" \n      + BuildingSizeForLeftMap[leftNodeName] \n      + \"','\" + BuildingSensorsForLeftMap[leftNodeName] \n      + \"',1,0, 0, 0, 0, 8, 0, 0, 0, 0,\" \n      + timestamp + \");\\n \";\n  sql = sql + line;\n  \n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n  var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, WAS_JUST_SPREAD, FCS, FS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\"\n      + rightNodeName + \"','\"\n      + COMMUNITYRIGHT + \"','\"\n      + BuildingSizeForRightMap[rightNodeName]\n      + \"','\" + BuildingSensorsForRightMap[rightNodeName]\n      + \"',1,0, 0,0,0,8,0,0,0,0,\"\n      + timestamp + \"); \\n\";\n    sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 520,
        "wires": [
            [
                "8a7388f51ce071e6",
                "b8b568cbf8dd8f15"
            ]
        ]
    },
    {
        "id": "9e4c8b2d59a8c9c5",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "SQL -  - Initialize Match - TABLE BuildingWindowStatus",
        "func": "  \nvar d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nconst NodesForLeft = ['LTO', 'LTM', 'LTI', 'LBO', 'LBM', 'LBI'];\nconst NodesForRight = ['RTO', 'RTM', 'RTI', 'RBO', 'RBM', 'RBI'];\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst numSides = 4;\n\nvar burningNode1 = global.get(\"burning1\");\nvar burningNode2 = global.get(\"burning2\");\n\n\n\n/*\nCREATE TABLE BuildingWindowStatus(\n  MATCH_NUM INT NOT NULL,\n  BUILDING_NAME VARCHAR[32],\n  COMMUNITY INT NOT NULL,\n  BUILDING_SIDE INT NOT NULL,\n  WINDOWS_ACTIVE INT,\n  NUM_HITS INT NOT NULL,\n  TIMEOFMATCH INT NOT NULL,\n  PRIMARY KEY(MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, NUM_HITS, TIMEOFMATCH) \" + \n      \"VALUES(\" + matchnum + \", '\" + leftNodeName + \"','\" + COMMUNITYLEFT +\"', \"+i+\", 0, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, NUM_HITS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" + rightNodeName + \"','\" + COMMUNITYRIGHT + \"', \" + i + \", 0, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\n\n\nmsg.topic = sql; \nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 720,
        "wires": [
            [
                "8a7388f51ce071e6",
                "34de1618774ad1f8"
            ]
        ]
    },
    {
        "id": "8fe9fb732a74354d",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "SQL - Calculate and UPDATE TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft);\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight);\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n};\n\nvar BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n};\n\nconst BuildingBlockedForLeftMap = {\n  'LTO': 0,\n  'LTM': 0,\n  'LTI': 0,\n  'LBO': 0,\n  'LBM': 0,\n  'LBI': 0,\n};\n\nconst BuildingBlockedForRightMap = {\n  'RTO': 0,\n  'RTM': 0,\n  'RTI': 0,\n  'RBO': 0,\n  'RBM': 0,\n  'RBI': 0,\n};\n\nvar strdebug = \"\";\n//Start picking random things\n//First set all buildings to not burning\nvar BurningBuildings = {};\nfor (const node of AllNodes) {\n  BurningBuildings[node] = 0;\n}\n\n//set a tall building burning, set sensor type\nvar tallSensor = \"\";\nvar tallBuildingBurning = Math.floor(Math.random() * 2);\nvar shortBuildingBurning = Math.floor(Math.random() * 2);\nif (startside=='LEFT') {\n  BurningBuildings[TallBuildingsLeft[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsLeft[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsLeft[tallBuildingBurning]);\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForLeftMap[TallBuildingsLeft[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn\n  for (const node of ShortBuildingsLeft) {\n    strdebug += i + \":\" + BuildingSensorsForLeftMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForLeftMap[node] == tallSensor) {\n      continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      strdebug += \" -- \" + i;\n\n      BurningBuildings[ShortBuildingsLeft[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsLeft[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n} else {\n  BurningBuildings[TallBuildingsRight[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsRight[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsRight[tallBuildingBurning]);\n\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForRightMap[TallBuildingsRight[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn. -- this takes a scal\n  // shortBuildingBurning is the one out of the right sensored shorts\n  for (const node of ShortBuildingsRight) {\n    strdebug += i + \":\" + BuildingSensorsForRightMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForRightMap[node] == tallSensor) {\n     continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      \n      BurningBuildings[ShortBuildingsRight[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsRight[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n}\n\n//Of the 4 that are left -- choose a random node\nvar lastOneHotspot = Math.floor(Math.random() * 4);\nvar lastOneHospotName = NonBurningNodes[lastOneHotspot];\n//Start picking random things\n//First set all buildings to not burning\nvar Hotspots =  new Map();\nfor (const node of AllNodes) {\n  Hotspots[node] = 0;\n}\nHotspots[lastOneHospotName] = 1;\n\n// Of the 2 that are burning -- \n\n//first setr all to 0\nvar FS = new Map();\nfor (const node of AllNodes) {\n  FS[node] = 0;\n}\n\nvar DPS = new Map();\nfor (const node of AllNodes) {\n  DPS[node] = 0;\n}\n\nvar FCS = new Map();\nfor (const node of AllNodes) {\n  FCS[node] = 0;\n}\n\nvar Burn = new Map();\nfor (const node of AllNodes) {\n  Burn[node] = 0;\n}\n\n//Set FCS and DPS for the Burning side\nif (startside == 'LEFT') {\n  for (const node of NodesForLeft) {\n    FCS[node] = 8;\n    DPS[node] = 8;\n  }\n}\n\n//Set Burning node values\nfor (const node of BurningNodes) {\n    FS[node] = 4;\n    DPS[node] = 8 - FS[node]; // yes it's obviously 4... but this helps us remember why\n    FCS[node] = 8 - FS[node];\n    Burn[node] = 1;\n}\n\n//Set these for the Initialize Match - TABLE BuildingWindowStatus to pick the sequence windows\nvar it = BurningNodes.values();\nglobal.set(\"burning1\",it.next().value);\nglobal.set(\"burning2\", it.next().value);\nglobal.set(\"lancedebug\", strdebug);\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\n\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"UPDATE Buildings SET\" \n      + \" COMMUNITY = '\" + COMMUNITYLEFT + \"'\"     \n      + \", BUILDING_SIZE = '\" + BuildingSizeForLeftMap[leftNodeName] + \"'\"     \n      + \", SENSOR_TYPE = '\" + BuildingSensorsForLeftMap[leftNodeName] + \"'\"     \n      + \", FIRE_ELIGIBLE = 1\"   \n      + \", HOTSPOT = \" + Hotspots[leftNodeName] \n      + \", BURNING_STATUS = \" + Burn[leftNodeName]  \n      + \", BLOCKED = \" + BuildingBlockedForLeftMap[leftNodeName] \n      + \", FS = \" + FS[leftNodeName]\n      + \", FCS = \" + FCS[leftNodeName]\n      + \", DPS = \" + DPS[leftNodeName]\n      + \", NUM_BAGS = 0\"   \n      + \", NUM_DROPS = 0 \"   \n      + \", TIMEOFMATCH = \" + timestamp  \n      +\" WHERE BUILDING_NAME='\"+ leftNodeName +\"' AND MATCH_NUM=\" +matchnum\n      +\";\\n\";\n  sql = sql + line;\n  \n}\n\n//initialize right\nconst COMMUNITYRIGHT = \"RIGHT\";\nif (startside == 'RIGHT') { \n  var startFCS = 8; \n} else { \n  startFCS = 0; //reset because it was already set when we did the lefts\n} // only set FCS on the burning side for starters\n\nfor (const rightNodeName of NodesForRight) {\n\n  var line = \"UPDATE Buildings SET\"\n    + \" COMMUNITY = '\" + COMMUNITYRIGHT + \"'\"\n    + \", BUILDING_SIZE = '\" + BuildingSizeForRightMap[rightNodeName] + \"'\"\n    + \", SENSOR_TYPE = '\" + BuildingSensorsForRightMap[rightNodeName] + \"'\"\n    + \", FIRE_ELIGIBLE = 1\" \n    + \", HOTSPOT = \" + Hotspots[rightNodeName]\n    + \", BURNING_STATUS = \" + Burn[rightNodeName]  \n    + \", BLOCKED = \" + BuildingBlockedForRightMap[rightNodeName]\n    + \", FS = \" + FS[rightNodeName]\n    + \", FCS = \" + FCS[rightNodeName]\n    + \", DPS = \" + DPS[rightNodeName]\n    + \", NUM_BAGS = 0\"\n    + \", NUM_DROPS = 0 \"\n    + \", TIMEOFMATCH = \" + timestamp\n    + \" WHERE BUILDING_NAME='\" + rightNodeName + \"' AND MATCH_NUM=\" + matchnum\n    + \";\\n\";\n  sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 620,
        "wires": [
            [
                "8a7388f51ce071e6",
                "7208fa7e7114434b"
            ]
        ]
    },
    {
        "id": "b055361f8ee3d7c0",
        "type": "function",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "SQL - Calculate and Update - Initialize Match - TABLE BuildingWindowStatus",
        "func": "\nvar d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nconst NodesForLeft = ['LTO', 'LTM', 'LTI', 'LBO', 'LBM', 'LBI'];\nconst NodesForRight = ['RTO', 'RTM', 'RTI', 'RBO', 'RBM', 'RBI'];\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst numSides = 4;\n\n\n//This is how we pass in the burning buildings from the intialation of the building\nvar burningNode1 = global.get(\"burning1\");\nvar burningNode2 = global.get(\"burning2\");\n\n\nvar WindowsActive = new Map();\nvar WindowSequence = new Map();//Dom added\n\nfor (const node of AllNodes) {\n  var whichSet = 10;\n  if (node == burningNode1 || node == burningNode2) {\n    whichSet=Math.floor(Math.random() * 2);\n  }\n  if (whichSet ==10) {\n    for (var i = 1; i <= 4; i++) {\n      var nodepluswin = node + i + '';\n      WindowsActive[nodepluswin] = 0;\n      WindowSequence[nodepluswin] =0;//Dom added\n    }\n  } else if (whichSet == 0) {\n    WindowsActive[node + \"1\"] = 2;\n    WindowSequence[node + \"1\"] = 2;//Dom added\n    WindowsActive[node + \"2\"] = 0;\n    WindowSequence[node + \"2\"] = 3;//Dom added\n    WindowsActive[node + \"3\"] = 2;\n    WindowSequence[node + \"3\"] = 1;//Dom added\n    WindowsActive[node + \"4\"] = 0;\n    WindowSequence[node + \"4\"] = 4;//Dom added\n  } else if (whichSet == 1) {\n    WindowsActive[node + \"1\"] = 2;\n    WindowSequence[node + \"1\"] = 2;//Dom added\n    WindowsActive[node + \"2\"] = 2;\n    WindowSequence[node + \"2\"] = 1;//Dom added\n    WindowsActive[node + \"3\"] = 0;\n    WindowSequence[node + \"3\"] = 3;//Dom added\n    WindowsActive[node + \"4\"] = 0;\n    WindowSequence[node + \"4\"] = 4;//Dom added\n  }\n}\n\n\n\n/*\nCREATE TABLE BuildingWindowStatus(\n  MATCH_NUM INT NOT NULL,\n  BUILDING_NAME VARCHAR[32],\n  COMMUNITY INT NOT NULL,\n  BUILDING_SIDE INT NOT NULL,\n  WINDOWS_ACTIVE INT,\n  NUM_HITS INT NOT NULL,\n  TIMEOFMATCH INT NOT NULL,\n  PRIMARY KEY(MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n  for (var i = 1; i <= 4; i++) {\n    var nodepluswin = leftNodeName + i + '';\n    //Dom updated\n    var line = \"UPDATE BuildingWindowStatus SET \"\n      + \" COMMUNITY = '\" + COMMUNITYLEFT + \"'\"   \n      + \", WINDOWS_ACTIVE = \" + WindowsActive[nodepluswin]\n      + \", WINDOW_SEQUENCE = \" + WindowSequence[nodepluswin]\n      + \", NUM_HITS = 0 \"\n      + \", TIMEOFMATCH = \" + timestamp\n      + \" WHERE MATCH_NUM=\" + matchnum + \" AND BUILDING_NAME='\" + leftNodeName + \"' AND BUILDING_SIDE=\" + i\n      +\";\";\n    sql = sql + line;\n  }\n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n  for (var i = 1; i <= 4; i++) {\n    var nodepluswin = rightNodeName + i;\n    //Dom updated\n    var line = \"UPDATE BuildingWindowStatus SET \"\n      + \" COMMUNITY = '\" + COMMUNITYRIGHT + \"'\" \n      + \", WINDOWS_ACTIVE = \" + WindowsActive[nodepluswin]\n      + \", WINDOW_SEQUENCE = \" + WindowSequence[nodepluswin]\n      + \", NUM_HITS = 0 \"\n      + \", TIMEOFMATCH = \" + timestamp\n      + \" WHERE MATCH_NUM=\" + matchnum + \" AND BUILDING_NAME='\" + rightNodeName + \"' AND BUILDING_SIDE=\" + i\n      + \";\";\n    sql = sql + line;\n  }\n}\n\n\n\nmsg.topic = sql; \nmsg.lance = burningNode1;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 800,
        "wires": [
            [
                "8a7388f51ce071e6",
                "493311208733ae0d",
                "512ef011616a4b81"
            ]
        ]
    },
    {
        "id": "cacf2baa95692221",
        "type": "link in",
        "z": "c76bd87c4cae8120",
        "d": true,
        "g": "0832a839154f65ab",
        "name": "Create Empty Game Records",
        "links": [
            "3719854fdfed232d"
        ],
        "x": 195,
        "y": 520,
        "wires": [
            [
                "88c80410ac1ebd2a"
            ]
        ]
    },
    {
        "id": "b8b568cbf8dd8f15",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildings For Match",
        "x": 720,
        "y": 520,
        "wires": [
            [
                "8fe9fb732a74354d"
            ]
        ]
    },
    {
        "id": "7208fa7e7114434b",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildings For Match",
        "x": 800,
        "y": 620,
        "wires": [
            [
                "9e4c8b2d59a8c9c5"
            ]
        ]
    },
    {
        "id": "34de1618774ad1f8",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildingsWindows For Match",
        "x": 830,
        "y": 720,
        "wires": [
            [
                "b055361f8ee3d7c0"
            ]
        ]
    },
    {
        "id": "493311208733ae0d",
        "type": "sqlite",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "batch",
        "sql": "",
        "name": "InitializeBuildingsWindows For Match",
        "x": 1050,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "512ef011616a4b81",
        "type": "debug",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "debug 25",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "lance",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 900,
        "wires": []
    },
    {
        "id": "370c0cbf29d05ab1",
        "type": "comment",
        "z": "c76bd87c4cae8120",
        "g": "0832a839154f65ab",
        "name": "Initialize to Game State",
        "info": "",
        "x": 180,
        "y": 460,
        "wires": []
    },
    {
        "id": "fa744c0499161826",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL - Initialize Match - TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\nconst TreesLeft = ['LTREES']; //dom added\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\nconst TreesRight = ['RTREES']; //dom added\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft).concat(TreesLeft); //dom modified\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight).concat(TreesRight); //dom modified\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\nfor (const tree of TreesLeft) { //dom added\n  BuildingSizeForLeftMap[tree] = 'Tree'; //dom added\n} //dom added\n\n\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\nfor (const tree of TreesRight) { //dom added\n  BuildingSizeForRightMap[tree] = 'Tree'; //dom added\n} //dom added\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = { //dom modified\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n  'LTREES': 'Switch',\n};\n\nconst BuildingSensorsForRightMap = { //dom modified\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n  'RTREES': 'Switch',\n};\n\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" \n      + leftNodeName + \"','\" \n      + COMMUNITYLEFT + \"','\" \n      + BuildingSizeForLeftMap[leftNodeName] \n      + \"','\" + BuildingSensorsForLeftMap[leftNodeName] \n      + \"',1,0, 0,0, 0, 0, 0, 0,\" \n      + timestamp + \");\\n \";\n  sql = sql + line;\n  \n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n    var line = \"INSERT INTO Buildings(MATCH_NUM, BUILDING_NAME, COMMUNITY,BUILDING_SIZE,SENSOR_TYPE, FIRE_ELIGIBLE, HOTSPOT, BURNING_STATUS, BLOCKED, FCS, DPS, NUM_BAGS, NUM_DROPS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\"\n      + rightNodeName + \"','\"\n      + COMMUNITYRIGHT + \"','\"\n      + BuildingSizeForRightMap[rightNodeName]\n      + \"','\" + BuildingSensorsForRightMap[rightNodeName]\n      + \"',1,0, 0,0,0, 0,0,0,\"\n      + timestamp + \"); \\n\";\n    sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1640,
        "y": 100,
        "wires": [
            [
                "12b7849527a8f3d3",
                "5e3bed73fbede711"
            ]
        ]
    },
    {
        "id": "5e3bed73fbede711",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL - Calculate and UPDATE TABLE Buildings ",
        "func": "var d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nvar startside = global.get(\"startside\");\n\n\n//Declare all of the constants \n\n//Node Names\n\n\n//Declare all of the building sizes\nconst TallBuildingsLeft = ['LTO', 'LBO'];\nconst ShortBuildingsLeft = ['LTM', 'LTI', 'LBM', 'LBI'];\nconst TreesLeft = ['LTREES']; //dom added\n\nconst TallBuildingsRight = ['RTO', 'RBO'];\nconst ShortBuildingsRight = ['RTM', 'RTI', 'RBM', 'RBI'];\nconst TreesRight = ['RTREES']; //dom added\n\nconst NodesForLeft = TallBuildingsLeft.concat(ShortBuildingsLeft) //dom didn't add trees because they should not be randomly chosen later in code\nconst NodesForRight = TallBuildingsRight.concat(ShortBuildingsRight) //dom didn't add trees because they should not be randomly chosen later in code\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst NonBurningNodes = new Set(AllNodes);\nconst BurningNodes = new Set();\n\n\n// Adding to a map to make it easier to lookup when gen sql\nvar BuildingSizeForLeftMap =  new Map();\nfor (const tall of TallBuildingsLeft) {\n  BuildingSizeForLeftMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsLeft) {\n  BuildingSizeForLeftMap[short] = 'Short';\n}\nfor (const tree of TreesLeft) { //dom added\n  BuildingSizeForLeftMap[tree] = 'Tree'; //dom added\n} //dom added\n\nvar BuildingSizeForRightMap = new Map();\nfor (const tall of TallBuildingsRight) {\n  BuildingSizeForRightMap[tall] = 'Tall';\n}\nfor (const short of ShortBuildingsRight) {\n  BuildingSizeForRightMap[short] = 'Short';\n}\nfor (const tree of TreesRight) { //dom added\n  BuildingSizeForRightMap[tree] = 'Tree'; //dom added\n} //dom added\n\n\n//Constants - building sensors\n\nvar BuildingSensorsForLeftMap = {\n  'LTO': 'Ball',\n  'LTM': 'Laser',\n  'LTI': 'Ball',\n  'LBO': 'Laser',\n  'LBM': 'Laser',\n  'LBI': 'Ball',\n  'LTREES': 'Switch', //dom added\n};\n\nvar BuildingSensorsForRightMap = {\n  'RTO': 'Laser',\n  'RTM': 'Laser',\n  'RTI': 'Ball',\n  'RBO': 'Ball',\n  'RBM': 'Laser',\n  'RBI': 'Ball',\n  'RTREES': 'Switch', //dom added\n};\n\nconst BuildingBlockedForLeftMap = {\n  'LTO': 0,\n  'LTM': 0,\n  'LTI': 0,\n  'LBO': 0,\n  'LBM': 0,\n  'LBI': 0,\n  'LTREES': 1, //dom added\n};\n\nconst BuildingBlockedForRightMap = {\n  'RTO': 0,\n  'RTM': 0,\n  'RTI': 0,\n  'RBO': 0,\n  'RBM': 0,\n  'RBI': 0,\n  'RTREES': 1, //dom added\n};\n\nvar strdebug = \"\";\n//Start picking random things\n//First set all buildings to not burning\nvar BurningBuildings = {};\nfor (const node of AllNodes) {\n  BurningBuildings[node] = 0;\n}\n\n//set a tall building burning, set sensor type\nvar tallSensor = \"\";\nvar tallBuildingBurning = Math.floor(Math.random() * 2);\nvar shortBuildingBurning = Math.floor(Math.random() * 2);\nif (startside=='LEFT') {\n  BurningBuildings[TallBuildingsLeft[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsLeft[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsLeft[tallBuildingBurning]);\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForLeftMap[TallBuildingsLeft[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn\n  for (const node of ShortBuildingsLeft) {\n    strdebug += i + \":\" + BuildingSensorsForLeftMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForLeftMap[node] == tallSensor) {\n      continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      strdebug += \" -- \" + i;\n\n      BurningBuildings[ShortBuildingsLeft[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsLeft[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n} else {\n  BurningBuildings[TallBuildingsRight[tallBuildingBurning]] = 1;\n  //Remove burning node so we know what is left\n  NonBurningNodes.delete(TallBuildingsRight[tallBuildingBurning]);\n  BurningNodes.add(TallBuildingsRight[tallBuildingBurning]);\n\n  //what sensor is the burning building?\n  tallSensor = BuildingSensorsForRightMap[TallBuildingsRight[tallBuildingBurning]];\n  var i = 0;\n  //Find the short building to burn. -- this takes a scal\n  // shortBuildingBurning is the one out of the right sensored shorts\n  for (const node of ShortBuildingsRight) {\n    strdebug += i + \":\" + BuildingSensorsForRightMap[node] + \":\" + tallSensor + \"    | \";\n    if (BuildingSensorsForRightMap[node] == tallSensor) {\n     continue;\n    } else {\n      i++;\n    }\n    if (i == shortBuildingBurning + 1) {\n      \n      BurningBuildings[ShortBuildingsRight[node]] = 1;\n      NonBurningNodes.delete(ShortBuildingsRight[node]);\n      BurningNodes.add(node);\n      break;\n    }\n  }\n}\n\n//Of the 4 that are left -- choose a random node\nvar lastOneHotspot = Math.floor(Math.random() * 4);\nvar lastOneHospotName = NonBurningNodes[lastOneHotspot];\n//Start picking random things\n//First set all buildings to not burning\nvar Hotspots =  new Map();\nfor (const node of AllNodes) {\n  Hotspots[node] = 0;\n}\nHotspots[lastOneHospotName] = 1;\n\n// Of the 2 that are burning -- \n\n//first setr all to 0\nvar FCS = new Map();\nfor (const node of AllNodes) {\n  FCS[node] = 0;\n}\n\nvar DPS = new Map();\nfor (const node of AllNodes) {\n  DPS[node] = 0;\n}\n\nvar Burn = new Map();\nfor (const node of AllNodes) {\n  Burn[node] = 0;\n}\n\n//Set Burning node values\nfor (const node of BurningNodes) {\n    DPS[node] = 4;\n    FCS[node] = 4;\n    Burn[node] = 1;\n}\n\n//Set these for the Initialize Match - TABLE BuildingWindowStatus to pick the sequence windows\nvar it = BurningNodes.values();\nglobal.set(\"burning1\",it.next().value);\nglobal.set(\"burning2\", it.next().value);\nglobal.set(\"lancedebug\", strdebug);\n\n\n\n/*\nCREATE TABLE Buildings (\nMATCH_NUM INT NOT NULL,\nBUILDING_NAME VARCHAR[32],\nBUILDING_SIZE VARCHAR[12],\nSENSOR_TYPE VARCHAR[12],\nCOMMUNITY INT NOT NULL,\nFIRE_ELIGIBLE INT NOT NULL,\nHOTSPOT INT NOT NULL, \nBURNING_STATUS INT NOT NULL,\nBLOCKED INT NOT NULL, \nFCS INT NOT NULL, \nDPS INT NOT NULL, \nNUM_BAGS INT NOT NULL,\nNUM_DROPS INT NOT NULL, \nTIMEOFMATCH INT NOT NULL,\nPRIMARY KEY (MATCH_NUM, BUILDING_NAME));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\n\nfor (const leftNodeName of NodesForLeft) {\n    var line = \"UPDATE Buildings SET\" \n      + \" COMMUNITY = '\" + COMMUNITYLEFT + \"'\"     \n      + \", BUILDING_SIZE = '\" + BuildingSizeForLeftMap[leftNodeName] + \"'\"     \n      + \", SENSOR_TYPE = '\" + BuildingSensorsForLeftMap[leftNodeName] + \"'\"     \n      + \", FIRE_ELIGIBLE = 1\"   \n      + \", HOTSPOT = \" + Hotspots[leftNodeName] \n      + \", BURNING_STATUS = \" + Burn[leftNodeName]  \n      + \", BLOCKED = \" + BuildingBlockedForLeftMap[leftNodeName] \n      + \", FCS = \" + FCS[leftNodeName]\n      + \", DPS = \" + DPS[leftNodeName]\n      + \", NUM_BAGS = 0\"   \n      + \", NUM_DROPS = 0 \"   \n      + \", TIMEOFMATCH = \" + timestamp  \n      +\" WHERE BUILDING_NAME='\"+ leftNodeName +\"' AND MATCH_NUM=\" +matchnum\n      +\";\\n\";\n  sql = sql + line;\n  \n}\n\n//initialize \nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n\n  var line = \"UPDATE Buildings SET\"\n    + \" COMMUNITY = '\" + COMMUNITYRIGHT + \"'\"\n    + \", BUILDING_SIZE = '\" + BuildingSizeForRightMap[rightNodeName] + \"'\"\n    + \", SENSOR_TYPE = '\" + BuildingSensorsForRightMap[rightNodeName] + \"'\"\n    + \", FIRE_ELIGIBLE = 1\" \n    + \", HOTSPOT = \" + Hotspots[rightNodeName]\n    + \", BURNING_STATUS = \" + Burn[rightNodeName]  \n    + \", BLOCKED = \" + BuildingBlockedForRightMap[rightNodeName]\n    + \", FCS = \" + FCS[rightNodeName]\n    + \", DPS = \" + DPS[rightNodeName]\n    + \", NUM_BAGS = 0\"\n    + \", NUM_DROPS = 0 \"\n    + \", TIMEOFMATCH = \" + timestamp\n    + \" WHERE BUILDING_NAME='\" + rightNodeName + \"' AND MATCH_NUM=\" + matchnum\n    + \";\\n\";\n  sql = sql + line;\n\n}\n\nmsg.topic = sql;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 200,
        "wires": [
            [
                "0aa61745968b6ee5"
            ]
        ]
    },
    {
        "id": "0692d55544c5bd31",
        "type": "function",
        "z": "f74b301e4f22310f",
        "g": "c4beeef48c6dcf84",
        "name": "SQL -  - Initialize Match - TABLE BuildingWindowStatus",
        "func": "  \nvar d = new Date();\nvar timestamp = d.getTime();\nvar matchnum = global.get(\"matchnum\");\nconst NodesForLeft = ['LTO', 'LTM', 'LTI', 'LBO', 'LBM', 'LBI', 'LTREES'];\nconst NodesForRight = ['RTO', 'RTM', 'RTI', 'RBO', 'RBM', 'RBI', 'RTREES'];\nconst AllNodes = NodesForLeft.concat(NodesForRight);\nconst numSides = 4;\n\nvar burningNode1 = global.get(\"burning1\");\nvar burningNode2 = global.get(\"burning2\");\n\n\n\n/*\nCREATE TABLE BuildingWindowStatus(\n  MATCH_NUM INT NOT NULL,\n  BUILDING_NAME VARCHAR[32],\n  COMMUNITY INT NOT NULL,\n  BUILDING_SIDE INT NOT NULL,\n  WINDOWS_ACTIVE INT,\n  NUM_HITS INT NOT NULL,\n  TIMEOFMATCH INT NOT NULL,\n  PRIMARY KEY(MATCH_NUM, BUILDING_NAME, BUILDING_SIDE));\n  */\n\nvar sql = \"\";\n\n//initialize left\nconst COMMUNITYLEFT = \"LEFT\";\nfor (const leftNodeName of NodesForLeft) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" + \n      \"VALUES(\" + matchnum + \", '\" + leftNodeName + \"','\" + COMMUNITYLEFT +\"', \"+i+\", 0, 2, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\n//initialize left\nconst COMMUNITYRIGHT = \"RIGHT\";\nfor (const rightNodeName of NodesForRight) {\n  for (var i = 1; i <= 4; i++) {\n    var line = \"INSERT INTO BuildingWindowStatus(MATCH_NUM, BUILDING_NAME, COMMUNITY, BUILDING_SIDE, WINDOWS_ACTIVE, DAMAGE_PREVENTION_SCORE, NUM_HITS, TIMEOFMATCH) \" +\n      \"VALUES(\" + matchnum + \", '\" + rightNodeName + \"','\" + COMMUNITYRIGHT + \"', \" + i + \", 0, 2, 0, \" + timestamp + \"); \";\n    sql = sql + line;\n  }\n}\n\n\n\nmsg.topic = sql; \nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1700,
        "y": 300,
        "wires": [
            [
                "c1f1b1372fb990e6"
            ]
        ]
    },
    {
        "id": "55d8f8946d586a92",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "name": "SQL - Is Hotspot",
        "func": "//SQL to determine if building is a hotspot\n\nvar matchid = global.get(\"matchnum\");\nvar nodeid = msg.building_name;\n\nmsg.topic = \"SELECT Buildings.HOTSPOT as IsHotspot FROM Buildings WHERE (((Buildings.MATCH_NUM)=\" + matchid + \") AND ((Buildings.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 120,
        "wires": [
            [
                "57b270e787b21dfd"
            ]
        ]
    },
    {
        "id": "57b270e787b21dfd",
        "type": "sqlite",
        "z": "c46bd56bf00dd36c",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 910,
        "y": 120,
        "wires": [
            [
                "8c0a74adb92331c1"
            ]
        ]
    },
    {
        "id": "8c0a74adb92331c1",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "name": "Retreive IsHotspot Value",
        "func": "//SQLite results; is building a hotspot?\n\nvar ishotspot = msg.payload[0].IsHotspot; //this is the data needed via the SQL\nmsg.is_hotspot = ishotspot\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 120,
        "wires": [
            [
                "a39cc0a1489b6dd0"
            ]
        ]
    },
    {
        "id": "ca6af37434b7c2bc",
        "type": "inject",
        "z": "c46bd56bf00dd36c",
        "name": "Make Hotspot",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 720,
        "wires": [
            [
                "5cc92e9812d69911"
            ]
        ]
    },
    {
        "id": "5cc92e9812d69911",
        "type": "function",
        "z": "c46bd56bf00dd36c",
        "name": "Make Hotspot (edit me)",
        "func": "//edit this as needed for testing\n\nvar matchid = 1\nvar nodeid = \"RBI\"\nmsg.topic = \"UPDATE Buildings SET HOTSPOT = 1 WHERE (((MATCH_NUM)=\" + matchid + \") AND ((Buildings.BUILDING_NAME)='\" + nodeid + \"'))\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 720,
        "wires": [
            [
                "646666eba37fcc66"
            ]
        ]
    },
    {
        "id": "646666eba37fcc66",
        "type": "sqlite",
        "z": "c46bd56bf00dd36c",
        "mydb": "6f6f2d0bf9d4b5e3",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQL",
        "x": 570,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "2053eb0ef9726e0d",
        "type": "comment",
        "z": "c46bd56bf00dd36c",
        "name": "Make Hotspot for testing",
        "info": "",
        "x": 170,
        "y": 680,
        "wires": []
    },
    {
        "id": "7d6da5e70ab066c4",
        "type": "switch",
        "z": "e1a756fd8363adc2",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 660,
        "y": 380,
        "wires": [
            [
                "89c8eb874103c96c"
            ],
            []
        ]
    },
    {
        "id": "89c8eb874103c96c",
        "type": "mqtt out",
        "z": "e1a756fd8363adc2",
        "d": true,
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "5999f1d09afe1039",
        "x": 810,
        "y": 380,
        "wires": []
    },
    {
        "id": "28fa28d003db402b",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 620,
        "wires": [
            [
                "d659c7c1a1ee4638"
            ],
            []
        ]
    },
    {
        "id": "4cad3e5e4fd26039",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1100,
        "y": 720,
        "wires": [
            [
                "eefd448726fdf3ee"
            ],
            []
        ]
    },
    {
        "id": "de84522b3b85352e",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 820,
        "wires": [
            [
                "d0c72785beeaf77f"
            ],
            []
        ]
    },
    {
        "id": "d8a1bac52593bbb4",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1100,
        "y": 920,
        "wires": [
            [
                "3ba3088e67cb12eb"
            ],
            []
        ]
    },
    {
        "id": "a9fbd03404b6b1ae",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1460,
        "y": 920,
        "wires": [
            [
                "27578e827405ddbe"
            ],
            []
        ]
    },
    {
        "id": "58df087ce7a70c25",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1780,
        "y": 820,
        "wires": [
            [
                "aff8404fddd1fe2e"
            ],
            []
        ]
    },
    {
        "id": "bb65f8fab55826f6",
        "type": "switch",
        "z": "5b48d63e525889af",
        "name": "Is Hotspot",
        "property": "is_hotspot",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2160,
        "y": 720,
        "wires": [
            [
                "926978629096483a"
            ],
            []
        ]
    }
]